(()=>{"use strict";var e={87594:function(e,t,i){i.d(t,{J_:()=>s,L7:()=>r});let r="importFile:",s="favicon:"},91088:function(e,t,i){i.d(t,{MQ:()=>n,P4:()=>a,RE:()=>s,mr:()=>r});let r=i(15589).i8,s="https://docs.scriptcat.org",a="https://ext.scriptcat.org/",n=a+"api/v1/"},77811:function(e,t,i){i.d(t,{BW:()=>n,CP:()=>a,Gf:()=>h,J7:()=>o,Kv:()=>l,Ru:()=>u,le:()=>d,oO:()=>s,of:()=>c});var r=i(54867);let s=1,a=2,n=3,l=1,o=2,c="running",d="complete";class u extends r.M{enableCache(){super.enableCache(),this.scriptCodeDAO.enableCache()}save(e){return super._save(e.uuid,e)}findByUUID(e){return this.get(e)}async getAndCode(e){let[t,i]=await Promise.all([this.get(e),this.scriptCodeDAO.get(e)]);if(t&&i)return Object.assign(t,i)}findByName(e){return this.findOne((t,i)=>i.name===e)}findByNameAndNamespace(e,t){return this.findOne((i,r)=>r.name===e&&(!t||r.namespace===t))}findByUUIDAndSubscribeUrl(e,t){return this.findOne((i,r)=>r.uuid===e&&r.subscribeUrl===t)}findByOriginAndSubscribeUrl(e,t){return this.findOne((i,r)=>r.origin===e&&r.subscribeUrl===t)}constructor(){var e,t;super("script"),e="scriptCodeDAO",t=new h,e in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t}}class h extends r.M{findByUUID(e){return this.get(e)}save(e){return super._save(e.uuid,e)}constructor(){super("scriptCode")}}},56378:function(e,t,i){i.d(t,{oi:()=>a,s4:()=>s,zk:()=>n});var r=i(54867);let s=1,a=2;class n extends r.M{findByUrl(e){return this.get(e)}save(e){return super._save(e.url,e)}constructor(){super("subscribe")}}},30159:function(e,t,i){i.d(t,{D0:()=>y,ZP:()=>j,cW:()=>v,ex:()=>b,kx:()=>w,rN:()=>x,t:()=>r.t});var r=i(36910),s=i(90001),a=i(97766),n=i.n(a),l=i(52136),o=i.n(l),c=i(58533),d=i(82900),u=i(20027),h=i(96531),p=i(79554),m=i(49847),f=i(2285),g=i(68988);i(85937),i(81473),i(7306),i(42800),i(93606),i(99397),i(78309),n().extend(o());let x="";function y(e,t){r.ZP.changeLanguage(e,t),n().locale(e.toLocaleLowerCase())}function v(e){let t=chrome.i18n.getUILanguage(),i=globalThis.localStorage&&localStorage.language||t;r.ZP.use(s.Db).init({fallbackLng:"en-US",lng:i,interpolation:{escapeValue:!1},resources:{"en-US":{title:"English",translation:c},"zh-CN":{title:"简体中文",translation:u},"zh-TW":{title:"繁体中文",translation:h},"ja-JP":{title:"日本語",translation:m},"de-DE":{title:"Deutsch",translation:f},"vi-VN":{title:"Tiếng Việt",translation:d},"ru-RU":{title:"Русский",translation:g},"ach-UG":{title:"伪语言",translation:p}}}),e.getLanguage().then(e=>{y(e),e.startsWith("zh-")||(x="/en")})}function b(e){let t=e.metadata[`name:${r.ZP.language.toLowerCase()}`];return t?t[0]:e.name}function w(){return chrome.i18n.getAcceptLanguages().then(e=>{for(let t=0;t<e.length;t+=1){let i=e[t];if(r.ZP.hasResourceBundle(i,"translation"))return i}let t={};for(let e of r.ZP.languages){let i=e.split("-")[0];t[i]||(t[i]=[]),t[i].push(e)}for(let i=0;i<e.length;i+=1){let r=e[i].split("-")[0];if(t[r]&&t[r].length>0)return t[r][0]}return""})}let j=r.ZP},97824:function(e,t,i){var r,s,a,n=i(35330),l=i(51021),o=i(50145),c=i(13800),d=i(52796),u=i(74918),h=i(21367),p=i(89025),m=i(77113),f=i(34050),g=i(27104),x=i(80780),y=i(97766),v=i.n(y),b=i(38610);function w(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let j=new(i(84663)).ZP("ScriptCat"),_=Error("数据保存失败");class k{list(e,t){if(!t)return this.table.where(e).toArray();let i=this.table.where(e).offset((t.page()-1)*t.count()).limit(t.count());return"id"!==t.order()&&i.sortBy(t.order()),"desc"===t.sort()&&(i=i.reverse()),i.toArray()}find(){return this.table}findOne(e){return this.table.where(e).first()}async save(e){let t=e.id;if(!t)return delete e.id,this.table.add(e);if(await this.table.update(t,e))return t;throw _}findById(e){return this.table.get(e)}clear(){return this.table.clear()}async delete(e){return"number"==typeof e?this.table.where({id:e}).delete():this.table.where(e).delete()}update(e,t){return this.table.update(e,t)}count(){return this.table.count()}constructor(){w(this,"table",void 0),w(this,"tableName","")}}class Z extends k{async queryLogs(e,t){return(await this.table.where("createtime").between(e,t).toArray()).sort((e,t)=>t.createtime-e.createtime)}deleteBefore(e){return this.table.where("createtime").below(e).delete()}constructor(){var e;super(),(e="tableName")in this?Object.defineProperty(this,e,{value:"logger",enumerable:!0,configurable:!0,writable:!0}):this[e]="logger",this.table=j.table(this.tableName)}}var C=i(76028),S=i(74023);i(72902);let $=e=>{let{value:t,labels:i,onChange:r,onClose:s}=e,a=i[t.key]||{};return(0,n.jsxs)("div",{className:"log-query-label",children:[(0,n.jsx)(C.Z,{showSearch:!0,placeholder:"key",value:t.key||void 0,onChange:e=>{r({...t,key:e})},triggerProps:{autoAlignPopupWidth:!1,autoAlignPopupMinWidth:!0,position:"bl"},children:Object.keys(i).map(e=>(0,n.jsx)(C.Z.Option,{value:e,children:e},e))}),(0,n.jsxs)(C.Z,{placeholder:"condition",value:t.condition||"=",onChange:e=>{r({...t,condition:e})},children:[(0,n.jsx)(C.Z.Option,{value:"=",children:"="}),(0,n.jsx)(C.Z.Option,{value:"=~",children:"=~"}),(0,n.jsx)(C.Z.Option,{value:"!=",children:"!="}),(0,n.jsx)(C.Z.Option,{value:"!~",children:"!~"})]}),(0,n.jsx)(C.Z,{showSearch:!0,placeholder:"value",value:t.value||void 0,onChange:e=>{r({...t,value:e})},triggerProps:{autoAlignPopupWidth:!1,autoAlignPopupMinWidth:!0,position:"bl"},children:Object.keys(a).map(e=>(0,n.jsx)(C.Z.Option,{value:e,children:e},e))}),(0,n.jsx)(m.Z,{iconOnly:!0,icon:(0,n.jsx)(S.Z,{}),onClick:s})]})};var E=i(80684),N=i(60298),O=i(23831),T=i(90001);let D=function(){let[e,t]=l.useState({}),i=JSON.parse((0,N.lr)()[0].get("query")||"[{}]"),[r,s]=l.useState(0),[a,o]=l.useState(i),[c,y]=l.useState([]),[w,j]=l.useState([]),[_,k]=l.useState(""),[C,S]=l.useState(v()().subtract(24,"hour").unix()),[D,P]=l.useState(v()().unix()),F=new Z,R={logCleanCycle:1},{t:B}=(0,T.$G)(),I=()=>{let e=[],t=_&&new RegExp(_);c.forEach(i=>{for(let e=0;e<a.length;e+=1){let t=a[e];if(t.key){let e=i.label[t.key];switch(t.condition){case"=":default:if(e!=t.value)return;break;case"=~":case"!~":if("string"==typeof e&&!e.includes(t.value))return;break;case"!=":if(e==t.value)return}}}(!t||t.test(i.message))&&e.push(i)}),s(4),j(e)};return(0,l.useEffect)(()=>{1===r&&i.length&&i[0].key&&(I(),s(2))},[r]),(0,l.useEffect)(()=>{F.queryLogs(1e3*C,1e3*D).then(i=>{y(i),i.forEach(t=>{Object.keys(t.label).forEach(i=>{e[i]||(e[i]={});let r=t.label[i];switch(typeof r){case"string":case"number":e[i][r]=!0}})}),t(e),j([]),0===r&&s(1)})},[C,D]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.Z,{visibleHeight:30,style:{position:"absolute"},target:()=>document.getElementById("backtop")}),(0,n.jsx)("div",{id:"backtop",style:{height:"100%",overflow:"auto",position:"relative"},children:(0,n.jsxs)(u.Z,{direction:"vertical",className:"log-space",style:{width:"100%"},children:[(0,n.jsx)(h.Z,{bordered:!1,title:B("log_title"),extra:(0,n.jsxs)(u.Z,{size:"large",children:[(0,n.jsx)(p.Z.RangePicker,{style:{width:400},showTime:!0,shortcutsPlacementLeft:!0,value:[1e3*C,1e3*D],onChange:(e,t)=>{S(t[0].unix()),P(t[1].unix())},shortcuts:[{text:B("last_5_minutes"),value:()=>[v()(),v()().add(-5,"minute")]},{text:B("last_15_minutes"),value:()=>[v()(),v()().add(-15,"minute")]},{text:B("last_30_minutes"),value:()=>[v()(),v()().add(-30,"minute")]},{text:B("last_1_hour"),value:()=>[v()(),v()().add(-1,"hour")]},{text:B("last_3_hours"),value:()=>[v()(),v()().add(-3,"hour")]},{text:B("last_6_hours"),value:()=>[v()(),v()().add(-6,"hour")]},{text:B("last_12_hours"),value:()=>[v()(),v()().add(-12,"hour")]},{text:B("last_24_hours"),value:()=>[v()(),v()().add(-24,"hour")]},{text:B("last_7_days"),value:()=>[v()(),v()().add(-7,"day")]}]}),(0,n.jsx)(m.Z,{type:"primary",onClick:I,children:B("query")})]}),children:(0,n.jsxs)(u.Z,{direction:"vertical",children:[(0,n.jsxs)(u.Z,{style:{background:"var(--color-neutral-1)",padding:8},direction:"vertical",children:[(0,n.jsx)("div",{className:"text-sm font-medium",children:B("labels")}),(0,n.jsxs)(u.Z,{children:[a.map((t,i)=>(0,n.jsx)($,{value:t,labels:e,onChange:e=>{o(t=>t.map((t,r)=>r===i?e:t))},onClose:()=>{o(e=>e.filter((e,t)=>t!==i))}},`${t.key}_${t.value}_${i}`)),(0,n.jsx)(m.Z,{iconOnly:!0,onClick:()=>{o([...a,{key:"",condition:"=",value:""}])},icon:(0,n.jsx)(E.Z,{})})]})]}),(0,n.jsxs)(u.Z,{style:{background:"var(--color-neutral-1)",padding:8},direction:"vertical",children:[(0,n.jsx)("div",{className:"text-sm font-medium",children:B("search_regex")}),(0,n.jsx)(f.Z,{value:_,onChange:e=>k(e)})]})]})}),(0,n.jsxs)(h.Z,{className:"show-log-card",bordered:!1,title:B("logs"),extra:(0,n.jsxs)(u.Z,{children:[(0,n.jsxs)(u.Z,{children:[(0,n.jsx)("span",{children:B("clean_schedule")}),(0,n.jsx)(f.Z,{defaultValue:R.logCleanCycle.toString(),style:{width:"60px"},type:"number",onChange:e=>{R.logCleanCycle=parseInt(e,10)}}),(0,n.jsx)("span",{children:B("days_ago_logs")})]}),(0,n.jsx)(m.Z,{type:"primary",status:"warning",onClick:()=>{for(let e of w)F.delete(e.id);j([]),y([]),g.Z.info(B("delete_completed"))},children:B("delete_current_logs")}),(0,n.jsx)(m.Z,{type:"primary",status:"danger",onClick:()=>{F.clear(),j([]),y([]),g.Z.info(B("clear_completed"))},children:B("clear_logs")})]}),style:{padding:8,height:"100%",boxSizing:"border-box"},children:[(0,n.jsxs)(b.Z,{children:[(0,O.F)(C)," ",B("to")," ",(0,O.F)(D)," ",B("total_logs",{length:c.length}),4===r?`, ${B("filtered_logs",{length:w.length})}`:`, ${B("enter_filter_conditions")}`]}),(0,n.jsx)(x.Z,{style:{height:"100%",overflow:"auto"},size:"small",dataSource:w,render:e=>(0,n.jsxs)(x.Z.Item,{style:{background:"error"===e.level?"var(--color-danger-light-2)":"warn"===e.level?"var(--color-warning-light-2)":"info"===e.level?"var(--color-success-light-2)":"var(--color-primary-light-1)"},children:[(0,O.F)(e.createtime/1e3)," ","object"==typeof e.message?JSON.stringify(e.message):e.message," ",JSON.stringify(e.label)]},e.id)})]})]})})]})};var P=i(77811),F=i(18011),R=i(59991),B=i(77233);let I=new Worker("/src/linter.worker.js");class U{static sendLinterMessage(e){I.postMessage(e)}}r="hook",s=new B.Z,r in U?Object.defineProperty(U,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):U[r]=s,I.onmessage=e=>{U.hook.emit("message",e.data)};let z=l.forwardRef((e,t)=>{let{id:i,className:r,code:s,diffCode:a,editable:o}=e,[c,d]=(0,l.useState)(),[u,h]=(0,l.useState)(!1),[p,m]=(0,l.useState)(""),f=(0,l.useRef)(null);return(0,l.useImperativeHandle)(t,()=>({editor:c})),(0,l.useEffect)(()=>{Promise.all([R.RH.getEslintConfig(),R.RH.getEnableEslint()]).then(e=>{let[t,i]=e;m(t),h(i)})},[]),(0,l.useEffect)(()=>{let e;if(void 0===a||void 0===s||!f.current)return()=>{};let t=document.getElementById(i);return a?(e=F.j6.createDiffEditor(t,{hideUnchangedRegions:{enabled:!0},enableSplitViewResizing:!1,renderSideBySide:!1,folding:!0,foldingStrategy:"indentation",automaticLayout:!0,overviewRulerBorder:!1,scrollBeyondLastLine:!1,readOnly:!0,diffWordWrap:"off",glyphMargin:!0})).setModel({original:F.j6.createModel(a,"javascript"),modified:F.j6.createModel(s,"javascript")}):((e=F.j6.create(t,{language:"javascript",theme:"dark"===document.body.getAttribute("arco-theme")?"vs-dark":"vs",folding:!0,foldingStrategy:"indentation",automaticLayout:!0,overviewRulerBorder:!1,scrollBeyondLastLine:!1,readOnly:!o,glyphMargin:!0})).setValue(s),d(e)),()=>{null==e||e.dispose()}},[f,s,a,o,i]),(0,l.useEffect)(()=>{let e;if(!u||!c)return()=>{};let t=c.getModel();if(!t)return()=>{};let r=()=>{e&&clearTimeout(e),e=setTimeout(()=>{e=null,U.sendLinterMessage({code:t.getValue(),id:i,config:JSON.parse(p)})},500)};r(),t.onDidChangeContent(()=>{r()});let s=e=>{if(i!==e.id)return;F.j6.setModelMarkers(t,"ESLint",e.markers);let r=new Map;e.markers.forEach(e=>{e.fix&&r.set(`${e.code.value}|${e.startLineNumber}|${e.endLineNumber}|${e.startColumn}|${e.endColumn}`,e.fix)}),R.WE.set("eslint-fix",r);var s=e.markers.map(e=>{let{startLineNumber:t,endLineNumber:i,severity:r}=e;return{startLineNumber:t,endLineNumber:i,severity:r}});let a={4:"icon-warn",8:"icon-error"},n=t.getAllDecorations().filter(e=>e.options.glyphMarginClassName&&Object.values(a).includes(e.options.glyphMarginClassName));c.removeDecorations(n.map(e=>e.id)),c.createDecorationsCollection(s.map(e=>{let{startLineNumber:t,endLineNumber:i,severity:r}=e;return{range:new F.e6(t,1,i,1),options:{isWholeLine:!0,glyphMarginClassName:a[r]}}}))};return U.hook.addListener("message",s),()=>{U.hook.removeListener("message",s)}},[i,c,u,p]),(0,n.jsx)("div",{id:i,className:r,ref:f})});var A=i(11166),M=i(67380),L=i(95369),H=i(75093),q=i(84974),W=i(63147),V=i(17213),J=i(50726);i(21795);var K=i(46516),G=i(42378),Y=i(30723),Q=i(75025);function X(e,t){return Math.floor(Math.random()*(t-e+1))+e}function ee(e){switch(typeof e){case"string":case"number":case"boolean":case"object":return typeof e;default:return"unknown"}}var et=i(29889),ei=i(43749),er=i(67166),es=i(25249),ea=i(59339),en=i(14444),el=i(36071);let eo=et.Z.Item,ec=e=>{let{script:t,visible:i,onCancel:r,onOk:s}=e,[a,o]=(0,l.useState)([]),[c,d]=(0,l.useState)({}),h=(0,l.useRef)(null),[p,x]=(0,l.useState)(),[y,v]=(0,l.useState)(!1),[b,w]=(0,l.useState)(!1),[j,_]=(0,l.useState)(""),[k]=et.Z.useForm(),{t:Z}=(0,T.$G)(),S=(e,i)=>{Q.wh.setScriptValue(t.uuid,e,i);let r={...c,[e]:i};void 0===i&&delete r[e],E(r)},$=e=>{Q.wh.setScriptValues(t.uuid,e),E(e)},E=e=>{d(e),_(JSON.stringify(e,null,2)),o(Object.keys(e).map(t=>({key:t,value:e[t]})))};(0,l.useEffect)(()=>{if(!t)return()=>{};Q.wh.getScriptValue(t).then(e=>{E(e)})},[t]);let N=[{title:Z("key"),dataIndex:"key",key:"key",filterIcon:(0,n.jsx)(ea.Z,{}),width:140,filterDropdown:e=>{let{filterKeys:t,setFilterKeys:i,confirm:r}=e;return(0,n.jsx)("div",{className:"arco-table-custom-filter",children:(0,n.jsx)(f.Z.Search,{ref:h,searchButton:!0,placeholder:Z("enter_key"),value:t[0]||"",onChange:e=>{i(e?[e]:[])},onSearch:()=>{r()}})})},onFilter:(e,t)=>!e||t.key.includes(e),onFilterDropdownVisibleChange:e=>{e&&setTimeout(()=>h.current.focus(),1)}},{title:Z("value"),dataIndex:"value",key:"value",className:"max-table-cell",render:e=>"string"==typeof e?e:(0,n.jsx)("span",{style:{whiteSpace:"break-spaces"},children:JSON.stringify(e,null,2)})},{title:Z("type"),dataIndex:"value",width:90,key:"type",render:e=>ee(e)},{title:Z("action"),render:(e,t)=>(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(m.Z,{type:"text",icon:(0,n.jsx)(en.Z,{}),onClick:()=>{x(t),v(!0)}}),(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,icon:(0,n.jsx)(el.Z,{}),onClick:()=>{S(t.key,void 0),g.Z.info({content:Z("delete_success")})}})]})}];return(0,n.jsxs)(ei.Z,{width:600,title:(0,n.jsxs)("span",{children:[null==t?void 0:t.name," ",Z("script_storage")]}),visible:i,onOk:s,onCancel:r,footer:null,children:[(0,n.jsx)(q.Z,{title:p?Z("edit_value"):Z("add_value"),visible:y,onOk:()=>{k.validate().then(e=>{switch(e.type){case"number":e.value=Number(e.value);break;case"boolean":e.value="true"===e.value;break;case"object":e.value=JSON.parse(e.value)}S(e.key,e.value),g.Z.info({content:p?Z("update_success"):Z("add_success")}),v(!1)})},onCancel:()=>v(!1),children:y&&(0,n.jsxs)(et.Z,{form:k,initialValues:{key:null==p?void 0:p.key,value:"string"==typeof(null==p?void 0:p.value)?null==p?void 0:p.value:JSON.stringify(null==p?void 0:p.value,null,2),type:ee((null==p?void 0:p.value)||"string")},children:[(0,n.jsx)(eo,{label:"Key",field:"key",rules:[{required:!0}],children:(0,n.jsx)(f.Z,{placeholder:Z("key_placeholder"),disabled:!!p})}),(0,n.jsx)(eo,{label:"Value",field:"value",rules:[{required:!0}],children:(0,n.jsx)(f.Z.TextArea,{rows:6,placeholder:Z("value_placeholder")})}),(0,n.jsx)(eo,{label:Z("type"),field:"type",rules:[{required:!0}],children:(0,n.jsxs)(C.Z,{children:[(0,n.jsx)(C.Z.Option,{value:"string",children:Z("type_string")}),(0,n.jsx)(C.Z.Option,{value:"number",children:Z("type_number")}),(0,n.jsx)(C.Z.Option,{value:"boolean",children:Z("type_boolean")}),(0,n.jsx)(C.Z.Option,{value:"object",children:Z("type_object")})]})})]})}),(0,n.jsxs)(u.Z,{className:"w-full",direction:"vertical",children:[(0,n.jsxs)(u.Z,{className:"!flex justify-end",children:[b?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Z,{type:"primary",status:"warning",onClick:()=>{_(JSON.stringify(c,null,2))},children:Z("restore")}),(0,n.jsx)(m.Z,{type:"primary",onClick:()=>{try{let e=JSON.parse(j);$(e),g.Z.info({content:Z("save_success")})}catch(e){g.Z.error({content:`${Z("save_failed")}: ${e}`})}},children:Z("save")})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(er.Z,{focusLock:!0,title:Z("confirm_clear"),onOk:()=>{$({}),g.Z.info({content:Z("clear_success")})},children:(0,n.jsx)(m.Z,{type:"primary",status:"warning",children:Z("clear")})}),(0,n.jsx)(m.Z,{type:"primary",onClick:()=>{x(void 0),v(!0)},children:Z("add")})]}),(0,n.jsx)(m.Z,{type:"primary",status:"success",onClick:()=>{w(!b)},children:b?Z("individual_edit"):Z("batch_edit")})]}),b?(0,n.jsx)(f.Z.TextArea,{value:j,onChange:e=>_(e),style:{height:"calc(95vh - 100px)"}}):(0,n.jsx)(es.Z,{columns:N,data:a,rowKey:"id"})]})]})};var ed=i(67824),eu=i(71533);let eh=e=>{let{script:t,visible:i,onCancel:r,onOk:s}=e,[a,o]=(0,l.useState)([]),c=(0,l.useRef)(null),{t:d}=(0,T.$G)(),h=new ed.zm(R.yw);(0,l.useEffect)(()=>t?(h.getScriptResources(t).then(e=>{let t=[];for(let i of Object.keys(e)){let r=e[i];r.key=i,t.push(r)}o(t)}),()=>{}):()=>{},[t]);let p=[{title:d("key"),dataIndex:"key",key:"key",filterIcon:(0,n.jsx)(ea.Z,{}),filterDropdown:e=>{let{filterKeys:t,setFilterKeys:i,confirm:r}=e;return(0,n.jsx)("div",{className:"arco-table-custom-filter",children:(0,n.jsx)(f.Z.Search,{ref:c,searchButton:!0,placeholder:d("enter_key"),value:t[0]||"",onChange:e=>{i(e?[e]:[])},onSearch:()=>{r()}})})},onFilter:(e,t)=>!e||t.key.includes(e),onFilterDropdownVisibleChange:e=>{e&&setTimeout(()=>c.current.focus(),1)}},{title:d("type"),dataIndex:"contentType",width:140,key:"type",render:(e,t)=>`${t.type}/${e}`},{title:d("action"),render:(e,t,i)=>(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(m.Z,{type:"text",icon:(0,n.jsx)(eu.Z,{}),onClick:()=>{let e=URL.createObjectURL(function(e){let t=e.split(",")[0].split(":")[1].split(";")[0],i=atob(e.split(",")[1]),r=new Uint8Array(new ArrayBuffer(i.length));for(let e=0;e<i.length;e+=1)r[e]=i.charCodeAt(e);return new Blob([r],{type:t})}(t.base64));setTimeout(()=>{URL.revokeObjectURL(e)},6e4);let i=t.url.split("/").pop();chrome.downloads.download({url:e,saveAs:!0,filename:i})}}),(0,n.jsx)(er.Z,{focusLock:!0,title:d("confirm_delete_resource"),onOk:()=>{g.Z.info({content:d("deleting")}),h.deleteResource(t.url).then(()=>{g.Z.info({content:d("delete_success")}),o(a.filter((e,t)=>t!==i))}).catch(e=>{g.Z.error({content:d("delete_failed")+": "+e.message})})},children:(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,icon:(0,n.jsx)(el.Z,{})})})]})}];return(0,n.jsx)(ei.Z,{width:600,title:(0,n.jsxs)("span",{children:[null==t?void 0:t.name," ",d("script_resource")]}),visible:i,onOk:s,onCancel:r,children:(0,n.jsxs)(u.Z,{className:"w-full",direction:"vertical",children:[(0,n.jsx)(u.Z,{className:"!flex justify-end",children:(0,n.jsx)(er.Z,{focusLock:!0,title:d("confirm_clear_resource"),onOk:()=>{o(e=>(e.forEach(e=>{h.deleteResource(e.url)}),g.Z.info({content:d("clear_success")}),[]))},children:(0,n.jsx)(m.Z,{type:"primary",status:"warning",children:d("clear")})})}),(0,n.jsx)(es.Z,{columns:p,data:a,rowKey:"id"})]})})};var ep=i(91891),em=i(62883),ef=i(26154),eg=i(79412);let ex=e=>{let{script:t}=e,i=new P.Ru,[r,s]=(0,l.useState)([]),[a,o]=(0,l.useState)([]),[c,d]=(0,l.useState)(""),[h,p]=(0,l.useState)(!1),[g,x]=(0,l.useState)(""),[y,v]=(0,l.useState)(!1),{t:b}=(0,T.$G)(),w=e=>{s(e),_()},j=e=>{o(e),_()},_=()=>{t&&i.get(t.uuid).then(e=>{var t,i,r,a;if(!e)return;let n=(null==(t=e.selfMetadata)?void 0:t.match)||e.metadata.match||[],l=new Map;null==(i=e.metadata.match)||i.forEach(e=>{l.set(e,!0)});let c=[];n.forEach((e,t)=>{c.push({id:t,match:e,byUser:!l.has(e),hasMatch:!1,isExclude:!1})}),s(c);let d=(null==(r=e.selfMetadata)?void 0:r.exclude)||e.metadata.exclude||[],u=new Map;null==(a=e.metadata.exclude)||a.forEach(e=>{u.set(e,!0)});let h=[];d.forEach((e,t)=>{let i=l.has(e);h.push({id:t,match:e,byUser:!u.has(e),hasMatch:i,isExclude:!0})}),o(h)})};(0,l.useEffect)(()=>{_()},[t]);let k=[{title:b("match"),dataIndex:"match",key:"match"},{title:b("user_setting"),dataIndex:"byUser",key:"byUser",width:100,render:e=>e?(0,n.jsx)("span",{style:{color:"#52c41a"},children:b("yes")}):(0,n.jsx)("span",{style:{color:"#c4751a"},children:b("no")})},{title:b("action"),render:(e,i)=>i.isExclude?(0,n.jsx)(u.Z,{children:(0,n.jsx)(er.Z,{title:`${b("confirm_delete_exclude")}${i.hasMatch?` ${b("after_deleting_match_item")}`:""}`,onOk:()=>{a.splice(a.indexOf(i),1),Q.PI.resetExclude(t.uuid,a.map(e=>e.match)).then(()=>{j([...a]),i.hasMatch&&(r.push(i),Q.PI.resetMatch(t.uuid,r.map(e=>e.match)).then(()=>{w([...r])}))})},children:(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,icon:(0,n.jsx)(el.Z,{})})})}):(0,n.jsx)(u.Z,{children:(0,n.jsx)(er.Z,{title:`${b("confirm_delete_match")}${i.byUser?"":` ${b("after_deleting_exclude_item")}`}`,onOk:()=>{r.splice(r.indexOf(i),1),Q.PI.resetMatch(t.uuid,r.map(e=>e.match)).then(()=>{w([...r]),i.byUser||(a.push(i),Q.PI.resetExclude(t.uuid,a.map(e=>e.match)).then(()=>{j([...a])}))})},children:(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,icon:(0,n.jsx)(el.Z,{})})})})}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(q.Z,{title:b("add_match"),visible:h,onCancel:()=>p(!1),onOk:()=>{c&&(r.push({id:Math.random(),match:c,byUser:!0,hasMatch:!1,isExclude:!1}),Q.PI.resetMatch(t.uuid,r.map(e=>e.match)).then(()=>{w([...r]),p(!1)}))},children:(0,n.jsx)(f.Z,{value:c,onChange:e=>{d(e)}})}),(0,n.jsx)(q.Z,{title:b("add_exclude"),visible:y,onCancel:()=>v(!1),onOk:()=>{g&&(a.push({id:Math.random(),match:g,byUser:!0,hasMatch:!1,isExclude:!0}),Q.PI.resetExclude(t.uuid,a.map(e=>e.match)).then(()=>{j([...a]),v(!1)}))},children:(0,n.jsx)(f.Z,{value:g,onChange:e=>{x(e)}})}),(0,n.jsxs)("div",{className:"flex flex-row justify-between pb-2",children:[(0,n.jsx)(eg.Z.Title,{heading:6,children:b("website_match")}),(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(m.Z,{type:"primary",size:"small",onClick:()=>{d(""),p(!0)},children:b("add_match")}),(0,n.jsx)(er.Z,{title:b("confirm_reset"),onOk:()=>{Q.PI.resetMatch(t.uuid,void 0).then(()=>{w([])})},children:(0,n.jsx)(m.Z,{type:"primary",size:"small",status:"warning",children:b("reset")})})]})]}),(0,n.jsx)(es.Z,{columns:k,data:r,rowKey:"id",pagination:!1}),(0,n.jsx)(em.Z,{}),(0,n.jsxs)("div",{className:"flex flex-row justify-between pb-2",children:[(0,n.jsx)(eg.Z.Title,{heading:6,children:b("website_exclude")}),(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(m.Z,{type:"primary",size:"small",onClick:()=>{x(""),v(!0)},children:b("add_exclude")}),(0,n.jsx)(er.Z,{title:b("confirm_reset"),onOk:()=>{Q.PI.resetExclude(t.uuid,void 0).then(()=>{j([])})},children:(0,n.jsx)(m.Z,{type:"primary",size:"small",status:"warning",children:b("reset")})})]})]}),(0,n.jsx)(es.Z,{columns:k,data:a,rowKey:"id",pagination:!1}),(0,n.jsx)(em.Z,{})]})},ey=e=>{let{script:t}=e,[i,r]=(0,l.useState)([]),[s,a]=(0,l.useState)(!1),[o,c]=(0,l.useState)(),{t:d}=(0,T.$G)(),h=[{title:d("type"),dataIndex:"permission",key:"permission",width:100},{title:d("permission_value"),dataIndex:"permissionValue",key:"permissionValue"},{title:d("allow"),dataIndex:"allow",key:"allow",render:(e,t)=>(0,n.jsxs)(C.Z,{value:e?"yes":"no",onChange:e=>{let s="yes"===e,a={...t,allow:s};Q.bd.updatePermission(a).then(()=>{g.Z.success(d("update_success")),r(i.map(e=>e.permission===t.permission&&e.permissionValue===t.permissionValue?{...e,allow:s}:e))}).catch(()=>{g.Z.error(d("save_failed"))})},style:{width:80},children:[(0,n.jsx)(C.Z.Option,{value:"yes",children:(0,n.jsx)("span",{style:{color:"#52c41a"},children:d("yes")})}),(0,n.jsx)(C.Z.Option,{value:"no",children:(0,n.jsx)("span",{style:{color:"#f5222d"},children:d("no")})})]})},{title:d("action"),render:(e,s)=>(0,n.jsx)(u.Z,{children:(0,n.jsx)(er.Z,{title:d("confirm_delete_permission"),onOk:()=>{Q.bd.deletePermission(t.uuid,s.permission,s.permissionValue).then(()=>{g.Z.success(d("delete_success")),r(i.filter(e=>e.permission!=s.permission||e.permissionValue!=s.permissionValue))}).catch(()=>{g.Z.error(d("delete_failed"))})},children:(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,icon:(0,n.jsx)(el.Z,{})})})})}];return(0,l.useEffect)(()=>{t&&Q.bd.getScriptPermissions(t.uuid).then(e=>{r(e)})},[t]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(q.Z,{title:d("add_permission"),visible:s,onCancel:()=>a(!1),onOk:()=>{o&&(i.push({uuid:t.uuid,permission:o.permission,permissionValue:o.permissionValue,allow:o.allow,createtime:Date.now(),updatetime:0}),Q.bd.addPermission(o).then(()=>{r([...i]),a(!1)}))},children:(0,n.jsxs)(u.Z,{className:"w-full",direction:"vertical",children:[(0,n.jsxs)(C.Z,{value:null==o?void 0:o.permission,onChange:e=>{o&&c({...o,permission:e})},children:[(0,n.jsx)(C.Z.Option,{value:"cors",children:d("permission_cors")}),(0,n.jsx)(C.Z.Option,{value:"cookie",children:d("permission_cookie")})]}),(0,n.jsx)(f.Z,{value:null==o?void 0:o.permissionValue,onChange:e=>{o&&c({...o,permissionValue:e})}}),(0,n.jsx)(ef.Z,{checked:null==o?void 0:o.allow,onChange:e=>{o&&c({...o,allow:e})},children:d("allow")})]})}),(0,n.jsxs)("div",{className:"flex flex-row justify-between pb-2",children:[(0,n.jsx)(eg.Z.Title,{heading:6,children:d("permission_management")}),(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(m.Z,{type:"primary",size:"small",onClick:()=>{c({uuid:t.uuid,permission:"cors",permissionValue:"",allow:!0,createtime:0,updatetime:0}),a(!0)},children:d("add_permission")}),(0,n.jsx)(er.Z,{title:d("confirm_reset"),onOk:()=>{Q.bd.resetPermission(t.uuid).then(()=>{r([])})},children:(0,n.jsx)(m.Z,{type:"primary",size:"small",status:"warning",children:d("reset")})})]})]}),(0,n.jsx)(es.Z,{columns:h,data:i,rowKey:"id",pagination:!1})]})};Error("browserNoSupport");let ev=e=>{let{script:t,visible:i,onCancel:r,onOk:s}=e,a=new P.Ru,[o,c]=(0,l.useState)(""),[d,u]=(0,l.useState)(!1),[h,p]=(0,l.useState)("all"),{t:m}=(0,T.$G)();return(0,l.useEffect)(()=>{t&&a.get(t.uuid).then(e=>{var t;if(!e)return;c(e.downloadUrl||""),u(!1!==e.checkUpdate);let i=e.metadata;e.selfMetadata&&(i=function(e,t){let i={...e};if(!t)return i;for(let e of Object.keys(t)){let r=t[e];i[e]=r?[...r]:void 0}return i}(i,e.selfMetadata)),p((null==(t=i["run-in"])?void 0:t[0])||"all")})},[t]),(0,n.jsxs)(ei.Z,{width:600,title:(0,n.jsxs)("span",{children:[null==t?void 0:t.name," ",m("script_setting")]}),autoFocus:!1,focusLock:!1,visible:i,onOk:()=>{s()},onCancel:()=>{r()},children:[(0,n.jsx)(ep.Z,{column:1,title:m("basic_info"),data:[{label:m("last_updated"),value:(0,O.F)(((null==t?void 0:t.updatetime)||(null==t?void 0:t.createtime)||0)/1e3)},{label:"UUID",value:null==t?void 0:t.uuid}],style:{marginBottom:20},labelStyle:{paddingRight:36}}),(0,n.jsx)(em.Z,{}),(0,n.jsx)(ep.Z,{column:1,title:m("script_setting"),data:[{label:m("script_run_env.title"),value:(0,n.jsx)(C.Z,{value:h,options:[{label:m("script_run_env.default"),value:"default"},{label:m("script_run_env.all"),value:"all"},{label:m("script_run_env.normal-tabs"),value:"normal-tabs"},{label:m("script_run_env.incognito-tabs"),value:"incognito-tabs"}],onChange:e=>{p(e),Q.PI.updateMetadata(t.uuid,"run-in","default"===e?[]:[e]).then(()=>{g.Z.success(m("update_success"))})}})}],style:{marginBottom:20},labelStyle:{paddingRight:36}}),(0,n.jsx)(em.Z,{}),t&&(0,n.jsx)(ex,{script:t}),(0,n.jsx)(ep.Z,{column:1,title:m("update"),data:[{label:m("check_update"),value:(0,n.jsx)(ef.Z,{checked:d,onChange:e=>{u(e),Q.PI.setCheckUpdateUrl(t.uuid,e,o).then(()=>{g.Z.success(m("update_success"))})}})},{label:m("update_url"),value:(0,n.jsx)(f.Z,{value:o,onChange:e=>{c(e)},onBlur:()=>{Q.PI.setCheckUpdateUrl(t.uuid,d,o).then(()=>{g.Z.success(m("update_success"))})}})}],style:{marginBottom:20},labelStyle:{paddingRight:36}}),(0,n.jsx)(em.Z,{}),t&&(0,n.jsx)(ey,{script:t})]})};var eb=i(30159),ew=i(20202);let{Row:ej,Col:e_}=A.Z,ek=l.memo(e=>{let{id:t,script:i,code:r,hotKeys:s,callbackEditor:a,onChange:o,className:c}=e,[d,u]=(0,l.useState)(),h=(0,l.useCallback)(e=>{e&&e.editor&&!d&&u(e)},[d]);return(0,l.useEffect)(()=>{if(d&&d.editor)return d.editor.uuid||(d.editor.uuid=i.uuid),s.forEach(e=>{d.editor.addAction({id:e.id,label:e.title,keybindings:[e.hotKey],run(t){e.action(i,t)}})}),d.editor.onKeyUp(()=>{o(d.editor.getValue()||"")}),a(d.editor),()=>{d.editor.dispose()}},[null==d?void 0:d.editor]),(0,n.jsx)(z,{id:t,ref:h,className:c,code:r,diffCode:"",editable:!0},t)},(e,t)=>e.script.uuid===t.script.uuid),eZ=async(e,t,i)=>{let r="";switch(e){case"background":r="// ==UserScript==\n// @name         New Userscript\n// @namespace    https://docs.scriptcat.org/\n// @version      0.1.0\n// @description  try to take over the world!\n// @author       You\n// @background\n// ==/UserScript==\n\nreturn new Promise((resolve, reject) => {\n    // Your code here...\n    resolve();\n});\n",r=(0,ew.kq)(r);break;case"crontab":r="// ==UserScript==\n// @name         New Userscript\n// @namespace    https://docs.scriptcat.org/\n// @version      0.1.0\n// @description  try to take over the world!\n// @author       You\n// @crontab      * * once * *\n// ==/UserScript==\n\nreturn new Promise((resolve, reject) => {\n    // Your code here...\n    resolve();\n});\n",r=(0,ew.kq)(r);break;default:{r="// ==UserScript==\n// @name         New Userscript\n// @namespace    https://docs.scriptcat.org/\n// @version      0.1.0\n// @description  try to take over the world!\n// @author       You\n// @match        {{match}}\n// @icon         {{icon}}\n// @grant        none\n// ==/UserScript==\n\n(function() {\n    'use strict';\n\n    // Your code here...\n})();\n";let[e,t]="initial"===i?await new Promise(e=>{chrome.storage.local.get(["activeTabUrl"],t=>{let i=chrome.runtime.lastError,r="https://*/*",s="";if(i)console.error("chrome.runtime.lastError in chrome.storage.local.get:",i),chrome.storage.local.remove(["activeTabUrl"]);else{var a;chrome.storage.local.remove(["activeTabUrl"]);let e=null==t||null==(a=t.activeTabUrl)?void 0:a.url;if(e)try{let{protocol:t,pathname:i,hostname:a}=new URL(e);t&&i&&a&&(r=`${t}//${a}${i}`,("http:"===t||"https:"===t)&&(s=`https://www.google.com/s2/favicons?sz=64&domain=${a}`))}catch{}}e([r,s])})}):["https://*/*",""];r=(0,ew.kq)(r),r=t?(r=r.replace("{{match}}",e)).replace("{{icon}}",t):(r=r.replace("{{match}}",e)).replace(/[\r\n]*[^\r\n]*\{\{icon\}\}[^\r\n]*/,"")}}let{script:s}=await (0,Y.zg)(r,"",(0,J.Z)());return s.createtime=0,{script:s,code:r,active:!0,hotKeys:t,isChanged:!1}},eC=()=>(confirm(eb.ZP.t("script_modified_leave_confirm"))?(window.history.back(),window.removeEventListener("popstate",eC)):window.history.pushState(null,"",window.location.href),!1),eS=function(){let[e,t]=(0,l.useState)({}),[i,r]=(0,l.useState)(""),[s,a]=(0,l.useState)(!1),[o,c]=(0,l.useState)([]),[d,u]=(0,l.useState)([]),[h,p]=(0,l.useState)(),[x,y]=(0,l.useState)(""),[v,b]=(0,l.useState)(),[w,j]=(0,l.useState)(!1),[_,k]=(0,l.useState)(!1),Z=(0,N.UO)(),[C,S]=(0,N.lr)(),{t:$}=(0,T.$G)(),E=new P.Ru,O=new P.Gf,D=(i,r)=>{for(let t of Object.keys(e))e[t]=!1;e[i]=r,t({...e})},R=(e,t)=>{let i=t.getValue(),r=e.uuid;return(0,Y.zg)(i,e.origin||"",r).then(t=>{let{script:s,oldScript:a}=t;if(r){if(0!==e.createtime&&(!a||a.uuid!==r))return g.Z.warning("The editing script does not exist."),Promise.reject(Error("The editing script does not exist."));e.createtime=Date.now(),s.createtime=e.createtime}return s.name?Q.PI.install(s,i).then(e=>{if(e){let e=s.uuid,t=s.name;u(i=>i.map(i=>i.uuid===e?{...i,name:t}:i)),g.Z.success($("save_success"))}else g.Z.success($("create_success_note")),u(e=>(y(s.uuid),[s,...e]));let t=s.uuid,r=s.name;return c(e=>e.map(e=>e.script.uuid===t?{...e,code:i,isChanged:!1,script:{...e.script,name:r}}:e)),s}).catch(e=>(g.Z.error(`${$("save_failed")}: ${e}`),Promise.reject(e))):(g.Z.warning($("script_name_cannot_be_set_to_empty")),Promise.reject(Error("script name cannot be empty")))}).catch(e=>(g.Z.error(`${$("invalid_script_code")}: ${e}`),Promise.reject(e)))},B=[{title:$("file"),items:[{id:"save",title:$("save"),hotKey:F.DC.CtrlCmd|F.VD.KeyS,hotKeyString:"Ctrl+S",action:R},{id:"saveAs",title:$("save_as"),hotKey:F.DC.CtrlCmd|F.DC.Shift|F.VD.KeyS,hotKeyString:"Ctrl+Shift+S",action:(e,t)=>new Promise(i=>{chrome.downloads.download({url:URL.createObjectURL(new Blob([t.getValue()],{type:"text/javascript"})),saveAs:!0,filename:`${e.name}.user.js`},()=>{chrome.runtime.lastError?(console.log($("save_as_failed")+": ",chrome.runtime.lastError),g.Z.error(`${$("save_as_failed")}: ${chrome.runtime.lastError.message}`)):g.Z.success($("save_as_success")),i()})})}]},{title:$("run"),items:[{id:"run",title:$("run"),hotKey:F.DC.CtrlCmd|F.VD.F5,hotKeyString:"Ctrl+F5",tooltip:$("only_background_scheduled_can_run"),action:async(e,t)=>{let i=await R(e,t);if(i.type===P.oO)return void g.Z.error($("only_background_scheduled_can_run"));g.Z.loading({id:"debug_script",content:$("preparing_script_resources"),duration:3e3}),Q._v.runScript(i.uuid).then(()=>{g.Z.success({id:"debug_script",content:$("build_success_message"),duration:3e3})}).catch(e=>{K.Z.logger(G.Z.E(e)).debug("run script error"),g.Z.error({id:"debug_script",content:`${$("build_failed")}: ${e}`,duration:3e3})})}}]},{title:$("tools"),items:[{id:"scriptStorage",title:$("script_storage"),tooltip:$("script_storage_tooltip"),action(e){D("scriptStorage",!0),p(e)}},{id:"scriptResource",title:$("script_resource"),tooltip:$("script_resource_tooltip"),action(e){D("scriptResource",!0),p(e)}}]},{title:$("settings"),tooltip:$("script_setting_tooltip"),action(e){D("scriptSetting",!0),p(e)}}],I=[],U="";for(let e=0;e<o.length;e+=1)if(o[e].active){U=e.toString();break}B.forEach(e=>{var t;null==(t=e.items)||t.forEach(e=>{e.hotKey&&I.push({id:e.id,title:e.title,hotKey:e.hotKey,action:e.action})})}),(0,l.useEffect)(()=>{let[e]=[w];if(!e){j(!0);let e=new URLSearchParams(C);e.get("d")&&(e.delete("d"),S(e,{replace:!0})),E.all().then(e=>{u(e.sort((e,t)=>e.sort-t.sort)),k(!0)})}return()=>{document.title="Home - ScriptCat"}},[]);let z=(0,l.useMemo)(()=>`${Z.uuid||""}|${C.get("template")||""}|${C.get("target")||""}|${C.get("d")||""}`,[Z,C]);(0,l.useEffect)(()=>{if(!_)return;let[e,t,i,r]=z.split("|");if(r)return;let s=new URLSearchParams(C);if(s.set("d",`${Date.now()}`),S(s,{replace:!0}),e){let[t]=[d];for(let i=0;i<t.length;i+=1)if(t[i].uuid===e){O.findByUUID(e).then(e=>{let r=t[i].uuid;c(s=>s.some(e=>e.script.uuid===r)?s.map(e=>e.script.uuid===r?{...e,active:!0}:{...e,active:!1}):[...s,{script:t[i],code:(null==e?void 0:e.code)||"",active:!0,hotKeys:I,isChanged:!1}]),y(r)});break}}else eZ(t||"",I,i||"blank").then(e=>{c(t=>{var i;t.forEach(e=>{e&&(e.active=!1)});let r=null==e||null==(i=e.script)?void 0:i.uuid;return r&&y(r),[...t,e]})})},[_,z]),(0,l.useEffect)(()=>{let e=!1;for(let t=0;t<o.length;t+=1)if(o[t].isChanged){e=!0;break}return e?(window.onbeforeunload=()=>!0,window.history.pushState(null,"",window.location.href),window.addEventListener("popstate",eC)):window.removeEventListener("popstate",eC),()=>{window.onbeforeunload=null}},[o]),(0,l.useEffect)(()=>{let e=0;if(v)switch(v.key){case"1":c(e=>{if(!((e=e.filter(e=>e.script.uuid!==v.uuid)).length>0))return[];if(v.selectSciptButtonAndTab===v.uuid)return e[0]={...e[0],active:!0},y(e[0].script.uuid),e;{let t=v.selectSciptButtonAndTab;return y(t),e.map(e=>e.script.uuid===t?{...e,active:!0}:{...e,active:!1})}});break;case"2":y(v.uuid),c(e=>e.filter(e=>e.script.uuid===v.uuid));break;case"3":c(t=>(t.some((t,i)=>{if(t.script.uuid===v.uuid)return e=i,!0}),t.slice(e)));break;case"4":c(t=>(t.some((t,i)=>{if(t.script.uuid===v.uuid)return e=i,!0}),t.slice(0,e+1)))}},[v]);let A=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c(i=>{let r=i.findIndex(t=>t.script.uuid===e);if(-1===r)return i;let s=i[r];if(t&&s.isChanged&&!confirm($("script_modified_close_confirm")))return i;if(1===i.length)return eZ(C.get("template")||"",I,"blank").then(e=>{c([e]),y(e.script.uuid)}),i;if(i=i.filter((e,t)=>t!==r),s.active&&i.length>0){let e;e=r>=i.length?i.length-1:r,i[e].active=!0,y(i[e].script.uuid)}return i})};return(0,l.useEffect)(()=>{o.forEach(e=>{e.active&&e.editor&&setTimeout(()=>{var t;null==(t=e.editor)||t.focus()},100)})},[U]),(0,n.jsxs)("div",{className:"h-full flex flex-col",style:{position:"relative",left:-10,top:-10,width:"calc(100% + 20px)",height:"calc(100% + 20px)"},children:[(0,n.jsx)(ec,{visible:e.scriptStorage,script:h,onOk:()=>{D("scriptStorage",!1)},onCancel:()=>{D("scriptStorage",!1)}}),(0,n.jsx)(eh,{visible:e.scriptResource,script:h,onOk:()=>{D("scriptResource",!1)},onCancel:()=>{D("scriptResource",!1)}}),(0,n.jsx)(ev,{visible:e.scriptSetting,script:h,onOk:()=>{D("scriptSetting",!1)},onCancel:()=>{D("scriptSetting",!1)}}),(0,n.jsx)("div",{className:"h-6",style:{borderBottom:"1px solid var(--color-neutral-3)",background:"var(--color-secondary)"},children:(0,n.jsx)("div",{className:"flex flex-row",children:B.map((e,t)=>e.items?(0,n.jsx)(M.Z,{droplist:(0,n.jsx)(L.Z,{style:{padding:"0",margin:"0",borderRadius:"0"},children:e.items.map((e,t)=>{let i=(0,n.jsxs)(m.Z,{style:{width:"100%",textAlign:"left",alignSelf:"center",verticalAlign:"middle"},size:"mini",onClick:()=>{c(t=>(t.forEach(t=>{t.active&&e.action(t.script,t.editor)}),t))},children:[(0,n.jsx)("div",{style:{minWidth:"70px",float:"left",fontSize:"14px"},children:e.title}),(0,n.jsx)("div",{style:{minWidth:"50px",float:"left",color:"rgb(165 165 165)",fontSize:"12px",lineHeight:"22px"},children:e.hotKeyString})]},`sm_${e.title}`);return(0,n.jsx)(L.Z.Item,{style:{height:"unset",padding:"0",lineHeight:"unset"},children:e.tooltip?(0,n.jsx)(H.Z,{position:"right",content:e.tooltip,children:i},`m${t.toString()}`):i},`m_${t.toString()}`)})}),trigger:"click",position:"bl",children:(0,n.jsx)(m.Z,{size:"mini",children:e.title},`m_${e.title}`)},`d_${t.toString()}`):(0,n.jsx)(m.Z,{size:"mini",onClick:()=>{c(t=>(t.forEach(t=>{t.active&&e.action&&e.action(t.script,t.editor)}),t))},children:e.title},`m_${e.title}`))})}),(0,n.jsxs)(ej,{className:"flex flex-grow flex-1",style:{overflow:"hidden"},children:[(0,n.jsx)(e_,{span:4,className:"h-full",style:{overflow:"scroll"},children:(0,n.jsxs)("div",{className:"flex flex-col",style:{backgroundColor:"var(--color-secondary)",overflow:"hidden"},children:[(0,n.jsx)(m.Z,{className:"text-left",size:"mini",style:{color:"var(--color-text-2)",background:"transparent",cursor:"pointer",borderBottom:"1px solid rgba(127, 127, 127, 0.8)"},onClick:()=>{a(!s),setTimeout(()=>{var e;return s&&(null==(e=document.querySelector("#editor_search_scripts_input"))?void 0:e.focus())},1)},children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[$("installed_scripts"),(0,n.jsx)(ea.Z,{style:{cursor:"inherit"}})]})}),s&&(0,n.jsx)("div",{className:"p-2",children:(0,n.jsx)(f.Z,{placeholder:$("search_scripts"),allowClear:!0,value:i,onChange:e=>r(e),size:"mini",id:"editor_search_scripts_input"})}),d.filter(e=>!i||(0,eb.ex)(e).toLowerCase().includes(i.toLowerCase())).map(e=>(0,n.jsxs)("div",{className:"relative group",style:{overflow:"hidden"},children:[(0,n.jsx)(m.Z,{size:"mini",className:"text-left w-full",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",backgroundColor:x===e.uuid?"gray":"",paddingRight:"32px"},onClick:()=>{y(e.uuid);let t=!1;for(let i=0;i<o.length;i+=1)o[i].script.uuid===e.uuid?(o[i].active=!0,t=!0):o[i].active=!1;t||O.findByUUID(e.uuid).then(t=>{if(!t)return;let i={script:e,code:t.code,active:!0,hotKeys:I,isChanged:!1};c(e=>[...e,i])})},children:(0,n.jsx)("span",{className:"overflow-hidden text-ellipsis",children:(0,eb.ex)(e)})}),(0,n.jsx)(m.Z,{type:"text",icon:(0,n.jsx)(el.Z,{}),iconOnly:!0,size:"mini",className:"absolute right-1 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",style:{width:"20px",height:"20px",minWidth:"20px",border:"none",background:"transparent",color:"var(--color-text-2)",boxShadow:"none"},onClick:t=>{t.stopPropagation(),q.Z.confirm({title:$("confirm_delete_script"),content:$("confirm_delete_script_content",{name:(0,eb.ex)(e)}),onOk:()=>{Q.PI.delete(e.uuid).then(()=>{u(t=>t.filter(t=>t.uuid!==e.uuid)),A(e.uuid),x===e.uuid&&y(""),g.Z.success($("delete_success"))}).catch(e=>{K.Z.logger(G.Z.E(e)).debug("delete script error"),g.Z.error(`${$("delete_failed")}: ${e}`)})}})}})]},`s_${e.uuid}`))]})}),(0,n.jsxs)(e_,{span:20,className:"flex! flex-col h-full",children:[(0,n.jsx)(W.Z,{editable:!0,activeTab:U,className:"edit-tabs",type:"card-gutter",style:{overflow:"inherit"},onChange:e=>{c(t=>t.map((t,i)=>`${i}`===e?{...t,active:(y(t.script.uuid),!0)}:{...t,active:!1}))},onAddTab:()=>{eZ(C.get("template")||"",I,"blank").then(e=>{c(t=>(t.forEach(e=>{e.active=!1}),y(e.script.uuid),[...t,e]))})},onDeleteTab:e=>{var t;let i=null==(t=o[parseInt(e,10)])?void 0:t.script.uuid;i&&A(i,!0)},children:o.map((e,t)=>(0,n.jsx)(V.Z,{destroyOnHide:!0,title:(0,n.jsx)(M.Z,{trigger:"contextMenu",position:"bl",droplist:(0,n.jsxs)(L.Z,{onClickMenuItem:t=>{b({...v,key:t,uuid:e.script.uuid,selectSciptButtonAndTab:x})},children:[(0,n.jsx)(L.Z.Item,{children:$("close_current_tab")},"1"),(0,n.jsx)(L.Z.Item,{children:$("close_other_tabs")},"2"),(0,n.jsx)(L.Z.Item,{children:$("close_left_tabs")},"3"),(0,n.jsx)(L.Z.Item,{children:$("close_right_tabs")},"4")]}),children:(0,n.jsx)("span",{style:{color:e.isChanged?"rgb(var(--orange-5))":e.script.uuid===x||e.active?"rgb(var(--green-7))":"var(--color-text-1)"},children:e.script.name})})},t.toString()))}),(0,n.jsx)("div",{className:"flex flex-grow flex-1",children:o.map(e=>(e.active&&(document.title=`${(0,eb.ex)(e.script)} - Script Editor`),(0,n.jsx)("div",{className:"w-full",style:{display:e.active?"block":"none"},children:(0,n.jsx)(ek,{className:"script-code-editor",id:`e_${e.script.uuid}`,script:e.script,code:e.code,hotKeys:e.hotKeys,callbackEditor:t=>{c(i=>i.map(i=>i.script.uuid===e.script.uuid?{...i,editor:(i.active&&setTimeout(()=>t.focus(),100),t)}:i))},onChange:t=>{c(i=>{let r=i.find(t=>t.script.uuid===e.script.uuid);if(!r)return i;let s=r.code!==t;return s!==r.isChanged?(r.isChanged=s,[...i]):i})}},`e_${e.script.uuid}`)},`fe_${e.script.uuid}`)))})]})]})]})};var e$=i(10056),eE=i(58341),eN=i(92305),eO=i(61097),eT=i(80097),eD=i(22491),eP=i(214),eF=i(88550),eR=i(26320),eB=i(11825),eI=i(91127),eU=i(41263),ez=i(7155),eA=i(61045),eM=i(22193);let eL=et.Z.Item,eH=e=>{let{script:t,userConfig:i,values:r}=e,s=(0,l.useRef)({}),[a,o]=l.useState(!0),[c,d]=l.useState(Object.keys(i)[0]);(0,l.useEffect)(()=>{d(Object.keys(i)[0]),o(!0)},[t,i]);let{t:h}=(0,T.$G)();return(0,n.jsx)(q.Z,{visible:a,title:`${t.name} ${h("config")}`,okText:(0,n.jsx)(eA.Z,{content:h("save_only_current_group"),children:h("save")}),cancelText:h("close"),onOk:()=>{if(s.current[c]){let e=s.current[c].getFieldsValue(),i=new ed.DN(R.yw);for(let r of Object.keys(e))for(let s of Object.keys(e[r]))void 0!==e[r][s]&&i.setScriptValue(t.uuid,`${r}.${s}`,e[r][s]);g.Z.success(h("save_success")),o(!1)}},onCancel:()=>{o(!1)},children:(0,n.jsx)(W.Z,{activeTab:c,onChange:e=>{d(e)},children:Object.keys(i).map(e=>{let a=i[e],l=Object.keys(a).sort((e,t)=>(a[e].index||0)-(a[t].index||0));return(0,n.jsx)(V.Z,{title:e,children:(0,n.jsx)(et.Z,{style:{width:"100%"},autoComplete:"off",layout:"vertical",initialValues:r,ref:t=>{s.current[e]=t},children:l.map(t=>(0,n.jsx)(eL,{label:a[t].title,field:`${e}.${t}`,children:()=>{let i=a[t],{type:l}=i;switch(!l&&(l="boolean"==typeof i.default?"checkbox":i.values?"object"==typeof i.values?"mult-select":"select":"number"==typeof i.default?"number":"text"),l){case"text":if(i.password)return(0,n.jsx)(f.Z.Password,{placeholder:i.description,maxLength:i.max});return(0,n.jsx)(f.Z,{placeholder:i.description,maxLength:i.max,showWordLimit:!0});case"number":return(0,n.jsx)(eM.Z,{placeholder:i.description,min:i.min,max:i.max,suffix:i.unit});case"checkbox":return(0,n.jsx)(ef.Z,{defaultChecked:r[`${e}.${t}`],children:i.description});case"select":case"mult-select":let o;if(i.bind){let e=i.bind.substring(1);o=r[e]?r[e]:[]}else o=i.values;return(0,n.jsx)(C.Z,{mode:"mult-select"===i.type?"multiple":void 0,placeholder:i.description,children:o.map(e=>(0,n.jsx)(C.Z.Option,{value:e,children:e},e))});case"textarea":return(0,n.jsx)(f.Z.TextArea,{placeholder:i.description,maxLength:i.max,rows:i.rows,showWordLimit:!0});case"switch":return(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(eE.Z,{defaultChecked:r[`${e}.${t}`],onChange:i=>{s.current[e].setFieldValue(`${e}.${t}`,i)}}),(0,n.jsx)("span",{children:i.description})]});default:return null}}},t))},t.uuid)},e)})})})};var eq=i(91088),eW=i(54867);class eV extends eW.M{findByScriptID(e){return this.get(e)}save(e){return this._save(e.uuid,e)}constructor(){var e;super("export"),(e="tableName")in this?Object.defineProperty(this,e,{value:"export",enumerable:!0,configurable:!0,writable:!0}):this[e]="export"}}var eJ=i(73878);async function eK(e,t){let i=t.split("\n"),r=[],s=await Q.wh.getScriptValue(e);for(let e=0;e<i.length;e+=1){let t=i[e];if(t.trim()){let e=t.split(",");for(let t=0;t<e.length;t+=1){let i=e[t].trim();i&&s[i]&&r.push(s[i])}}}return r}function eG(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class eY{exportCloud(e,t,i,r){return this.zip.file("userScript.js",t),this.zip.file("cookies.js",`exports.cookies = ${JSON.stringify(r)}`),this.zip.file("values.js",`exports.values = ${JSON.stringify(i)}`),this.zip.file("config.js",`export default ${JSON.stringify({version:eq.mr,uuid:e.uuid,overwrite:{value:this.params.overwriteValue,cookie:this.params.overwriteCookie}})}`),this.zip.file("package.json",'{\n  "name": "cloudcat-package",\n  "version": "1.0.0",\n  "description": "scriptcat后台脚本打包项目",\n  "main": "index.js",\n  "scripts": {\n    "run": "node index.js",\n    "test": "echo \\"Error: no test specified\\" && exit 1"\n  },\n  "author": "CodFrm",\n  "license": "MIT",\n  "dependencies": {\n    "scriptcat-nodejs": "^0.1.7"\n  }\n}\n'),this.zip.file("utils.js","const fs = require('fs');\nconst { ScriptCat } = require(\"scriptcat-nodejs/dist/src/scriptcat\");\nconst { ModelValues } = require(\"scriptcat-nodejs/dist/src/storage/values\");\nconst { cookies } = require('./cookies');\nconst { values } = require('./values');\n\nexports.run = function () {\n	const code = fs.readFileSync('userScript.js', 'utf8');\n\n	const run = new ScriptCat();\n	run.RunOnce(code, {\n		cookies: cookies,\n		values: new ModelValues(values),\n	}).then((res) => {\n		console.log(res);\n	});\n}\n"),this.zip.file("index.js","const utils = require('./utils');\n\nutils.run();\n"),Promise.resolve()}constructor(e){eG(this,"zip",void 0),eG(this,"params",void 0),this.zip=e.zip,this.params=e}}class eQ{static create(e,t){if("local"===e)return new eY(t);throw Error(`unknown type ${e}`)}static params(){return{local:{}}}}var eX=i(72524),e0=i.n(eX);let e1=et.Z.Item;function e2(e){return{exportValue:e.metadata.exportvalue&&e.metadata.exportvalue[0],exportCookie:e.metadata.exportcookie&&e.metadata.exportcookie[0]}}let e6=e=>{let{script:t,onClose:i}=e,[r]=et.Z.useForm(),[s,a]=l.useState(!1),[o,c]=l.useState("local"),[,d]=l.useState(),{t:u}=(0,T.$G)(),h=[{key:"local",name:u("local")}];return(0,l.useEffect)(()=>{t&&(a(!0),new eV().findByScriptID(t.uuid).then(e=>{d(e),e&&e.params[e.target]?(c(e.target),r.setFieldsValue(e.params[e.target])):(c("local"),r.setFieldsValue(e2(t)))}))},[t]),(0,n.jsx)(q.Z,{title:(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{style:{height:"32px",lineHeight:"32px"},children:[null==t?void 0:t.name," ",u("upload_to_cloud")]}),(0,n.jsx)(m.Z,{type:"text",icon:(0,n.jsx)(eJ.Z,{style:{margin:0}}),href:`${eq.RE}${eb.rN}/docs/dev/cloudcat/`,target:"_blank",iconOnly:!0})]}),okText:u("export"),visible:s,onCancel:()=>{a(!1),i()},onConfirm:async()=>{let e=new eV,i=r.getFieldsValue();if(!i||!t)return;d(r=>(r||(r={uuid:t.uuid,target:"local",params:{}}),r.params[o]=i,r.target=o,e.save(r).catch(e=>{g.Z.error(`${u("save_failed")}: ${e}`)}),r)),g.Z.info(u("exporting"));let s=await eK(t,i.exportValue),a=await function(e){let t=e.split("\n"),i=[];for(let e=0;e<t.length;e+=1){let r=t[e],s={};if(r.trim()){for(let e of r.split(";")){let t=e.split("=");2===t.length&&(s[t[0].trim()]=t[1].trim())}(s.url||s.domain)&&i.push(new Promise(e=>{(function(e){return new Promise(t=>{chrome.cookies.getAll(e,e=>{let i=chrome.runtime.lastError;i&&console.error("chrome.runtime.lastError in chrome.cookies.getAll:",i),t(e)})})})(s).then(t=>{s.cookies=t,e(s)})}))}}return Promise.all(i)}(i.exportCookie);if("local"===o){let e=new(e0()),r=eQ.create("local",{zip:e,...i}),n=await new P.Gf().findByUUID(t.uuid);if(!n)return void g.Z.error(u("invalid_script_code"));r.exportCloud(t,n.code,s,a);let l=await e.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9},comment:"Created by Scriptcat"}),o=URL.createObjectURL(l);setTimeout(()=>{URL.revokeObjectURL(o)},3e4),chrome.downloads.download({url:o,saveAs:!0,filename:`${t.uuid}.zip`})}},children:(0,n.jsxs)(et.Z,{autoComplete:"off",style:{width:"100%"},layout:"vertical",form:r,children:[(0,n.jsx)(e1,{label:u("upload_to"),children:(0,n.jsx)(C.Z,{value:o,onChange:e=>{c(e)},children:h.map(e=>(0,n.jsx)(C.Z.Option,{value:e.key,children:e.name},e.key))})}),(0,n.jsx)(e1,{label:u("value_export_expression"),field:"exportValue",children:(0,n.jsx)(f.Z.TextArea,{})}),(0,n.jsx)(e1,{label:"",field:"overwriteValue",children:(0,n.jsx)(ef.Z,{children:u("overwrite_original_value_on_import")})}),(0,n.jsx)(e1,{label:u("cookie_export_expression"),field:"exportCookie",children:(0,n.jsx)(f.Z.TextArea,{})}),(0,n.jsx)(e1,{label:"",field:"overwriteCookie",children:(0,n.jsx)(ef.Z,{children:u("overwrite_original_cookie_on_import")})}),(0,n.jsx)(m.Z,{type:"primary",onClick:()=>{t&&r.setFieldsValue(e2(t))},children:u("restore_default_values")})]})})};var e4=i(24922);function e5(e){return v()().to(v()(e))}var e8=i(21192),e3=i(81443),e9=i(60853),e7=i(3272);function te(e){let t,{script:i}=e,{t:r}=(0,T.$G)();return i.metadata.homepageurl||(t=function(e){try{if(e.includes("scriptcat.org")){let t=e.split("/")[5];return(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,size:"small",target:"_blank",href:`https://scriptcat.org/script-show-page/${t}`,children:(0,n.jsx)("img",{width:16,height:16,src:"/assets/logo.png",alt:""})})}if(e.includes("greasyfork.org")){let t=e.split("/")[4];return(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,size:"small",target:"_blank",href:`https://greasyfork.org/scripts/${t}`,children:(0,n.jsx)("img",{width:16,height:16,src:"/assets/logo/gf.png",alt:""})})}if(e.includes("raw.githubusercontent.com")||e.includes("github.com")){let t=`${e.split("/")[3]}/${e.split("/")[4]}`;return(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,size:"small",target:"_blank",href:`https://github.com/${t}`,style:{color:"var(--color-text-1)"},icon:(0,n.jsx)(e8.Z,{})})}}catch(e){console.error(e)}}(i.downloadUrl||"")),(0,n.jsxs)(u.Z,{size:"mini",children:[t&&(0,n.jsx)(H.Z,{content:r("homepage"),children:t}),i.metadata.homepage&&(0,n.jsx)(H.Z,{content:r("homepage"),children:(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,icon:(0,n.jsx)(e3.Z,{}),size:"small",href:i.metadata.homepage[0],target:"_blank"})}),i.metadata.homepageurl&&(0,n.jsx)(H.Z,{content:r("homepage"),children:(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,icon:(0,n.jsx)(e3.Z,{}),size:"small",href:i.metadata.homepageurl[0],target:"_blank"})}),i.metadata.website&&(0,n.jsx)(H.Z,{content:r("script_website"),children:(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,icon:(0,n.jsx)(e3.Z,{}),size:"small",href:i.metadata.website[0],target:"_blank"})}),i.metadata.source&&(0,n.jsx)(H.Z,{content:r("script_source"),children:(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,icon:(0,n.jsx)(e9.Z,{}),size:"small",href:i.metadata.source[0],target:"_blank"})}),i.metadata.supporturl&&(0,n.jsx)(H.Z,{content:r("bug_feedback_script_support"),children:(0,n.jsx)(m.Z,{type:"text",iconOnly:!0,icon:(0,n.jsx)(e7.Z,{}),size:"small",href:i.metadata.supporturl[0],target:"_blank"})})]})}function tt(e){let{script:t,size:i=32,style:r}=e;(r=r||{}).display=r.display||"inline-block",r.marginRight=r.marginRight||"8px";let s="";return(t.metadata.icon?[s]=t.metadata.icon:t.metadata.iconurl?[s]=t.metadata.iconurl:t.metadata.icon64?[s]=t.metadata.icon64:t.metadata.icon64url&&([s]=t.metadata.icon64url),s)?(0,n.jsx)(e$.Z,{size:i||32,shape:"square",style:r,children:(0,n.jsx)("img",{src:s,alt:null==t?void 0:t.name})}):(0,n.jsx)(n.Fragment,{})}var ti=i(17969);async function tr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=new Map;for(let r of[...e,...t]){let e=function(e){try{let t=e.match(/^(http|https|\*):\/\/([^/]+)(?:\/(.*))?$/);if(t){let e=t[2];for(;e.endsWith("*");)e=e.slice(0,-1);for(;e.includes("*");){let t=e.lastIndexOf("*");e=e.slice(t+1)}for(;e.startsWith(".");)e=e.slice(1);return e}if(e.startsWith("http://")||e.startsWith("https://"))return new URL(e).hostname;let i=e.match(/([a-z0-9][-a-z0-9]*\.)+[a-z0-9][-a-z0-9]*/i);return i?i[0]:null}catch{return null}}(r);e?i.set(e,{match:r,domain:e}):i.set(r,{match:r,domain:""})}let r=Array.from(i.values()),s=[],a=r.map(async e=>{try{if(e.domain){var t;let i,r=await (t=e.domain,(i=ts.get(t))||(i=R.jp.getFaviconFromDomain(t).then(e=>{if(e.ok)return e.res;let t=e.err;return 11===t.errType||12===t.errType?console.log(`${t.message}`):console.error((e=>{let{name:t}=e;return new({[t]:class extends Error{constructor(e){super(e),this.name=t}}})[t](e.message)})(t)),[]}),ts.set(t,i)),i);r.length>0?s.push({match:e.match,website:"http://"+e.domain,icon:r[0]}):s.push({match:e.match,website:"http://"+e.domain,icon:""})}else s.push({match:e.match,website:"",icon:""})}catch(t){console.error(`Failed to fetch favicon for ${e.domain||e.match}:`,t)}});return await Promise.all(a),s.slice()}let ts=new Map;var ta=i(35305),tn=i(89155),tl=i(87594);let to=async e=>{let t=`${tl.J_}${e.uuid}`;return{uuid:e.uuid,fav:await tn.V.getOrSet(t,async()=>{let t=await tr(e.metadata.match||[],e.metadata.include||[]);if(0===t.length)return[];let i=new ed.o1(R.yw);return await Promise.all(t.map(async e=>{let t="";if(e.icon)try{t=await i.loadFavicon(e.icon)}catch(e){}return{match:e.match,website:e.website,icon:t}}))})}},tc=(0,l.createContext)(null),td=(0,l.createContext)(null),tu=l.memo(e=>{let{match:t,icon:i,website:r,...s}=e;return(0,n.jsx)(e$.Z,{shape:"square",style:{backgroundColor:"unset",borderWidth:1},className:r?"cursor-pointer":"cursor-default",...s,children:i?(0,n.jsx)("img",{title:t,src:i}):(0,n.jsx)(eO.rVp,{title:t,color:"#aaa",size:24})})});tu.displayName="MemoizedAvatar";let th=e=>{let{record:t,index:i,...r}=e,s=(0,eI.nB)({id:t.uuid}),{setNodeRef:a,transform:l,transition:o}=s,c={transform:ez.ux.Transform.toString(l),transition:o};return(0,n.jsx)(tc.Provider,{value:s,children:(0,n.jsx)("tr",{ref:a,style:c,...r})})};th.displayName="DraggableRow";let tp=()=>{let e=(0,l.useContext)(tc);if(!e)return(0,n.jsx)(eT.Z,{style:{cursor:"move"}});let{listeners:t,setActivatorNodeRef:i}=e;return(0,n.jsx)(eT.Z,{...t,ref:i,style:{cursor:"move"}})},tm=l.forwardRef((e,t)=>{let i=(0,l.useContext)(td);if(!i)return(0,n.jsx)(n.Fragment,{});let{sensors:r,dispatch:s,scriptList:a}=i;return(0,n.jsx)(eB.LB,{sensors:r,collisionDetection:eB.pE,modifiers:[eU.DL],accessibility:{container:document.body},onDragEnd:e=>{let{active:t,over:i}=e;i&&t.id!==i.id&&s((0,Q.T3)({active:t.id,over:i.id}))},children:(0,n.jsx)(eI.Fo,{items:a.map(e=>({...e,id:e.uuid})),strategy:eI.qw,children:(0,n.jsx)("tbody",{...e,ref:t})})})});tm.displayName="DraggableContainer";let tf=l.memo(e=>{let{status:t,enableLoading:i,...r}=e;return(0,n.jsx)(eE.Z,{checked:t===P.Kv,loading:i,disabled:i,...r})});tf.displayName="EnableSwitch";let tg=function(){var e,t;let[i,r]=(0,l.useState)(),[s,a]=(0,l.useState)(),o=(0,ti.TL)(),c=(0,ti.CG)(Q.Wr),d=(0,l.useRef)(null),p=(0,N.s0)(),x=(0,N.lr)()[0].get("userConfig")||"",[y,v]=(0,l.useState)(!1),[w,j]=(0,l.useState)(""),[_,k]=(0,l.useState)([]),[Z,S]=(0,l.useState)(0),[$,E]=(0,l.useState)(null),{t:O}=(0,T.$G)(),D=new Map,F=e=>{if(D.clear(),null!==e)for(let t of e)D.set(t.uuid,{code:!0===t.code,name:!0===t.name,auto:!0===t.auto})},B=(0,eB.Dy)((0,eB.VT)(eB.we),(0,eB.VT)(eB.Lg,{coordinateGetter:eI.is})),I=(0,l.useMemo)(()=>({sensors:B,scriptList:c,dispatch:o}),[B,c,o]);(0,l.useEffect)(()=>{o((0,Q.yb)()).then(e=>{Q.yb.fulfilled.match(e)&&(e=>{let t=[],i=!1;for(let r of e)to(r).then(e=>{t.push(e),i||(requestAnimationFrame(()=>{if(i=!1,!t.length)return;let e=t.slice(0);t.length=0,ta.h.dispatch(Q.g4.actions.setScriptFavicon(e))}),i=!0)})})(e.payload)})},[o]);let U=(0,l.useMemo)(()=>[{title:"#",dataIndex:"sort",width:60,key:"#",sorter:(e,t)=>e.sort-t.sort,render:e=>e<0?"-":e+1},{key:"title",title:O("enable"),width:O("script_list_enable_width"),dataIndex:"status",className:"script-enable",sorter:(e,t)=>e.status-t.status,filters:[{text:O("enable"),value:P.Kv},{text:O("disable"),value:P.J7}],onFilter:(e,t)=>t.status===e,render:(e,t)=>(0,n.jsx)(tf,{status:t.status,enableLoading:t.enableLoading,onChange:e=>{o((0,Q.fe)({uuid:t.uuid,enable:e}))}})},{key:"name",title:O("name"),dataIndex:"name",sorter:(e,t)=>e.name.localeCompare(t.name),filterIcon:(0,n.jsx)(ea.Z,{}),filterDropdown:e=>{let{filterKeys:t,setFilterKeys:i,confirm:r}=e;return t.length||(t=[{type:"auto",value:""}]),(0,n.jsxs)("div",{className:"arco-table-custom-filter flex flex-row gap-2",children:[(0,n.jsxs)(C.Z,{className:"flex-1",triggerProps:{autoAlignPopupWidth:!1,autoAlignPopupMinWidth:!0,position:"bl"},size:"small",value:t[0].type||"auto",onChange:e=>{if(e!==t[0].type){if(t[0].type=e,!t[0].value){F(null),i([...t]);return}o((0,Q.Jg)({type:e,value:t[0].value})).unwrap().then(r=>{t[0].type===e&&(F(r),i([...t]))})}},children:[(0,n.jsx)(C.Z.Option,{value:"auto",children:O("auto")}),(0,n.jsx)(C.Z.Option,{value:"name",children:O("name")}),(0,n.jsx)(C.Z.Option,{value:"script_code",children:O("script_code")})]}),(0,n.jsx)(f.Z.Search,{ref:d,size:"small",searchButton:!0,style:{minWidth:240},placeholder:O("enter_search_value",{search:"auto"==t[0].type?`${O("name")}/${O("script_code")}`:O("")}),value:t[0].value||"",onChange:e=>{if(e!==t[0].value){if(t[0].value=e,!t[0].value){F(null),i([...t]);return}o((0,Q.Jg)({value:e,type:t[0].type})).unwrap().then(r=>{t[0].value===e&&(F(r),i([...t]))})}},onSearch:()=>{r()}})]})},onFilter:(e,t)=>{if(!e||!e.value)return!0;let i=D.get(t.uuid);if(!i)return!1;switch(e.type){case"auto":return i.auto;case"script_code":return i.code;case"name":return i.name;default:return!1}},onFilterDropdownVisibleChange:e=>{e&&setTimeout(()=>d.current.focus(),1)},className:"max-w-[240px] min-w-[100px]",render:(e,t)=>(0,n.jsx)(H.Z,{content:e,position:"tl",children:(0,n.jsx)(N.rU,{to:`/script/editor/${t.uuid}`,style:{textDecoration:"none"},children:(0,n.jsxs)(b.Z,{style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:"20px"},children:[(0,n.jsx)(tt,{script:t,size:20}),(0,eb.ex)(t)]})})})},{title:O("version"),dataIndex:"version",key:"version",width:120,align:"center",render:(e,t,i)=>t.metadata.version&&t.metadata.version[0]},{key:"apply_to_run_status",title:O("apply_to_run_status"),width:O("script_list_apply_to_run_status_width"),className:"apply_to_run_status",render:(e,t,i)=>{if(t.type===P.oO)return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(e$.Z.Group,{size:20,children:[t.favorite&&[...t.favorite].sort((e,t)=>e.icon&&!t.icon?-1:!e.icon&&t.icon?1:e.match.localeCompare(t.match)).slice(0,4).map(e=>(0,n.jsx)(tu,{...e,onClick:()=>{e.website&&window.open(e.website,"_blank")}},`${e.match}_${e.icon}_${e.website}`)),t.favorite&&t.favorite.length>4&&"..."]})});let r="";return r=t.type===P.BW?O("background_script_tooltip"):`${O("scheduled_script_tooltip")} ${(0,e4.R)(t.metadata.crontab[0])}`,(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(H.Z,{content:r,children:(0,n.jsx)(eN.Z,{icon:(0,n.jsx)(eD.Z,{}),color:"blue",bordered:!0,style:{cursor:"pointer"},onClick:()=>{p({pathname:"logger",search:`query=${encodeURIComponent(JSON.stringify([{key:"uuid",value:t.uuid},{key:"component",value:"GM_log"}]))}`})},children:t.runStatus===P.of?O("running"):O("completed")})})})}},{title:O("source"),dataIndex:"origin",key:"origin",width:100,render:(e,t)=>t.subscribeUrl?(0,n.jsx)(H.Z,{content:(0,n.jsx)("p",{style:{margin:0},children:`${O("subscription_link")}: ${decodeURIComponent(t.subscribeUrl)}`}),children:(0,n.jsx)(eN.Z,{icon:(0,n.jsx)(eP.Z,{}),color:"orange",bordered:!0,style:{cursor:"pointer"},children:O("subscription_installation")})}):t.origin?(0,n.jsx)(H.Z,{content:(0,n.jsx)("p",{style:{margin:0,padding:0},children:`${O("script_link")}: ${decodeURIComponent(t.origin)}`}),children:(0,n.jsx)(eN.Z,{icon:(0,n.jsx)(eF.Z,{color:""}),color:"green",bordered:!0,style:{cursor:"pointer"},children:O("user_installation")})}):(0,n.jsx)(eN.Z,{icon:(0,n.jsx)(en.Z,{}),color:"purple",bordered:!0,style:{cursor:"pointer"},children:O("manually_created")})},{title:O("home"),dataIndex:"home",align:"center",key:"home",width:100,render:(e,t)=>(0,n.jsx)(te,{script:t})},{title:O("last_updated"),dataIndex:"updatetime",align:"center",key:"updatetime",width:O("script_list_last_updated_width"),sorter:(e,t)=>e.updatetime-t.updatetime,render:(e,t)=>(0,n.jsx)(H.Z,{content:O("check_update"),position:"tl",children:(0,n.jsx)(b.Z,{style:{cursor:"pointer"},onClick:()=>{if(!t.checkUpdateUrl)return void g.Z.warning(O("update_not_supported"));g.Z.info({id:"checkupdate",content:O("checking_for_updates")}),Q.PI.requestCheckUpdate(t.uuid).then(e=>{e?g.Z.warning({id:"checkupdate",content:O("new_version_available")}):g.Z.success({id:"checkupdate",content:O("latest_version")})}).catch(e=>{g.Z.error({id:"checkupdate",content:`${O("update_check_failed")}: ${e.message}`})})},children:e5(new Date(e))})})},{title:O("action"),dataIndex:"action",key:"action",width:160,render:(e,t)=>(0,n.jsxs)(m.Z.Group,{children:[(0,n.jsx)(N.rU,{to:`/script/editor/${t.uuid}`,children:(0,n.jsx)(m.Z,{type:"text",icon:(0,n.jsx)(eR.yjk,{}),style:{color:"var(--color-text-2)"}})}),(0,n.jsx)(er.Z,{title:O("confirm_delete_script"),icon:(0,n.jsx)(eR.w6k,{}),onOk:()=>{o((0,Q.NX)(t.uuid))},children:(0,n.jsx)(m.Z,{type:"text",icon:(0,n.jsx)(eR.w6k,{}),loading:t.actionLoading,style:{color:"var(--color-text-2)"}})}),t.config&&(0,n.jsx)(m.Z,{type:"text",icon:(0,n.jsx)(eR.BUe,{}),onClick:()=>{new ed.DN(R.yw).getScriptValue(t).then(e=>{r({userConfig:{...t.config},script:t,values:e})})},style:{color:"var(--color-text-2)"}}),t.type!==P.oO&&(0,n.jsx)(m.Z,{type:"text",icon:t.runStatus===P.of?(0,n.jsx)(eR.Q1g,{}):(0,n.jsx)(eR.qfg,{}),loading:t.actionLoading,onClick:async()=>{t.runStatus===P.of?(g.Z.loading({id:"script-stop",content:O("stopping_script")}),await o((0,Q.vb)(t.uuid)).unwrap(),g.Z.success({id:"script-stop",content:O("script_stopped"),duration:3e3})):(g.Z.loading({id:"script-run",content:O("starting_script")}),await o((0,Q.hQ)(t.uuid)).unwrap(),g.Z.success({id:"script-run",content:O("script_started"),duration:3e3}))},style:{color:"var(--color-text-2)"}}),t.metadata.cloudcat&&(0,n.jsx)(m.Z,{type:"text",icon:(0,n.jsx)(eR.yWV,{}),onClick:()=>{a(t)},style:{color:"var(--color-text-2)"}})]})}],[O,o,d,p]),[z,A]=(0,l.useState)([]);(0,l.useEffect)(()=>{x&&new P.Ru().get(x).then(e=>{e&&e.config&&new ed.DN(R.yw).getScriptValue(e).then(t=>{r({script:e,userConfig:e.config,values:t})})}),R.RH.getScriptListColumnWidth().then(e=>{E({...e})})},[]);let[q,W]=(0,l.useState)(!1);(0,l.useEffect)(()=>{null!==$&&(A(e=>{let t=U.map(e=>$[e.key]??e.width);return(e.length===t.length?e:U).map((e,i)=>{let r=t[i];return r===e.width?e:{...e,width:r}})}),W(!0))},[$]);let V=(0,l.useMemo)(()=>{if(!q)return[];{let e=z.filter(e=>-1!==e.width);return 0===e.length?U:e}},[z,q]),J=(e,t)=>{A(i=>i.map((i,r)=>r===e&&i.width!==t?{...i,width:t}:i))};return(0,n.jsx)(h.Z,{id:"script-list",className:"script-list",style:{height:"100%",overflowY:"auto"},children:(0,n.jsx)(td.Provider,{value:I,children:(0,n.jsxs)(u.Z,{direction:"vertical",children:[y&&(0,n.jsx)(h.Z,{children:(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center",style:{padding:"8px 6px"},children:[(0,n.jsxs)(u.Z,{direction:"horizontal",children:[(0,n.jsx)(eg.Z.Text,{children:O("batch_operations")+":"}),(0,n.jsxs)(C.Z,{style:{minWidth:"100px"},triggerProps:{autoAlignPopupWidth:!1,autoAlignPopupMinWidth:!0,position:"bl"},size:"mini",value:w,onChange:e=>{j(e)},children:[(0,n.jsx)(C.Z.Option,{value:"enable",children:O("enable")},"enable"),(0,n.jsx)(C.Z.Option,{value:"disable",children:O("disable")},"disable"),(0,n.jsx)(C.Z.Option,{value:"export",children:O("export")},"export"),(0,n.jsx)(C.Z.Option,{value:"delete",children:O("delete")},"delete"),(0,n.jsx)(C.Z.Option,{value:"pin_to_top",children:O("pin_to_top")},"pin_to_top"),(0,n.jsx)(C.Z.Option,{value:"check_update",children:O("check_update")},"check_update")]}),(0,n.jsx)(m.Z,{type:"primary",size:"mini",onClick:()=>{let e,t=e=>{let t=_.map(e=>e.uuid);o((0,Q.FU)({uuids:t,loading:!0})),Promise.allSettled(t.map(t=>Q.PI.enable(t,e))).finally(()=>{o((0,Q._Q)({uuids:t,enable:e})),o((0,Q.FU)({uuids:t,loading:!1}))})};switch(w){case"enable":t(!0);break;case"disable":t(!1);break;case"export":{let e=[];for(let t of _)e.push(t.uuid);g.Z.loading({id:"export",content:O("exporting")}),Q.kK.export(e).then(()=>{g.Z.success({id:"export",content:O("export_success"),duration:3e3})});break}case"delete":if(confirm(O("list.confirm_delete"))){let e=_.map(e=>e.uuid);o((0,Q.Ph)(e)),Promise.allSettled(e.map(e=>Q.PI.delete(e)))}break;case"pin_to_top":if((e=_.length)>0){let t=ta.h.getState().script.scripts;for(let i=e-1;i>=0;i--){let e=_[i];t.findIndex(t=>t.uuid===e.uuid)>0&&o((0,Q.T3)({active:e.uuid,over:t[0].uuid}))}g.Z.success({content:O("scripts_pinned_to_top"),duration:3e3})}break;case"check_update":confirm(O("list.confirm_update"))&&_.forEach((e,t,i)=>{e.checkUpdateUrl&&(g.Z.warning({id:"checkupdateStart",content:O("starting_updates")}),Q.PI.requestCheckUpdate(e.uuid).then(r=>{r&&g.Z.warning({id:"checkupdate",content:`${(0,eb.ex)(e)} ${O("new_version_available")}`}),t===i.length-1&&g.Z.success({id:"checkupdateEnd",content:O("checked_for_all_selected")})}).catch(e=>{g.Z.error({id:"checkupdate",content:`${O("update_check_failed")}: ${e.message}`})}))});break;default:g.Z.error(O("unknown_operation"))}},children:O("confirm")}),(0,n.jsx)(em.Z,{type:"horizontal"}),(0,n.jsx)(eg.Z.Text,{children:O("resize_column_width")+":"}),(0,n.jsx)(C.Z,{style:{minWidth:"80px"},triggerProps:{autoAlignPopupWidth:!1,autoAlignPopupMinWidth:!0,position:"bl"},size:"mini",value:null==(e=z[Z].title)?void 0:e.toString(),onChange:e=>{S(parseInt(e,10))},children:z.map((e,t)=>(0,n.jsx)(C.Z.Option,{value:t,children:e.title},t))}),(0,n.jsx)(M.Z,{droplist:(0,n.jsxs)(L.Z,{children:[(0,n.jsx)(L.Z.Item,{onClick:()=>{J(Z,0)},children:O("auto")},"auto"),(0,n.jsx)(L.Z.Item,{onClick:()=>{J(Z,-1)},children:O("hide")},"hide"),(0,n.jsx)(L.Z.Item,{onClick:()=>{let e=z[Z].width>0?z[Z].width:U[Z].width;J(Z,e)},children:O("custom")},"custom")]}),position:"bl",children:(0,n.jsx)(f.Z,{type:0===z[Z].width||-1===z[Z].width?"":"number",style:{width:"80px"},size:"mini",value:0===z[Z].width?O("auto"):-1===z[Z].width?O("hide"):null==(t=z[Z].width)?void 0:t.toString(),step:5,onChange:e=>{J(Z,parseInt(e,10))}})}),(0,n.jsx)(m.Z,{type:"primary",size:"mini",onClick:()=>{let e={};for(let t of z)e[t.key]=t.width;R.RH.setScriptListColumnWidth(e)},children:O("save")}),(0,n.jsx)(m.Z,{size:"mini",onClick:()=>{A(e=>e.map((e,t)=>(e.width=U[t].width,e)))},children:O("reset")})]}),(0,n.jsx)(m.Z,{type:"primary",size:"mini",onClick:()=>{v(!1)},children:O("close")})]})}),q&&(0,n.jsx)(es.Z,{className:"arco-drag-table-container",components:{header:{operations:e=>{let{selectionNode:t,expandNode:i}=e;return[{node:(0,n.jsx)("th",{className:"script-sort"}),width:34},{name:"expandNode",node:i},{name:"selectionNode",node:t}]}},body:{operations:e=>{let{selectionNode:t,expandNode:i}=e;return[{node:(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:"arco-table-cell",children:(0,n.jsx)(tp,{})})}),width:34},{name:"expandNode",node:i},{name:"selectionNode",node:t}]},tbody:tm,row:th}},rowKey:"uuid",tableLayoutFixed:!0,columns:V,data:c,pagination:!1,style:{},rowSelection:{type:"checkbox",onChange(e,t){v(!0),k(t)}}},"script-list-table"),i&&(0,n.jsx)(eH,{script:i.script,userConfig:i.userConfig,values:i.values}),(0,n.jsx)(e6,{script:s,onClose:()=>{a(void 0)}})]})})})};var tx=i(11876),ty=i(63832),tv=i(57558),tb=i(79212),tw=i(79650),tj=i(14872);class t_{constructor(e){var t,i;i=void 0,(t="error")in this?Object.defineProperty(this,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[t]=i,this.error=e}}class tk extends eW.M{save(e){return super._save(e.key,e)}constructor(){super("localStorage")}}async function tZ(e){try{var t,i;let r,s=`${eq.P4}api/v1/auth/net-disk?netDiskType=${e}`;if("undefined"!=typeof chrome&&"function"==typeof(null==(i=chrome)||null==(t=i.tabs)?void 0:t.create)){let e=await chrome.tabs.create({url:s});r=async()=>{try{var t;let i=await chrome.tabs.get(e.id);return i&&(null==(t=i.url)?void 0:t.includes("/auth/net-disk/callback"))&&chrome.tabs.remove(e.id),!i||i.id!==e.id}catch{return!0}}}else{let e=window.open(s);if(!e)throw Error("The window cannot be opened.");r=()=>!0===e.closed}for(;await new Promise(e=>{setTimeout(e,1e3)}),!await r(););}catch(e){console.error(e)}}async function tC(e,t){var i;let r,s=new tk,a=`netdisk:token:${e}`;try{let e=await s.get(a);e&&(r=e.value)}catch(e){}if(!r||!r.accessToken){await tZ(e);let i=await fetch(eq.MQ+`auth/net-disk/token?netDiskType=${e}`).then(e=>e.json());if(0!==i.code)throw new t_(Error(i.msg));r={accessToken:i.data.token.access_token,refreshToken:i.data.token.refresh_token,createtime:Date.now()},t=!1,await s.save({key:a,value:r})}if(Date.now()>=r.createtime+36e5||t)try{let n=await (i=r.refreshToken,fetch(eq.MQ+`auth/net-disk/token/refresh?netDiskType=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({netDiskType:e,refreshToken:i})}).then(e=>e.json()));if(0!==n.code){if(await s.delete(a),t)return await tC(e);throw new t_(Error(n.msg))}r={accessToken:n.data.token.access_token,refreshToken:n.data.token.refresh_token,createtime:Date.now()},await s.save({key:a,value:r})}catch(e){}return r.accessToken}function tS(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let r="";for(let e of t)e&&(e.startsWith("/")||(e=`/${e}`),e.endsWith("/")&&(e=e.substring(0,e.length-1)),r+=e);return r}var t$=i(41311),tE=i.n(t$);function tN(e){return new Promise((t,i)=>{let r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=()=>{r.result?t(function(e){let t=tE().lib.WordArray.create(e);return(0,t$.MD5)(t).toString()}(r.result)):i(Error("result is null"))}})}function tO(e){return(0,t$.MD5)(e).toString()}function tT(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class tD{async read(e){let t=await this.fs.request(`https://pan.baidu.com/rest/2.0/xpan/multimedia?method=filemetas&access_token=${this.fs.accessToken}&fsids=[${this.file.fsid}]&dlink=1`);if(!t.list.length)throw Error("file not found");let i=await fetch(`${t.list[0].dlink}&access_token=${this.fs.accessToken}`);return"string"===e?await i.text():await i.blob()}constructor(e,t){tT(this,"file",void 0),tT(this,"fs",void 0),this.fs=e,this.file=t}}class tP{size(e){return e instanceof Blob?e.size:new Blob([e]).size}async md5(e){return e instanceof Blob?tN(e):tO(e)}async write(e){let t=this.size(e).toString(),i=[await this.md5(e)],r=new URLSearchParams;r.append("path",this.path),r.append("size",t),r.append("isdir","0"),r.append("autoinit","1"),r.append("rtype","3"),r.append("block_list",JSON.stringify(i));let s=new Headers;s.append("Content-Type","application/x-www-form-urlencoded");let a=await this.fs.request(`http://pan.baidu.com/rest/2.0/xpan/file?method=precreate&access_token=${this.fs.accessToken}`,{method:"POST",headers:s,body:r});if(a.errno)throw Error(JSON.stringify(a));let n=a.uploadid,l=new FormData;if(e instanceof Blob?l.append("file",e):l.append("file",new Blob([e])),(a=await this.fs.request(`https://d.pcs.baidu.com/rest/2.0/pcs/superfile2?method=upload&access_token=${this.fs.accessToken}&type=tmpfile&path=${encodeURIComponent(this.path)}&uploadid=${n}&partseq=0`,{method:"POST",body:l})).errno||((r=new URLSearchParams).append("path",this.path),r.append("size",t),r.append("isdir","0"),r.append("block_list",JSON.stringify(i)),r.append("uploadid",n),r.append("rtype","3"),(a=await this.fs.request(`https://pan.baidu.com/rest/2.0/xpan/file?method=create&access_token=${this.fs.accessToken}`,{method:"POST",headers:s,body:r})).errno))throw Error(JSON.stringify(a))}constructor(e,t){tT(this,"path",void 0),tT(this,"fs",void 0),this.fs=e,this.path=t}}function tF(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class tR{async verify(){let e=await tC("baidu");return this.accessToken=e,this.list().then()}async open(e){return new tD(this,e)}async openDir(e){return new tR(tS(this.path,e),this.accessToken)}async create(e){return new tP(this,tS(this.path,e))}async createDir(e){e=tS(this.path,e);let t=new URLSearchParams;t.append("path",e),t.append("size","0"),t.append("isdir","1"),t.append("rtype","3");let i=new Headers;i.append("Content-Type","application/x-www-form-urlencoded");let r=await this.request(`https://pan.baidu.com/rest/2.0/xpan/file?method=create&access_token=${this.accessToken}`,{method:"POST",headers:i,body:t,redirect:"follow"});if(r.errno)throw Error(JSON.stringify(r))}async request(e,t){let i=(t=t||{}).headers||new Headers;return await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[100],addRules:[{id:100,action:{type:"modifyHeaders",responseHeaders:[{operation:"remove",header:"cookie"}]},condition:{urlFilter:e,resourceTypes:["xmlhttprequest"]}}]}),t.headers=i,fetch(e,t).then(e=>e.json()).then(async i=>{if(111===i.errno||-6===i.errno){let i=await tC("baidu",!0);return this.accessToken=i,fetch(e=e.replace(/access_token=[^&]+/,`access_token=${i}`),t).then(e=>e.json()).then(e=>{if(111===e.errno||-6===e.errno)throw Error(JSON.stringify(e));return e})}return i}).finally(()=>{chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[100]})})}delete(e){let t=[tS(this.path,e)],i=new Headers;return i.append("Content-Type","application/x-www-form-urlencoded"),this.request(`https://pan.baidu.com/rest/2.0/xpan/file?method=filemanager&access_token=${this.accessToken}&opera=delete`,{method:"POST",body:`async=0&filelist=${encodeURIComponent(JSON.stringify(t))}`,headers:i}).then(e=>{if(e.errno)throw Error(JSON.stringify(e));return e})}list(){return this.request(`https://pan.baidu.com/rest/2.0/xpan/file?method=list&dir=${encodeURIComponent(this.path)}&order=time&access_token=${this.accessToken}`).then(e=>{if(e.errno){if(-9===e.errno)return[];throw Error(JSON.stringify(e))}let t=[];return e.list.forEach(e=>{t.push({fsid:e.fs_id,name:e.server_filename,path:this.path,size:e.size,digest:e.md5,createtime:1e3*e.server_ctime,updatetime:1e3*e.server_mtime})}),t})}async getDirUrl(){return`https://pan.baidu.com/disk/main#/index?category=all&path=${encodeURIComponent(this.path)}`}constructor(e,t){tF(this,"accessToken",void 0),tF(this,"path",void 0),this.path=e||"/apps",this.accessToken=t}}function tB(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class tI{async read(e){let t=await this.fs.getFileId(tS(this.file.path,this.file.name));if(!t)return Promise.reject(Error(`File not found: ${this.file.name}`));let i=await this.fs.request(`https://www.googleapis.com/drive/v3/files/${t}?alt=media&spaces=appDataFolder`,{},!0);return 200!==i.status?Promise.reject(await i.text()):"string"===e?i.text():i.blob()}constructor(e,t){tB(this,"file",void 0),tB(this,"fs",void 0),this.fs=e,this.file=t}}class tU{async write(e){let t=this.path.split("/").filter(Boolean),i=t.pop()||"",r="/"+t.join("/"),s=await this.fs.ensureDirExists(r),a=await this.fs.findFileInDirectory(i,s);return a?this.updateFile(a,e):this.createNewFile(i,s,e)}async updateFile(e,t){let i=new FormData;return i.append("metadata",new Blob([JSON.stringify({})],{type:"application/json"})),i.append("file",t instanceof Blob?t:new Blob([t])),await this.fs.request(`https://www.googleapis.com/upload/drive/v3/files/${e}?uploadType=multipart&spaces=appDataFolder`,{method:"PATCH",body:i}),Promise.resolve()}async createNewFile(e,t,i){let r=new FormData;return r.append("metadata",new Blob([JSON.stringify({name:e,parents:[t]})],{type:"application/json"})),r.append("file",i instanceof Blob?i:new Blob([i])),await this.fs.request("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&spaces=appDataFolder",{method:"POST",body:r}),Promise.resolve()}constructor(e,t){tB(this,"path",void 0),tB(this,"fs",void 0),this.fs=e,this.path=t}}function tz(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class tA{async verify(){let e=await tC("googledrive");return this.accessToken=e,this.list().then()}open(e){return Promise.resolve(new tI(this,e))}openDir(e){return Promise.resolve(new tA(tS(this.path,e),this.accessToken))}create(e){return Promise.resolve(new tU(this,tS(this.path,e)))}async createDir(e){if(!e)return Promise.resolve();let t=tS(this.path,e).split("/").filter(Boolean),i="appDataFolder",r="";for(let e of t){r=tS(r,e);let t=this.pathToIdCache.get(r);if(!t){let s=await this.findFolderByName(e,i);s||(s=await this.createFolder(e,i)),t=s.id,this.pathToIdCache.set(r,t)}i=t}return Promise.resolve()}async findFolderByName(e,t){let i=`name='${e}' and mimeType='application/vnd.google-apps.folder' and '${t}' in parents and trashed=false`,r=await this.request(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(i)}&fields=files(id,name)&spaces=appDataFolder`);return r.files&&r.files.length>0?r.files[0]:null}async createFolder(e,t){let i=new Headers;i.append("Content-Type","application/json");let r=await this.request("https://www.googleapis.com/drive/v3/files?spaces=appDataFolder",{method:"POST",headers:i,body:JSON.stringify({name:e,mimeType:"application/vnd.google-apps.folder",parents:[t]})});if(r.error)throw Error(JSON.stringify(r));return{id:r.id,name:r.name}}request(e,t,i){let r=(t=t||{}).headers||new Headers;r.append("Authorization",`Bearer ${this.accessToken}`),t.headers=r;let s=fetch(e,t);return i?s:s.then(e=>e.json()).then(async i=>{if(i.error){if(401===i.error.code){let i=await tC("googledrive",!0);return this.accessToken=i,r.set("Authorization",`Bearer ${this.accessToken}`),fetch(e,t).then(e=>e.json()).then(e=>{if(e.error)throw Error(JSON.stringify(e));return e})}throw Error(JSON.stringify(i))}return i})}async delete(e){let t=tS(this.path,e),i=await this.getFileId(t);if(!i)throw Error(`File or directory not found: ${e}`);await this.request(`https://www.googleapis.com/drive/v3/files/${i}?spaces=appDataFolder`,{method:"DELETE"},!0).then(async e=>{if(204!==e.status&&200!==e.status)throw Error(await e.text())}),this.clearRelatedCache(t)}async getFileId(e){if("/"===e||""===e)return"appDataFolder";let t=this.pathToIdCache.get(e);if(t)return t;let i=e.split("/").filter(Boolean),r="appDataFolder",s="";for(let e of i){s=tS(s,e);let t=this.pathToIdCache.get(s);if(t){r=t;continue}let i=`name='${e}' and '${r}' in parents and trashed=false`,a=await this.request(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(i)}&fields=files(id,name)&spaces=appDataFolder`);if(!a.files||0===a.files.length)return null;r=a.files[0].id,this.pathToIdCache.set(s,r)}return r}async list(){let e="appDataFolder";if("/"!==this.path){let t=await this.getFileId(this.path);if(!t)throw Error(`Directory not found: ${this.path}`);e=t}let t=`'${e}' in parents and trashed=false`,i=await this.request(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(t)}&fields=files(id,name,mimeType,size,md5Checksum,createdTime,modifiedTime)&spaces=appDataFolder`),r=[];if(i.files)for(let e of i.files)r.push({name:e.name,path:this.path,size:e.size?parseInt(e.size,10):0,digest:e.md5Checksum||"",createtime:new Date(e.createdTime).getTime(),updatetime:new Date(e.modifiedTime).getTime()});return r}async findFileInDirectory(e,t){let i=`name='${e}' and '${t}' in parents and trashed=false and mimeType!='application/vnd.google-apps.folder'`,r=await this.request(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(i)}&fields=files(id)&spaces=appDataFolder`);return r.files&&r.files.length>0?r.files[0].id:null}clearRelatedCache(e){Array.from(this.pathToIdCache.keys()).filter(t=>t.startsWith(e)).forEach(e=>this.pathToIdCache.delete(e))}async getDirUrl(){throw Error("Method not implemented.")}async ensureDirExists(e){if("/"===e||""===e)return"appDataFolder";let t=this.pathToIdCache.get(e);if(t)return t;let i=await this.getFileId(e);if(!i)throw Error(`Failed to create or find directory: ${e}`);return this.pathToIdCache.set(e,i),i}constructor(e,t){tz(this,"accessToken",void 0),tz(this,"path",void 0),tz(this,"pathToIdCache",new Map),this.path=e||"/",this.accessToken=t}}function tM(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class tL{async read(e){let t=await this.fs.request(`https://graph.microsoft.com/v1.0/me/drive/special/approot:${tS(this.file.path,this.file.name)}:/content`,{},!0);if(200!==t.status)throw Error(await t.text());return"string"===e?t.text():t.blob()}constructor(e,t){tM(this,"file",void 0),tM(this,"fs",void 0),this.fs=e,this.file=t}}class tH{size(e){return e instanceof Blob?e.size:new Blob([e]).size}async md5(e){return e instanceof Blob?tN(e):tO(e)}async write(e){let t=this.size(e).toString(),i=new Headers;i.append("Content-Type","application/json");let r=await this.fs.request(`https://graph.microsoft.com/v1.0/me/drive/special/approot:${this.path}:/createUploadSession`,{method:"POST",headers:i,body:JSON.stringify({item:{"@microsoft.graph.conflictBehavior":"replace"}})}).then(e=>{if(e.error)throw Error(JSON.stringify(e));return e.uploadUrl});return(i=new Headers).append("Content-Range",`bytes 0-${parseInt(t,10)-1}/${t}`),this.fs.request(r,{method:"PUT",body:e,headers:i})}constructor(e,t){tM(this,"path",void 0),tM(this,"fs",void 0),this.fs=e,this.path=t}}function tq(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class tW{async verify(){let e=await tC("onedrive");return this.accessToken=e,this.list().then()}async open(e){return new tL(this,e)}async openDir(e){return e.startsWith("ScriptCat")&&(e=e.substring(9)),new tW(tS(this.path,e),this.accessToken)}async create(e){return new tH(this,tS(this.path,e))}async createDir(e){if(e&&e.startsWith("ScriptCat")&&(e=e.substring(9)).startsWith("/")&&(e=e.substring(1)),!e)return;let t=(e=tS(this.path,e)).split("/"),i="";t.length>2&&(i=t.slice(0,t.length-1).join("/"));let r=new Headers;r.append("Content-Type","application/json"),""!==i&&(i=`:${i}:`);let s=await this.request(`https://graph.microsoft.com/v1.0/me/drive/special/approot${i}/children`,{method:"POST",headers:r,body:JSON.stringify({name:t[t.length-1],folder:{},"@microsoft.graph.conflictBehavior":"replace"})});if(s.errno)throw Error(JSON.stringify(s))}request(e,t,i){let r=(t=t||{}).headers||new Headers;e.includes("uploadSession")||r.append("Authorization",`Bearer ${this.accessToken}`),t.headers=r;let s=fetch(e,t);return i?s:s.then(e=>e.json()).then(async i=>{if(i.error){if("InvalidAuthenticationToken"===i.error.code){let s=await tC("onedrive",!0);return this.accessToken=s,r.set("Authorization",`Bearer ${this.accessToken}`),fetch(e,t).then(e=>e.json()).then(e=>{if(e.error)throw Error(JSON.stringify(e));return i})}throw Error(JSON.stringify(i))}return i})}async delete(e){let t=await this.request(`https://graph.microsoft.com/v1.0/me/drive/special/approot:${tS(this.path,e)}`,{method:"DELETE"},!0);if(204!==t.status)throw Error(await t.text());return t}async list(){let{path:e}=this;return e="/"===e?"":`:${e}:`,(await this.request(`https://graph.microsoft.com/v1.0/me/drive/special/approot${e}/children`)).value.map(e=>({name:e.name,path:this.path,size:e.size,digest:e.eTag,createtime:new Date(e.createdDateTime).getTime(),updatetime:new Date(e.lastModifiedDateTime).getTime()}))}getDirUrl(){throw Error("Method not implemented.")}constructor(e,t){tq(this,"accessToken",void 0),tq(this,"path",void 0),this.path=e||"/",this.accessToken=t}}function tV(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class tJ{async read(e){let t=tS(this.file.path,this.file.name),i=new Headers;i.append("Content-Type","application/octet-stream"),i.append("Dropbox-API-Arg",JSON.stringify({path:t}));let r=await this.fs.request("https://content.dropboxapi.com/2/files/download",{method:"POST",headers:i},!0);return 200!==r.status?Promise.reject(await r.text()):"string"===e?r.text():r.blob()}constructor(e,t){tV(this,"file",void 0),tV(this,"fs",void 0),this.fs=e,this.file=t}}class tK{async write(e){return await this.fs.exists(this.path)?this.updateFile(e):this.createNewFile(e)}async updateFile(e){let t=new Headers;return t.append("Content-Type","application/octet-stream"),t.append("Dropbox-API-Arg",JSON.stringify({path:this.path,mode:"overwrite",autorename:!1})),await this.fs.request("https://content.dropboxapi.com/2/files/upload",{method:"POST",headers:t,body:e instanceof Blob?e:new Blob([e])}),Promise.resolve()}async createNewFile(e){let t=new Headers;return t.append("Content-Type","application/octet-stream"),t.append("Dropbox-API-Arg",JSON.stringify({path:this.path,mode:"add",autorename:!1})),await this.fs.request("https://content.dropboxapi.com/2/files/upload",{method:"POST",headers:t,body:e instanceof Blob?e:new Blob([e])}),Promise.resolve()}constructor(e,t){tV(this,"path",void 0),tV(this,"fs",void 0),this.fs=e,this.path=t}}function tG(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class tY{async verify(){let e=await tC("dropbox");return this.accessToken=e,this.list().then()}open(e){return Promise.resolve(new tJ(this,e))}openDir(e){return Promise.resolve(new tY(tS(this.path,e),this.accessToken))}create(e){return Promise.resolve(new tK(this,tS(this.path,e)))}async createDir(e){if(!e)return Promise.resolve();let t=tS(this.path,e).replace(/^\/ScriptCat/,"");if(!t)return Promise.resolve();let i=new Headers;i.append("Content-Type","application/json");try{await this.request("https://api.dropboxapi.com/2/files/create_folder_v2",{method:"POST",headers:i,body:JSON.stringify({path:t,autorename:!1})}),this.pathCache.add(t)}catch(e){if(e.message&&e.message.includes("path/conflict"))return void this.pathCache.add(t);throw e}return Promise.resolve()}request(e,t,i){let r=(t=t||{}).headers||new Headers;r.append("Authorization",`Bearer ${this.accessToken}`),t.headers=r;let s=fetch(e,t);return i?s:s.then(async e=>{if(!e.ok){let t=await e.text();throw Error(`Dropbox API Error: ${e.status} - ${t}`)}return e.json()}).then(async i=>{if(i.error){if("invalid_access_token"===i.error[".tag"]){let i=await tC("dropbox",!0);return this.accessToken=i,r.set("Authorization",`Bearer ${this.accessToken}`),fetch(e,t).then(async e=>{if(!e.ok){let t=await e.text();throw Error(`Dropbox API Error: ${e.status} - ${t}`)}return e.json()}).then(e=>{if(e.error)throw Error(JSON.stringify(e));return e})}throw Error(JSON.stringify(i))}return i})}async delete(e){let t=tS(this.path,e),i=new Headers;i.append("Content-Type","application/json"),await this.request("https://api.dropboxapi.com/2/files/delete_v2",{method:"POST",headers:i,body:JSON.stringify({path:t})}),this.clearRelatedCache(t)}async list(){let e=this.path;("/"===e||""===e)&&(e="");let t=new Headers;t.append("Content-Type","application/json");let i=await this.request("https://api.dropboxapi.com/2/files/list_folder",{method:"POST",headers:t,body:JSON.stringify({path:e})}).catch(e=>{if(e.message.includes("path/not_found"))return{entries:[]};throw e}),r=[];if(i.entries)for(let e of i.entries)"file"===e[".tag"]&&r.push({name:e.name,path:this.path,size:e.size||0,digest:e.content_hash||"",createtime:new Date(e.client_modified).getTime(),updatetime:new Date(e.server_modified).getTime()});return r}async exists(e){try{let t=new Headers;return t.append("Content-Type","application/json"),await this.request("https://api.dropboxapi.com/2/files/get_metadata",{method:"POST",headers:t,body:JSON.stringify({path:e})}),!0}catch(e){return!1}}clearRelatedCache(e){Array.from(this.pathCache).filter(t=>t.startsWith(e)).forEach(e=>this.pathCache.delete(e))}async getDirUrl(){throw Error("Method not implemented.")}constructor(e,t){tG(this,"accessToken",void 0),tG(this,"path",void 0),tG(this,"pathCache",new Set),this.path=(e||"").replace(/^\/ScriptCat/,""),this.accessToken=t}}var tQ=i(16119);function tX(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class t0{async read(e){return"string"===e?await this.client.getFileContents(this.path,{format:"text"}):new Blob([await this.client.getFileContents(this.path,{format:"binary"})])}constructor(e,t){tX(this,"client",void 0),tX(this,"path",void 0),this.client=e,this.path=t}}class t1{async write(e){let t=e instanceof Blob?await e.arrayBuffer():e;if(!await this.client.putFileContents(this.path,t))throw Error("write error")}constructor(e,t){tX(this,"client",void 0),tX(this,"path",void 0),this.client=e,this.path=t}}function t2(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class t6{async verify(){try{await this.client.getQuota()}catch(e){if(e.response&&401===e.response.status)throw new t_(e);throw Error("verify failed")}}async open(e){return new t0(this.client,tS(e.path,e.name))}async openDir(e){return new t6(this.client,tS(this.basePath,e),this.url)}async create(e){return new t1(this.client,tS(this.basePath,e))}async createDir(e){try{await this.client.createDirectory(tS(this.basePath,e))}catch(e){if(e.message.includes("405"))return;throw e}}async delete(e){return this.client.deleteFile(tS(this.basePath,e))}async list(){let e=await this.client.getDirectoryContents(this.basePath),t=[];for(let i of e){if("file"!==i.type)continue;let e=new Date(i.lastmod).getTime();t.push({name:i.basename,path:this.basePath,digest:i.etag||"",size:i.size,createtime:e,updatetime:e})}return t}async getDirUrl(){return this.url+this.basePath}constructor(e,t,i,r){t2(this,"client",void 0),t2(this,"url",void 0),t2(this,"basePath","/"),"object"==typeof e?(this.client=e,this.basePath=tS(t||""),this.url=i):(this.url=t,this.client=(0,tQ.eI)(t,{authType:e,username:i,password:r}))}}function t4(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class t5{read(e){return this.zipObject.async(e||"string")}constructor(e){t4(this,"zipObject",void 0),this.zipObject=e}}class t8{async write(e){this.zip.file(this.path,e)}constructor(e,t){t4(this,"zip",void 0),t4(this,"path",void 0),this.zip=e,this.path=t}}function t3(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class t9{async verify(){}async open(e){let t=e.name,i=this.zip.file(t);if(i)return new t5(i);throw Error("File not found")}async openDir(e){return new t9(this.zip,e)}async create(e){return new t8(this.zip,e)}async createDir(){}async delete(e){this.zip.remove(e)}async list(){let e=[];return Object.keys(this.zip.files).forEach(t=>{e.push({name:t,path:t,size:0,digest:"",createtime:this.zip.files[t].date.getTime(),updatetime:this.zip.files[t].date.getTime()})}),e}async getDirUrl(){throw Error("Method not implemented.")}constructor(e,t){t3(this,"zip",void 0),t3(this,"basePath",void 0),this.zip=e||new(e0()),this.basePath=t||""}}class t7{static create(e,t){let i;switch(e){case"zip":i=new t9(t);break;case"webdav":i=new t6(t.authType,t.url,t.username,t.password);break;case"baidu-netdsik":i=new tR;break;case"onedrive":i=new tW;break;case"googledrive":i=new tA;break;case"dropbox":i=new tY;break;default:throw Error("not found filesystem")}return i.verify().then(()=>i)}static params(){return{webdav:{authType:{title:(0,eb.t)("auth_type"),type:"select",options:["password","digest","none","token"]},url:{title:(0,eb.t)("url")},username:{title:(0,eb.t)("username")},password:{title:(0,eb.t)("password"),type:"password"}},"baidu-netdsik":{},onedrive:{},googledrive:{},dropbox:{}}}static async mkdirAll(e,t){return new Promise((i,r)=>{let s=t.split("/"),a=0,n=()=>{if(a>=s.length)return void i();let t=s.slice(0,a+1).join("/");e.createDir(t).then(()=>{a+=1,n()}).catch(()=>{r()})};n()})}}let ie=e=>{let{onChangeFileSystemType:t,onChangeFileSystemParams:i,preNode:r,actionButton:s,fileSystemType:a,fileSystemParams:l}=e,o=t7.params(),{t:c}=(0,T.$G)(),d=[{key:"webdav",name:"WebDAV"},{key:"baidu-netdsik",name:c("baidu_netdisk")},{key:"onedrive",name:"OneDrive"},{key:"googledrive",name:"Google Drive"},{key:"dropbox",name:"Dropbox"}];return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(u.Z,{children:[r,(0,n.jsx)(C.Z,{value:a,style:{width:120},onChange:e=>{t(e)},children:d.map(e=>(0,n.jsx)(C.Z.Option,{value:e.key,children:e.name},e.key))}),s.map(e=>e)]}),(0,n.jsx)(u.Z,{style:{display:"flex",marginTop:4},children:Object.keys(o[a]).map(e=>(0,n.jsxs)("div",{children:["select"===o[a][e].type&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:o[a][e].title}),(0,n.jsx)(C.Z,{value:l[e]||o[a][e].options[0],onChange:t=>{i({...l,[e]:t})},children:o[a][e].options.map(e=>(0,n.jsx)(C.Z.Option,{value:e,children:e},e))})]}),"password"===o[a][e].type&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:o[a][e].title}),(0,n.jsx)(f.Z.Password,{value:l[e],onChange:t=>{i({...l,[e]:t})}})]}),!o[a][e].type&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:o[a][e].title}),(0,n.jsx)(f.Z,{value:l[e],onChange:t=>{i({...l,[e]:t})}})]})]},e))})]})},it=tw.Z.Item,ii=()=>{let[e,t]=(0,l.useState)("unset"),[i,r]=(0,l.useState)("webdav"),[s,a]=(0,l.useState)({}),{t:o}=(0,T.$G)();return(0,l.useEffect)(()=>{R.RH.getCatFileStorage().then(e=>{t(e.status),r(e.filesystem),a(e.params[e.filesystem]||{})})},[]),(0,n.jsx)(h.Z,{title:o("gm_api"),bordered:!1,children:(0,n.jsx)(tw.Z,{bordered:!1,defaultActiveKey:["storage"],children:(0,n.jsx)(it,{header:o("storage_api"),name:"storage",children:(0,n.jsxs)(u.Z,{direction:"vertical",children:[(0,n.jsx)(ie,{preNode:(0,n.jsxs)(eg.Z.Text,{children:[o("settings"),(0,n.jsx)(tj.Z,{target:"_black",href:"https://github.com/scriptscat/scriptcat/blob/main/example/cat_file_storage.js",children:"CAT_fileStorage"}),o("use_file_system")]}),actionButton:[(0,n.jsx)(m.Z,{type:"primary",onClick:async()=>{try{await t7.create(i,s)}catch(e){g.Z.error(`${o("account_validation_failed")}: ${e}`);return}let e={...s};e[i]=s,R.RH.setCatFileStorage({status:"success",filesystem:i,params:e}),t("success"),g.Z.success(o("save_success"))},children:o("save")},"save"),(0,n.jsx)(m.Z,{onClick:()=>{R.RH.setCatFileStorage({status:"unset",filesystem:"webdav",params:{}}),t("unset"),a({}),r("webdav")},type:"primary",status:"danger",children:o("reset")},"reset"),(0,n.jsx)(m.Z,{type:"secondary",onClick:async()=>{try{let e=await t7.create(i,s);e=await e.openDir("ScriptCat/app"),window.open(await e.getDirUrl(),"_black")}catch(e){g.Z.error(`${o("account_validation_failed")}: ${e}`)}},children:o("open_directory")},"open")],fileSystemType:i,fileSystemParams:s,onChangeFileSystemType:e=>{r(e)},onChangeFileSystemParams:e=>{a(e)}}),"unset"===e&&(0,n.jsx)(eg.Z.Text,{type:"secondary",children:o("not_set")}),"success"===e&&(0,n.jsx)(eg.Z.Text,{type:"success",children:o("in_use")}),"error"===e&&(0,n.jsx)(eg.Z.Text,{type:"error",children:o("storage_error")})]})})})})};var ir=((a={})[a.INCLUSION=1]="INCLUSION",a);function is(e){let t=(e=e.trim()).indexOf("://"),i=-1;t>0&&(i=e.indexOf("/",t+3));let r=null;if(t>0&&i>0){let s=e.substring(0,t);if(/^(\*|[-a-z]+)$/.test(s)){let a=e.substring(t+3,i);0===a.length&&"file"!==s||a.includes(":")||"."===a.charAt(0)||a.includes("?")||(/^(\*|\*\..+)$/.test(a)&&(a=a.substring(1)),a.includes("*")||(r=[s,a,e.substring(i+1)]))}}return r}let ia=e=>(e=(e=e.replace(/\*{2,}/g,"*")).replace(/\*(\?+)/g,"$1*")).split(/([*?])/g),il=e=>{let t=[];for(let i of e){let e=/@(match|include|exclude)\s+([^\t\r\n]+?)([\r\n]|$)/.exec(i);if(!e)continue;let[r,s,a]=e,n=a;if("/"!==n.charAt(0)){if("match"===s){let e;if("*"===n)n="*://*/";else if(e=/^(\*|[-a-z]+|http\*):\/\/(\*?[^*/:]*)(:[^*/]*)?/.exec(n)){let t=e[1];"http*"===t&&(t="*");let i=n.substring(e[0].length);i&&"*"!==i?i.startsWith("*/")&&(i=i.substring(1)):i="/";let r=e[2];r.length>=2&&"*"===r[0]&&"."!==r[1]&&(r=`*.${r.substring(1)}`),n=`${t}://${r}${i}`}}else{let e=n.indexOf(".tld/");if(e>0){let t=n.substring(0,e);if(t.split("/").length<=3){let i=n.substring(e+5);n=`${t}.??*/${i}`}}}n.includes("**")&&(n=n.replace(/\*{2,}/g,"*"))}if("match"===s){let e=is(n);if(!e)continue;t.push({ruleType:1,ruleContent:e,ruleTag:s,patternString:n});continue}let l=!1;if("include"===s);else{if("exclude"!==s)continue;l=!0}if(n.includes("*."));else{let e=is(n);if(e){t.push({ruleType:l?2:1,ruleContent:e,ruleTag:s,patternString:n});continue}}let o=/^\/(.+)\/([a-z]*)$/.exec(n);if(o){let e=null;try{e=new RegExp(o[1],o[2]||"i")}catch{}if(null===e)continue;t.push({ruleType:l?6:5,ruleContent:[o[1],o[2]],ruleTag:s,patternString:n});continue}t.push({ruleType:l?4:3,ruleContent:ia(n),ruleTag:s,patternString:n})}return t},io=new Map,ic=(e,t)=>{let i=`${t.ruleTag} ${t.patternString}	${e}`,r=io.get(i);if("boolean"==typeof r)return r;switch(t.ruleType){case 1:r=id(e,t.ruleContent);break;case 2:r=!id(e,t.ruleContent);break;case 3:r=iu(e,t.ruleContent);break;case 4:r=!iu(e,t.ruleContent);break;case 5:r=ih(e,t.ruleContent);break;case 6:r=!ih(e,t.ruleContent);break;default:throw Error("invalid ruleType")}return io.size>512&&io.clear(),io.set(i,r),r};function id(e,t){let i;try{i=new URL(e)}catch{return!1}if("*"!==t[0]&&i.protocol!==`${t[0]}:`)return!1;if(t[1]){if("."===t[1].charAt(0)){if(!`.${i.hostname}`.endsWith(`${t[1]}`))return!1}else if(`${i.hostname}`!=`${t[1]}`)return!1}let r=`${i.pathname}${i.search||"?"}`,s=`/${t[2]}`.split("*"),a=0,n=0,l=s.length,o=Array(s.length-1);if(!r.startsWith(`${s[0]}`))return!1;for(a=`${s[0]}`.length,n=1;n<l;){if(n===l-1&&""===s[n]){o[n-1]=r.substring(a),a=r.length;break}let e=r.indexOf(s[n],a);if(e<0)return!1;o[n-1]=r.substring(a,e),a=e+s[n].length,n++}return a===r.length||a===r.length-1&&"?"===r[a]}function iu(e,t){let i=e.indexOf("#");if(i>=0){if(e.indexOf("#",i+1)>0)try{let t=new URL(e);if(!e.endsWith(t.hash))return!1;i=e.length-t.hash.length}catch{return!1}e=e.substring(0,i)}if(!e.length)return!1;let r=e,s=0,a=0,n=t.length,l=Array((n-1)/2);if(!r.startsWith(`${t[0]}`))return!1;s=`${t[0]}`.length;let o=2;for(;o<n;){let e=t[o-1],i=t[o];if("*"===e){if(o===n-1&&""===i){l[a]=r.substring(s),s=r.length;break}if(!i)throw Error("invalid or unsupported glob");let e=r.indexOf(i,s);if(e<0)return!1;l[a]=r.substring(s,e),s=e+i.length}else{let e=s+1;if(r.substring(e,e+i.length)!==i)return!1;l[a]=r[s],s=e+i.length}a++,o+=2}return s===r.length||s===r.length-1&&"?"===r[s]}function ih(e,t){return new RegExp(t[0],t[1]||"i").test(e)}function ip(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class im{addRules(e,t){this.cacheMap.clear();let i=this.rulesMap.get(e);i||this.rulesMap.set(e,i=[]),i.push(...t)}urlMatch(e){let t=this.cacheMap;if(t.has(e))return t.get(e);let i=new Set;for(let[t,r]of this.rulesMap.entries()){let s=!1,a=!1;for(let t of r)if(t.ruleType&ir.INCLUSION)!s&&ic(e,t)&&(s=!0);else if(!a&&!ic(e,t)){a=!0;break}s&&!a&&i.add(t)}let r=[...i],s=this.sorter;return null!==s&&"object"==typeof s&&"string"==typeof r[0]&&r.sort((e,t)=>{let i=s[e],r=s[t];return i>-1&&r>-1?i-r:e.localeCompare(t)}),t.set(e,r),r}clearRules(e){this.cacheMap.clear(),this.rulesMap.delete(e)}addInclude(e,t){let i=il([e].map(e=>`@include ${e}`));this.addRules(t,i)}addMatch(e,t){let i=il([e].map(e=>`@match ${e}`));this.addRules(t,i)}exclude(e,t){let i=il([e].map(e=>`@exclude ${e}`));this.addRules(t,i)}setupSorter(e){this.sorter!==e&&(this.cacheMap.clear(),this.sorter=e)}constructor(){ip(this,"rulesMap",new Map),ip(this,"cacheMap",new Map),ip(this,"sorter",null)}}let ig=e=>{let{className:t,i18nKey:i}=e,{t:r}=(0,T.$G)(),s=[],a=r(i);for(;;){let e=a.indexOf("<");if(-1!==e){s.push(a.substring(0,e));let t=a.indexOf(">",e),i=a.substring(e+1,t).split(" ")[0],r=a.substring(e,t+1),l=a.indexOf(`</${i}>`,t),o=a.substring(t+1,a.indexOf(`</${i}>`,t));if("Link"===i){let t=r.match(/href="(.*)"/)[1];s.push((0,n.jsx)(tj.Z,{href:t,target:"_black",children:o},`i${e}`))}else s.push(o);a=a.substring(l+i.length+3)}else{s.push(a);break}}return(0,n.jsx)("div",{className:t,children:s})},ix=function(){let[e,t]=(0,l.useState)(),[i,r]=(0,l.useState)(),[s,a]=(0,l.useState)(),[o,c]=(0,l.useState)("webdav"),[d,p]=(0,l.useState)({}),[x,y]=(0,l.useState)(eb.ZP.language),[v,b]=(0,l.useState)(5),[w,j]=(0,l.useState)(0),[_,k]=(0,l.useState)(!1),[Z,S]=(0,l.useState)(!1),[$,E]=(0,l.useState)(!1),[N,O]=(0,l.useState)(""),[D,P]=(0,l.useState)(""),[F,B]=(0,l.useState)(""),[I,U]=(0,l.useState)(""),[z,A]=(0,l.useState)("run_count"),[M,L]=(0,l.useState)("#4e5969"),[H,q]=(0,l.useState)("#ffffff"),[W,V]=(0,l.useState)("all"),J=[],{t:K}=(0,T.$G)();for(let e of Object.keys(eb.ZP.store.data))"ach-UG"!==e&&J.push({key:e,title:eb.ZP.store.data[e].title});return J.push({key:"help",title:K("help_translate")}),(0,l.useEffect)(()=>{Promise.all([R.RH.getCloudSync(),R.RH.getMenuExpandNum(),R.RH.getCheckScriptUpdateCycle(),R.RH.getUpdateDisableScript(),R.RH.getSilenceUpdateScript(),R.RH.getEslintConfig(),R.RH.getEnableEslint(),R.RH.getLanguage(),R.RH.getBlacklist(),R.RH.getBadgeNumberType(),R.RH.getBadgeBackgroundColor(),R.RH.getBadgeTextColor(),R.RH.getScriptMenuDisplayType(),R.RH.getEditorConfig(),R.RH.getEditorTypeDefinition()]).then(e=>{let[i,s,n,l,o,d,u,h,m,f,g,x,v,w,_]=e;t(i.syncDelete),r(i.syncStatus),a(i.enable),c(i.filesystem),p(i.params[i.filesystem]||{}),b(s),j(n),k(l),S(o),B(d),E(u),y(h),U(m),A(f),L(g),q(x),V(v),O(w),P(_)})},[]),(0,n.jsxs)(u.Z,{className:"setting w-full h-full overflow-auto relative",direction:"vertical",children:[(0,n.jsx)(h.Z,{title:K("general"),bordered:!1,children:(0,n.jsxs)("div",{className:"flex items-center justify-between min-h-10",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,n.jsx)("span",{className:"min-w-20 font-medium",children:K("language")}),(0,n.jsx)(C.Z,{value:x,className:"w-50 max-w-75",onChange:e=>{if("help"===e)return void window.open("https://crowdin.com/project/scriptcat","_blank");y(e),R.RH.setLanguage(e),g.Z.success(K("language_change_tip"))},children:J.map(e=>(0,n.jsx)(C.Z.Option,{value:e.key,children:e.title},e.key))})]}),(0,n.jsx)("span",{className:"text-xs ml-6 flex-shrink-0",children:K("select_interface_language")})]})}),(0,n.jsx)(h.Z,{className:"sync",title:K("script_sync"),bordered:!1,children:(0,n.jsxs)(u.Z,{direction:"vertical",className:"w-full",children:[(0,n.jsxs)(u.Z,{direction:"horizontal",className:"w-full",children:[(0,n.jsx)(ef.Z,{checked:e,onChange:e=>{t(e)},children:K("sync_delete")}),(0,n.jsx)(ef.Z,{checked:i,onChange:e=>{r(e)},children:K("sync_status")})]}),(0,n.jsx)(ie,{preNode:(0,n.jsx)(ef.Z,{checked:s,onChange:e=>{a(e)},children:K("enable_script_sync_to")}),actionButton:[(0,n.jsx)(m.Z,{type:"primary",onClick:async()=>{if(s){g.Z.info(K("cloud_sync_account_verification"));try{await t7.create(o,d)}catch(e){g.Z.error(`${K("cloud_sync_verification_failed")}: ${JSON.stringify(G.Z.E(e))}`);return}}let t={...(await R.RH.getCloudSync()).params};t[o]=d,R.RH.setCloudSync({enable:s||!1,syncDelete:e||!1,syncStatus:i||!1,filesystem:o,params:t}),g.Z.success(K("save_success"))},children:K("save")},"save")],fileSystemType:o,fileSystemParams:d,onChangeFileSystemType:e=>{c(e)},onChangeFileSystemParams:e=>{p(e)}})]})}),(0,n.jsx)(h.Z,{title:K("interface_settings"),bordered:!1,children:(0,n.jsxs)(u.Z,{direction:"vertical",size:16,className:"w-full",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm font-medium mb-3",children:K("extension_icon_badge")}),(0,n.jsxs)(u.Z,{direction:"vertical",size:12,className:"w-full",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between min-h-9",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,n.jsx)("span",{className:"min-w-20",children:K("display_type")}),(0,n.jsxs)(C.Z,{value:z,className:"w-40 max-w-50",onChange:e=>{A(e),R.RH.setBadgeNumberType(e)},children:[(0,n.jsx)(C.Z.Option,{value:"none",children:K("badge_type_none")}),(0,n.jsx)(C.Z.Option,{value:"run_count",children:K("badge_type_run_count")}),(0,n.jsx)(C.Z.Option,{value:"script_count",children:K("badge_type_script_count")})]})]}),(0,n.jsx)("span",{className:"text-xs ml-6 flex-shrink-0",children:K("extension_icon_badge_type")})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between min-h-9",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,n.jsx)("span",{className:"min-w-20",children:K("background_color")}),(0,n.jsx)(tx.Z,{value:M,onChange:e=>{var t;let i="string"==typeof e?e:(null==(t=e[0])?void 0:t.color)||"#4e5969";L(i),R.RH.setBadgeBackgroundColor(i)},showText:!0,disabledAlpha:!0,className:"w-50 max-w-62.5"})]}),(0,n.jsx)("span",{className:"text-xs ml-6 flex-shrink-0",children:K("badge_background_color_desc")})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between min-h-9",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,n.jsx)("span",{className:"min-w-20",children:K("text_color")}),(0,n.jsx)(tx.Z,{value:H,onChange:e=>{var t;let i="string"==typeof e?e:(null==(t=e[0])?void 0:t.color)||"#ffffff";q(i),R.RH.setBadgeTextColor(i)},showText:!0,disabledAlpha:!0,className:"w-50 max-w-62.5"})]}),(0,n.jsx)("span",{className:"text-xs ml-6 flex-shrink-0",children:K("badge_text_color_desc")})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm font-medium mb-3",children:K("script_menu")}),(0,n.jsxs)(u.Z,{direction:"vertical",size:12,className:"w-full",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between min-h-9",children:[(0,n.jsx)("div",{className:"flex items-center gap-4 flex-1",children:(0,n.jsx)(ef.Z,{checked:"all"===W,onChange:e=>{V(e?"all":"no_browser"),R.RH.setScriptMenuDisplayType(e?"all":"no_browser")},children:K("display_right_click_menu")})}),(0,n.jsx)("span",{className:"text-xs ml-6 flex-shrink-0",children:K("display_right_click_menu_desc")})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between min-h-9",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,n.jsx)("span",{className:"min-w-20",children:K("expand_count")}),(0,n.jsx)(f.Z,{className:"w-25 max-w-30",type:"number",value:v.toString(),onChange:e=>{let t=parseInt(e,10);b(t),R.RH.setMenuExpandNum(t)}})]}),(0,n.jsx)("span",{className:"text-xs ml-6 flex-shrink-0",children:K("auto_collapse_when_exceeds")})]})]})]})]})}),(0,n.jsx)(h.Z,{title:K("update"),bordered:!1,children:(0,n.jsxs)(u.Z,{direction:"vertical",size:20,className:"w-full",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between min-h-9",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,n.jsx)("span",{className:"min-w-20 font-medium",children:K("check_frequency")}),(0,n.jsxs)(C.Z,{value:w.toString(),className:"w-35 max-w-45",onChange:e=>{let t=parseInt(e,10);j(t),R.RH.setCheckScriptUpdateCycle(t)},children:[(0,n.jsx)(C.Z.Option,{value:"0",children:K("never")}),(0,n.jsx)(C.Z.Option,{value:"21600",children:K("6_hours")}),(0,n.jsx)(C.Z.Option,{value:"43200",children:K("12_hours")}),(0,n.jsx)(C.Z.Option,{value:"86400",children:K("every_day")}),(0,n.jsx)(C.Z.Option,{value:"604800",children:K("every_week")})]})]}),(0,n.jsx)("span",{className:"text-xs ml-6 flex-shrink-0",children:K("script_auto_update_frequency")})]}),(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-3 flex-1",children:[(0,n.jsx)("span",{className:"font-medium mb-1",children:K("update_options")}),(0,n.jsx)(ef.Z,{onChange:e=>{k(e),R.RH.setUpdateDisableScript(e)},checked:_,children:K("update_disabled_scripts")}),(0,n.jsx)(ef.Z,{onChange:e=>{S(e),R.RH.setSilenceUpdateScript(e)},checked:Z,children:K("silent_update_non_critical_changes")})]}),(0,n.jsx)("span",{className:"text-xs max-w-50 text-right ml-6 flex-shrink-0",children:K("control_script_update_behavior")})]})]})}),(0,n.jsx)(ii,{}),(0,n.jsx)(h.Z,{title:K("security"),bordered:!1,children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,n.jsx)("span",{className:"font-medium min-w-20",children:K("blacklist_pages")}),(0,n.jsx)("span",{className:"text-xs max-w-60 text-right",children:K("blacklist_pages_desc")})]}),(0,n.jsx)(f.Z.TextArea,{placeholder:K("blacklist_placeholder"),autoSize:{minRows:4,maxRows:8},value:I,onChange:e=>{U(e)},onBlur:e=>{let t=e.target.value,i=(e=>{let t=il([...(e=e||[]).map(e=>`@include ${e}`)]),i=new im;for(let r of(i.addRules("BK",t),e)){let e=r.replace(/[*?]/g,e=>{if("?"===e)return String.fromCharCode(X(97,122));let t=[];for(let e=X(3,5);e>0;e--)t.push(X(97,122));return String.fromCharCode(...t)});if("BK"!==i.urlMatch(e)[0])return{ok:!1,line:r}}return{ok:!0}})(t?t.split("\n").map(e=>e.trim()).filter(e=>e):[]);if(!i.ok)return void g.Z.error(`${K("expression_format_error")}: ${i.line}`);R.RH.setBlacklist(t)}})]})}),(0,n.jsx)(h.Z,{title:K("development_tools"),bordered:!1,children:(0,n.jsxs)(u.Z,{direction:"vertical",size:20,className:"w-full",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between min-h-9",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,n.jsx)(ef.Z,{onChange:e=>{E(e),R.RH.setEnableEslint(e)},checked:$,children:(0,n.jsx)("span",{className:"font-medium",children:K("enable_eslint")})}),(0,n.jsx)(m.Z,{type:"text",size:"small",className:"p-1",icon:(0,n.jsx)(eJ.Z,{}),href:"https://eslint.org/play/",target:"_blank"})]}),(0,n.jsx)("span",{className:"text-xs ml-6 flex-shrink-0",children:K("check_script_code_quality")})]}),$&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,n.jsx)("span",{className:"font-medium min-w-20",children:K("eslint_rules")}),(0,n.jsx)("span",{className:"text-xs max-w-60 text-right ml-6 flex-shrink-0",children:K("custom_eslint_rules_config")})]}),(0,n.jsx)(f.Z.TextArea,{placeholder:K("enter_eslint_rules"),autoSize:{minRows:4,maxRows:8},value:F,onChange:e=>{B(e)},onBlur:()=>{ty.ZP.format(F,{parser:"json",plugins:[tb.ZP,tv]}).then(e=>{""===e?g.Z.success(K("eslint_rules_reset")):g.Z.success(K("eslint_rules_saved")),R.RH.setEslintConfig(e)}).catch(e=>{g.Z.error(`${K("eslint_config_format_error")}: ${JSON.stringify(G.Z.E(e))}`)})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,n.jsx)("span",{className:"font-medium min-w-20",children:K("editor_config")}),(0,n.jsx)(ig,{className:"text-xs max-w-80 text-right ml-6 flex-shrink-0",i18nKey:"editor_config_description"})]}),(0,n.jsx)(f.Z.TextArea,{placeholder:K("editor_config"),autoSize:{minRows:4,maxRows:8},value:N,onChange:e=>{O(e)},onBlur:()=>{ty.ZP.format(N,{parser:"json",plugins:[tb.ZP,tv]}).then(e=>{""===e?g.Z.success(K("editor_config_reset")):g.Z.success(K("editor_config_saved")),R.RH.setEditorConfig(e)}).catch(e=>{g.Z.error(`${K("editor_config_format_error")}: ${JSON.stringify(G.Z.E(e))}`)})}})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,n.jsx)("span",{className:"font-medium min-w-20",children:K("editor_type_definition")}),(0,n.jsx)("span",{className:"text-xs max-w-100 text-right ml-6 flex-shrink-0",dangerouslySetInnerHTML:{__html:K("editor_type_definition_description")}})]}),(0,n.jsx)(f.Z.TextArea,{placeholder:K("editor_type_definition"),autoSize:{minRows:4,maxRows:8},value:D,onChange:e=>{P(e)},onBlur:()=>{""===D?g.Z.success(K("editor_type_definition_reset")):g.Z.success(K("editor_type_definition_saved")),R.RH.setEditorTypeDefinition(D)}})]})]})})]})};var iy=i(56378);let iv=function(){let[e,t]=(0,l.useState)([]),i=(0,l.useRef)(null),{t:r}=(0,T.$G)(),s=async(e,i)=>{t(t=>t.map((t,r)=>r===e?{...t,...i}:t))};(0,l.useEffect)(()=>{new iy.zk().all().then(e=>{t(e)})},[]);let a=[{title:"#",width:70,key:"#",sorter:(e,t)=>e.createtime-t.createtime,render:(e,t,i)=>e<0?"-":i+1},{title:r("enable"),width:r("subscribe_list_enable_width"),key:"enable",sorter:(e,t)=>e.status-t.status,filters:[{text:r("enable"),value:iy.s4},{text:r("disable"),value:iy.oi}],onFilter:(e,t)=>t.status===e,render:(e,t,i)=>(0,n.jsx)(eE.Z,{checked:t.status===iy.s4,loading:t.loading,disabled:t.loading,onChange:e=>{s(i,{loading:!0});let r=!1;Q.tC.enable(t.url,e).then(()=>{r=!0}).catch(e=>{g.Z.error(e)}).finally(()=>{s(i,{loading:!1,...r&&{status:e?iy.s4:iy.oi}})})}})},{title:r("name"),dataIndex:"name",sorter:(e,t)=>e.name.localeCompare(t.name),filterIcon:(0,n.jsx)(ea.Z,{}),key:"name",filterDropdown:e=>{let{filterKeys:t,setFilterKeys:s,confirm:a}=e;return(0,n.jsx)("div",{className:"arco-table-custom-filter",children:(0,n.jsx)(f.Z.Search,{ref:i,searchButton:!0,placeholder:r("enter_subscribe_name"),value:t[0]||"",onChange:e=>{s(e?[e]:[])},onSearch:()=>{a()}})})},onFilter:(e,t)=>!e||t.name.includes(e),onFilterDropdownVisibleChange:e=>{e&&setTimeout(()=>i.current.focus(),1)},className:"max-w-[240px]",render:e=>(0,n.jsx)(H.Z,{content:e,position:"tl",children:(0,n.jsx)(b.Z,{style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})})},{title:r("version"),dataIndex:"version",width:120,align:"center",key:"version",render:(e,t)=>t.metadata.version&&t.metadata.version[0]},{title:r("permission"),width:120,align:"center",key:"permission",render:(e,t)=>(0,n.jsx)("div",{children:(t.metadata.connect||[]).map(e=>(0,n.jsx)("img",{src:`https://${e}/favicon.ico`,alt:e,height:16,width:16},e))})},{title:r("source"),width:100,align:"center",key:"source",render:(e,t)=>(0,n.jsx)(H.Z,{content:(0,n.jsxs)("p",{style:{margin:0,padding:0},children:[r("subscribe_url")+":"," ",decodeURIComponent(t.url)]}),children:(0,n.jsx)(eN.Z,{icon:(0,n.jsx)(eF.Z,{color:""}),color:"green",bordered:!0,style:{cursor:"pointer"},children:r("subscribe_url")})})},{title:r("last_updated"),dataIndex:"updatetime",align:"center",key:"updatetime",width:r("script_list_last_updated_width"),sorter:(e,t)=>e.updatetime-t.updatetime,render:(e,t)=>(0,n.jsx)("span",{style:{cursor:"pointer"},onClick:()=>{g.Z.info({id:"checkupdate",content:r("checking_for_updates")}),Q.tC.checkUpdate(t.url).then(e=>{e?g.Z.warning({id:"checkupdate",content:r("new_version_available")}):g.Z.success({id:"checkupdate",content:r("latest_version")})}).catch(e=>{g.Z.error({id:"checkupdate",content:`${r("check_update_failed")}: ${e.message}`})})},children:e5(new Date(e))})},{title:r("action"),width:120,align:"center",key:"action",render:(i,s)=>(0,n.jsx)(m.Z.Group,{children:(0,n.jsx)(er.Z,{title:r("confirm_delete_subscription"),icon:(0,n.jsx)(eR.w6k,{}),onOk:()=>{Q.tC.delete(s.url).then(()=>{t(e.filter(e=>e.url!==s.url)),g.Z.success(r("delete_success"))}).catch(e=>{g.Z.error(`${r("delete_failed")}: ${e}`)})},children:(0,n.jsx)(m.Z,{type:"text",icon:(0,n.jsx)(eR.w6k,{}),onClick:()=>{},style:{color:"var(--color-text-2)"}})})})}];return(0,n.jsx)(h.Z,{className:"script-list subscribe-list",style:{height:"100%",overflowY:"auto"},children:(0,n.jsx)(es.Z,{className:"arco-drag-table-container",rowKey:"url",tableLayoutFixed:!0,columns:a,data:e,pagination:{total:e.length,pageSize:e.length,hideOnSinglePage:!0},style:{minWidth:"1200px"}})})};var ib=i(99919),iw=i(35231);class ij extends eW.M{save(e,t){return super._save(e,t)}constructor(){super("value")}}class i_ extends eW.M{key(e){return e.uuid+":"+e.permission+":"+e.permissionValue}findByKey(e,t,i){return this.get(e+":"+t+":"+i)}save(e){return super._save(this.key(e),e)}constructor(){super("permission")}}function ik(){setTimeout(async()=>{try{let e=await j.table("scripts").toArray(),t=new P.Ru,i=new P.Gf;console.log("开始迁移脚本数据",e.length),await Promise.all(e.map(async e=>{let{uuid:r,name:s,namespace:a,author:n,originDomain:l,subscribeUrl:o,type:c,sort:d,status:u,runStatus:h,metadata:p,createtime:m,checktime:f,code:g,checkUpdateUrl:x,downloadUrl:y,selfMetadata:v,config:b,error:w,updatetime:j,lastruntime:_,nextruntime:k}=e,Z=await t.save({uuid:r,name:s,namespace:a,author:n,originDomain:l,origin,checkUpdateUrl:x,downloadUrl:y,metadata:p,selfMetadata:v,subscribeUrl:o,config:b,type:c,status:u,sort:d,runStatus:h,error:w,createtime:m,updatetime:j,checktime:f,lastruntime:_,nextruntime:k});return i.save({uuid:Z.uuid,code:g}).catch(e=>(console.log("脚本代码迁移失败",e),Promise.reject(e)))}));let r=await j.table("subscribe").toArray(),s=new iy.zk;r.length&&await Promise.all(r.map(e=>{let{url:t,name:i,code:r,author:a,scripts:n,metadata:l,status:o,createtime:c,updatetime:d,checktime:u}=e;return s.save({url:t,name:i,code:r,author:a,scripts:n,metadata:l,status:o,createtime:c,updatetime:d,checktime:u})})),console.log("订阅数据迁移完成",r.length);let a=await j.table("value").toArray(),n=new ij,l=new Map;await Promise.all(a.map(e=>{let{scriptId:t,key:i,value:r,createtime:s}=e;return j.table("scripts").where("id").equals(t).first(e=>{if(e){let t={};l.has(e.uuid)?t=l.get(e.uuid).data:l.set(e.uuid,{uuid:e.uuid,storageName:function(e){var t;let i=null==(t=e.metadata)?void 0:t.storagename;return i?i[0]:e.uuid}(e),data:t,createtime:s,updatetime:0}),t[i]=r}})})),await Promise.all(Array.from(l.keys()).map(e=>{let{storageName:t,data:i,createtime:r}=l.get(e);return n.save(t,{uuid:e,storageName:t,data:i,createtime:r,updatetime:0})})),console.log("脚本value数据迁移完成",a.length);let o=await j.table("permission").toArray(),c=new i_;await Promise.all(o.map(e=>{let{scriptId:t,permission:i,permissionValue:r,createtime:s,updatetime:a,allow:n}=e;return j.table("scripts").where("id").equals(t).first(e=>{if(e)return c.save({uuid:e.uuid,permission:i,permissionValue:r,createtime:s,updatetime:a,allow:n})})})),console.log("脚本permission数据迁移完成",o.length),setTimeout(async()=>{let e=await t.all();console.log("脚本数据迁移完成",e.length),e.length>0&&(chrome.tabs.create({url:`${eq.RE}/docs/change/v0.17/`}),setTimeout(()=>{chrome.runtime.reload()},1e3))},2e3)}catch(e){console.error("脚本数据迁移失败",e)}},200)}let iZ=function(){let[e,t]=(0,l.useState)({}),i=(0,l.useRef)(null),[r,s]=(0,l.useState)("webdav"),[a,o]=(0,l.useState)({}),[c,d]=(0,l.useState)(""),[p,y]=(0,l.useState)(!1),[v,b]=(0,l.useState)([]),w=(0,l.useRef)(null),{t:j}=(0,T.$G)();return(0,l.useEffect)(()=>{(async()=>{let[e,t,i]=await Promise.all([R.RH.getBackup(),R.RH.getVscodeUrl(),R.RH.getVscodeReconnect()]);s(e.filesystem),o(e.params[e.filesystem]||{}),d(t),y(i)})()},[]),(0,n.jsxs)(u.Z,{className:"tools",direction:"vertical",style:{width:"100%",height:"100%",overflow:"auto",position:"relative"},children:[(0,n.jsx)(h.Z,{className:"backup",title:j("backup"),bordered:!1,children:(0,n.jsxs)(u.Z,{direction:"vertical",children:[(0,n.jsx)(iw.Z,{heading:6,children:j("local")}),(0,n.jsxs)(u.Z,{children:[(0,n.jsx)("input",{type:"file",ref:i,style:{display:"none"},accept:".zip"}),(0,n.jsx)(m.Z,{type:"primary",loading:e.local,onClick:async()=>{t(e=>({...e,local:!0})),await Q.kK.export(),t(e=>({...e,local:!1}))},children:j("export_file")}),(0,n.jsx)(m.Z,{type:"primary",onClick:()=>{let e=i.current;e.onchange=async()=>{let{files:t}=e;if(!t)return;let i=t[0];if(i)try{await Q.kK.openImportWindow(i.name,i),g.Z.success(j("select_import_script"))}catch(e){g.Z.error(`${j("import_error")}: ${e}`)}},e.click()},children:j("import_file")})]}),(0,n.jsx)(iw.Z,{heading:6,children:j("cloud")}),(0,n.jsx)(ie,{preNode:j("backup_to"),onChangeFileSystemType:e=>{s(e)},onChangeFileSystemParams:e=>{o(e)},actionButton:[(0,n.jsx)(m.Z,{type:"primary",loading:e.cloud,onClick:()=>{let e={...a};e[r]=a,R.RH.setBackup({filesystem:r,params:e}),t(e=>({...e,cloud:!0})),g.Z.info(j("preparing_backup")),Q.kK.backupToCloud(r,a).then(()=>{g.Z.success(j("backup_success"))}).catch(e=>{g.Z.error(`${j("backup_failed")}: ${e}`)}).finally(()=>{t(e=>({...e,cloud:!1}))})},children:j("backup")},"backup"),(0,n.jsx)(m.Z,{type:"primary",loading:e.cloud,onClick:async()=>{t(e=>({...e,cloud:!0}));try{let e=await t7.create(r,a);e=await e.openDir("ScriptCat");let t=await e.list();t.sort((e,t)=>t.updatetime-e.updatetime),t=t.filter(e=>e.name.endsWith(".zip")),0===t.length?g.Z.info(j("no_backup_files")):b(t)}catch(e){g.Z.error(`${j("get_backup_files_failed")}: ${e}`)}t(e=>({...e,cloud:!1}))},children:j("backup_list")},"list")],fileSystemType:r,fileSystemParams:a}),(0,n.jsx)(ei.Z,{width:400,title:(0,n.jsxs)("div",{className:"flex flex-row justify-between w-full gap-10",children:[(0,n.jsx)("span",{children:j("backup_list")}),(0,n.jsx)(m.Z,{type:"secondary",size:"mini",onClick:async()=>{let e=await t7.create(r,a);try{e=await e.openDir("ScriptCat");let t=await e.getDirUrl();t&&window.open(t,"_black")}catch(e){g.Z.error(`${j("get_backup_dir_url_failed")}: ${e}`)}},children:j("open_backup_dir")})]}),visible:0!==v.length,onOk:()=>{b([])},onCancel:()=>{b([])},children:(0,n.jsx)(x.Z,{bordered:!1,dataSource:v,render:e=>(0,n.jsxs)(x.Z.Item,{children:[(0,n.jsx)(x.Z.Item.Meta,{title:e.name,description:(0,O.F)(e.updatetime/1e3)}),(0,n.jsxs)(u.Z,{className:"w-full justify-end",children:[(0,n.jsx)(m.Z,{type:"primary",size:"small",onClick:async()=>{let t,i;g.Z.info(j("pulling_data_from_cloud"));let s=await t7.create(r,a);try{s=await s.openDir("ScriptCat"),t=await s.open(e),i=await t.read("blob")}catch(e){g.Z.error(`${j("pull_failed")}: ${e}`);return}Q.kK.openImportWindow(e.name,i).then(()=>{g.Z.success(j("select_import_script"))}).then(e=>{g.Z.error(`${j("import_error")}${e}`)})},children:j("restore")}),(0,n.jsx)(m.Z,{type:"primary",status:"danger",size:"small",onClick:()=>{q.Z.confirm({title:j("confirm_delete"),content:`${j("confirm_delete_backup_file")}${e.name}?`,onOk:async()=>{let t=await t7.create(r,a);try{t=await t.openDir("ScriptCat"),await t.delete(e.name),b(v.filter(t=>t.name!==e.name)),g.Z.success(j("delete_success"))}catch(e){g.Z.error(`${j("delete_failed")}${e}`)}}})},children:j("delete")})]})]},`${e.name}_${e.updatetime}`)})}),(0,n.jsx)(iw.Z,{heading:6,children:j("backup_strategy")}),(0,n.jsx)(ib.Z,{description:j("under_construction")}),(0,n.jsx)(er.Z,{title:j("migration_confirm_message"),onOk:()=>{ik()},children:(0,n.jsx)(m.Z,{type:"primary",children:j("retry_migration")})})]})}),(0,n.jsx)(h.Z,{title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:j("development_debugging")}),(0,n.jsx)(m.Z,{type:"text",style:{height:24},icon:(0,n.jsx)(eJ.Z,{style:{margin:0}}),href:"https://www.bilibili.com/video/BV16q4y157CP",target:"_blank",iconOnly:!0})]}),bordered:!1,children:(0,n.jsxs)(u.Z,{direction:"vertical",children:[(0,n.jsx)(iw.Z,{heading:6,children:j("vscode_url")}),(0,n.jsx)(f.Z,{ref:w,value:c,onChange:e=>{d(e)}}),(0,n.jsx)(ef.Z,{checked:p,onChange:e=>{y(e)},children:j("auto_connect_vscode_service")}),(0,n.jsx)(m.Z,{type:"primary",onClick:()=>{R.RH.setVscodeUrl(c),R.RH.setVscodeReconnect(p),new ed.o1(R.yw).connectVSCode({url:c,reconnect:p}).then(()=>{g.Z.success(j("connection_success"))}).catch(e=>{g.Z.error(`${j("connection_failed")}: ${e}`)})},children:j("connect")})]})})]})};var iC=i(56218),iS=i(76183),i$=i(34714),iE=i(7384),iN=i(4083),iO=i(26290),iT=i(69581),iD=i(7059),iP=i(42407);let iF=l.forwardRef((e,t)=>{let{t:i}=(0,T.$G)(),[r,s]=(0,l.useState)(0),[a,o]=(0,l.useState)({pathname:"/"}),[c,d]=(0,l.useState)(!1),u=(0,N.s0)(),h=(0,N.TH)();(0,l.useImperativeHandle)(t,()=>({open:()=>d(!0)})),(0,l.useEffect)(()=>{null===localStorage.getItem("firstUse")&&(localStorage.setItem("firstUse","false"),chrome.extension.inIncognitoContext||d(!0))},[]);let p=[{title:i("start_guide_title"),content:i("start_guide_content"),target:"body",placement:"center"},{title:i("installed_scripts"),content:i("guide_installed_scripts"),target:".menu-script"},{content:(0,n.jsx)(ig,{i18nKey:"guide_script_list_content"}),target:"#script-list",title:i("guide_script_list_title"),placement:"auto"},{content:i("guide_script_list_enable_content"),target:".script-enable",title:i("guide_script_list_enable_title")},{content:i("guide_script_list_apply_to_run_status_content"),target:".apply_to_run_status",title:i("guide_script_list_apply_to_run_status_title")},{target:".script-sort",title:i("guide_script_list_sort_title"),content:(0,n.jsx)(ig,{i18nKey:"guide_script_list_sort_content"})},{target:".menu-tools",title:i("guide_tools_title"),content:i("guide_tools_content"),placement:"auto"},{target:".tools .backup",title:i("guide_tools_backup_title"),content:i("guide_tools_backup_content")},{target:".menu-setting",title:i("guide_setting_title"),content:i("guide_setting_content"),placement:"auto"},{target:".setting .sync",title:i("guide_setting_sync_title"),content:i("guide_setting_sync_content")}],m=e=>e.pathname===h.pathname&&e.search===h.search&&e.hash===h.hash||u(e);return(0,n.jsx)(iP.ZP,{callback:e=>{if("stop"===e.action||"close"===e.action||"finished"===e.status)d(!1),s(0),m(a);else if("next"===e.action&&"complete"===e.lifecycle){switch(e.index){case 5:m({pathname:"/tools"});break;case 7:m({pathname:"/setting"})}s(e.index+1)}else"prev"===e.action&&"complete"===e.lifecycle?s(e.index-1):"start"===e.action&&"init"===e.lifecycle&&(m({pathname:"/"}),o({pathname:h.pathname,search:h.search,hash:h.hash}))},locale:{nextLabelWithProgress:i("next_with_progress"),skip:i("skip"),back:i("back"),last:i("last")},continuous:!0,run:c,scrollToFirstStep:!0,showProgress:!0,showSkipButton:!0,stepIndex:r,steps:p,disableOverlayClose:!0,disableScrolling:!0,spotlightPadding:0,styles:{options:{zIndex:1e4,primaryColor:"#4594D5"}}})}),iR=e=>{let{children:t,to:i,search:r,className:s}=e,a=(0,N.s0)(),{t:l}=(0,T.$G)();return(0,n.jsx)("div",{className:s,onClick:()=>{window.onbeforeunload?confirm(l("confirm_leave_page"))&&a({pathname:i,search:r}):a({pathname:i,search:r})},children:t})},iB=L.Z.Item,{hash:iI}=window.location;iI=iI.length?iI.substring(1):"/";var iU=i(54897);i(82519),i(19245),i(70930),j.version(1).stores({scripts:"++id,&uuid,name,namespace,author,origin_domain,type,status,createtime,updatetime,checktime"}),j.version(2).stores({logger:"++id,level,origin,createtime",permission:"++id,[scriptId+permission+permissionValue],createtime,updatetime"}),j.version(3).stores({logger:"++id,level,title,origin,createtime"}),j.version(4).stores({value:"++id,scriptId,namespace,key,createtime"}),j.version(5).stores({logger:"++id,level,origin,createtime,title,[origin+title],[level+origin+title]"}),j.version(6).stores({scripts:"++id,&uuid,name,namespace,author,origin_domain,type,status,runStatus,createtime,updatetime,checktime"}),j.version(7).stores({resource:"++id,&url,content,type,createtime,updatetime",resourceLink:"++id,url,scriptId,createtime"}),j.version(8).stores({logger:"++id,level,origin,createtime"}),j.version(9).stores({logger:"++id,level,scriptId,origin,createtime"}),j.version(10).stores({scripts:"++id,&uuid,name,namespace,author,origin_domain,type,sort,status,runStatus,createtime,updatetime,checktime"}).upgrade(e=>e.table("scripts").toCollection().modify(e=>{e.sort=0})),j.version(11).stores({export:"++id,&uuid,scriptId"}),j.version(12).stores({value:"++id,scriptId,storageName,key,createtime"}).upgrade(e=>e.table("value").toCollection().modify(e=>{e.namespace&&(e.storageName=e.namespace,delete e.namespace)})),j.version(13).stores({subscribe:"++id,&url,createtime,updatetime,checktime",scripts:"++id,&uuid,name,namespace,author,origin_domain,subscribeUrl,type,sort,status,runStatus,createtime,updatetime,checktime",sync:"++id,&key,[user+device+type],createtime"}),j.version(14).stores({value:"++id,[scriptId+key],[storageName+key]"}),j.version(15).stores({permission:"++id,scriptId,[scriptId+permission+permissionValue],createtime,updatetime"}),j.version(16).stores({scripts:"++id,&uuid,name,namespace,author,originDomain,subscribeUrl,type,sort,status,runStatus,createtime,updatetime,checktime",logger:"++id,level,createtime"}).upgrade(async e=>(await e.table("export").clear(),e.table("scripts").toCollection().modify(e=>{e.origin_domain&&(e.originDomain=e.origin_domain),e.checkupdate_url&&(e.checkUpdateUrl=e.checkupdate_url),e.download_url&&(e.downloadUrl=e.download_url)}))),j.version(17).stores({export:"++id,&scriptId"}),j.version(18).upgrade(()=>{ik()}),j.open(),window.MonacoEnvironment={getWorkerUrl:(e,t)=>"typescript"===t||"javascript"===t?"/src/ts.worker.js":"/src/editor.worker.js"};let iz={name:"脚本名称",copyright:"脚本的版权信息",license:"脚本的开源协议",version:"脚本版本",description:"脚本描述",icon:"脚本图标",iconURL:"脚本图标",defaulticon:"脚本图标",icon64:"64x64 大小的脚本图标",icon64URL:"64x64 大小的脚本图标",grant:"脚本特殊Api权限申请",author:"脚本作者","run-at":"脚本的运行时间<br>`document-start`：在前端匹配到网址后,以最快的速度注入脚本到页面中<br>`document-end`：DOM 加载完成后注入脚本,此时页面脚本和图像等资源可能仍在加载<br>`document-idle`：所有内容加载完成后注入脚本<br>`document-body`：脚本只会在页面中有 body 元素时才会注入","run-in":"脚本注入的环境",homepage:"脚本主页",homepageURL:"脚本主页",website:"脚本主页",background:"后台脚本",include:"脚本匹配url运行的页面",match:"脚本匹配url运行的页面",exclude:"脚本匹配url不运行的页面",connect:"获取网站的访问权限",resource:"引入资源文件",require:"引入外部 js 文件",noframes:"表示脚本不运行在`<frame>`中",definition:"ScriptCat特有功能：一个`.d.ts`文件的引用地址,能够自动补全编辑器的自动提示",antifeature:"这是与脚本市场有关的，不受欢迎的功能需要加上此描述值",updateURL:"脚本检查更新的url",downloadURL:"脚本更新的下载地址",supportURL:"支持站点，bug 反馈页面",source:"脚本源码页",crontab:`\u{5B9A}\u{65F6}\u{811A}\u{672C} crontab \u{53C2}\u{8003}\u{FF08}\u{4E0D}\u{9002}\u{7528}\u{4E8E}\u{4E91}\u{7AEF}\u{811A}\u{672C}\u{FF09}
    * * * * * * \u{6BCF}\u{79D2}\u{8FD0}\u{884C}\u{4E00}\u{6B21}
    * * * * * \u{6BCF}\u{5206}\u{949F}\u{8FD0}\u{884C}\u{4E00}\u{6B21}
    0 */6 * * * \u{6BCF}6\u{5C0F}\u{65F6}\u{7684}0\u{5206}\u{65F6}\u{6267}\u{884C}\u{4E00}\u{6B21}
    15 */6 * * * \u{6BCF}6\u{5C0F}\u{65F6}\u{7684}15\u{5206}\u{65F6}\u{6267}\u{884C}\u{4E00}\u{6B21}
    * once * * * \u{6BCF}\u{5C0F}\u{65F6}\u{8FD0}\u{884C}\u{4E00}\u{6B21}
    * * once * * \u{6BCF}\u{5929}\u{8FD0}\u{884C}\u{4E00}\u{6B21}
    * 10 once * * \u{6BCF}\u{5929}10\u{70B9}-10:59\u{4E2D}\u{8FD0}\u{884C}\u{4E00}\u{6B21},\u{5047}\u{8BBE}\u{5F53}10:04\u{65F6}\u{8FD0}\u{884C}\u{4E86}\u{4E00}\u{6B21},10:05-10:59\u{7684}\u{540E}\u{7EED}\u{7684}\u{65F6}\u{95F4}\u{5C06}\u{4E0D}\u{4F1A}\u{518D}\u{8FD0}\u{884C}
    * 1,3,5 once * * \u{6BCF}\u{5929}1\u{70B9}3\u{70B9}5\u{70B9}\u{4E2D}\u{8FD0}\u{884C}\u{4E00}\u{6B21},\u{5047}\u{8BBE}\u{5F53}1\u{70B9}\u{65F6}\u{8FD0}\u{884C}\u{4E86}\u{4E00}\u{6B21},3,5\u{70B9}\u{5C06}\u{4E0D}\u{4F1A}\u{518D}\u{8FD0}\u{884C}
    * */4 once * * \u{6BCF}\u{5929}\u{6BCF}\u{9694}4\u{5C0F}\u{65F6}\u{68C0}\u{6D4B}\u{8FD0}\u{884C}\u{4E00}\u{6B21},\u{5047}\u{8BBE}\u{5F53}4\u{70B9}\u{65F6}\u{8FD0}\u{884C}\u{4E86}\u{4E00}\u{6B21},8,12,16,20,24\u{70B9}\u{7B49}\u{540E}\u{7EED}\u{7684}\u{65F6}\u{95F4}\u{5C06}\u{4E0D}\u{4F1A}\u{518D}\u{8FD0}\u{884C}
    * 10-23 once * * \u{6BCF}\u{5929}10\u{70B9}-23:59\u{4E2D}\u{8FD0}\u{884C}\u{4E00}\u{6B21},\u{5047}\u{8BBE}\u{5F53}10:04\u{65F6}\u{8FD0}\u{884C}\u{4E86}\u{4E00}\u{6B21},10:05-23:59\u{7684}\u{540E}\u{7EED}\u{65F6}\u{95F4}\u{5C06}\u{4E0D}\u{4F1A}\u{518D}\u{8FD0}\u{884C}
    * once 13 * * \u{6BCF}\u{4E2A}\u{6708}\u{7684}13\u{53F7}\u{7684}\u{6BCF}\u{5C0F}\u{65F6}\u{8FD0}\u{884C}\u{4E00}\u{6B21}`.replace(/\n/g,"<br>")};F.Mj.registerHoverProvider("javascript",{provideHover:(e,t)=>new Promise(i=>{let r=e.getLineContent(t.lineNumber),s=/^\/\/\s*@([\w-]+?)(\s+(.*?)|)$/.exec(r);i(s?{contents:[{value:iz[s[1]],supportHtml:!0}]}:/==UserScript==/.test(r)?{contents:[{value:"一个用户脚本"}]}:null)})}),F.Mj.registerCodeActionProvider("javascript",{provideCodeActions:(e,t,i)=>{let r=[],s=R.WE.get("eslint-fix");for(let t=0;t<i.markers.length;t+=1){let a=i.markers[t],n="string"==typeof a.code?a.code:a.code.value,l=s.get(`${n}|${a.startLineNumber}|${a.endLineNumber}|${a.startColumn}|${a.endColumn}`);if(l){let t={resource:e.uri,textEdit:{range:l.range,text:l.text},versionId:void 0};r.push({title:`\u{4FEE}\u{590D} ${n} \u{95EE}\u{9898}`,diagnostics:[a],kind:"quickfix",edit:{edits:[t]},isPreferred:!0})}r.push({title:`\u{6DFB}\u{52A0} eslint-disable-next-line \u{6CE8}\u{91CA}`,diagnostics:[a],kind:"quickfix",edit:{edits:[{resource:e.uri,textEdit:{range:{startLineNumber:a.startLineNumber,endLineNumber:a.startLineNumber,startColumn:1,endColumn:1},text:`// eslint-disable-next-line ${"string"==typeof a.code?a.code:a.code.value}
`},versionId:void 0}]},isPreferred:!0}),r.push({title:`\u{6DFB}\u{52A0} eslint-disable \u{6CE8}\u{91CA}`,diagnostics:[a],kind:"quickfix",edit:{edits:[{resource:e.uri,textEdit:{range:{startLineNumber:1,endLineNumber:1,startColumn:1,endColumn:1},text:`/* eslint-disable ${"string"==typeof a.code?a.code:a.code.value} */
`},versionId:void 0}]},isPreferred:!0})}return{actions:r,dispose:()=>{}}}}),Promise.all([R.RH.getEditorConfig(),R.RH.getEditorTypeDefinition()]).then(e=>{let[t,i]=e,r=JSON.parse(t);F.Mj.typescript.javascriptDefaults.setCompilerOptions({allowNonTsExtensions:!0,...r}),F.Mj.typescript.javascriptDefaults.addExtraLib(i,"scriptcat.d.ts")}),new K.Z({writer:new class{async write(e,t,i){try{await this.dao.save({id:0,level:e,message:t,label:i,createtime:Date.now()})}catch(e){console.error("DBWriter error",e)}}constructor(e){var t;t=void 0,"dao"in this?Object.defineProperty(this,"dao",{value:t,enumerable:!0,configurable:!0,writable:!0}):this.dao=t,this.dao=e}}(new Z),labels:{env:"options"}}).logger().debug("options page start"),R.ak.subscribe("scriptRunStatus",e=>{ta.h.dispatch(Q.g4.actions.updateRunStatus(e))}),R.ak.subscribe("installScript",e=>{ta.h.dispatch((0,Q.hi)(e.script))}),R.ak.subscribe("deleteScript",e=>{ta.h.dispatch((0,Q.Ph)([e.uuid]))});let iA=(0,n.jsx)(iU.zt,{store:ta.h,children:(0,n.jsx)(c.Z,{className:"!flex-row",pageName:"options",children:(0,n.jsx)(()=>{let[e,t]=(0,l.useState)(iI),[i,r]=(0,l.useState)("true"===localStorage.collapsed),{t:s}=(0,T.$G)(),a=(0,l.useRef)(null),o=(0,l.useCallback)(e=>{t(e)},[]);return(0,n.jsxs)(N.UT,{children:[(0,n.jsx)(iF,{ref:a}),(0,n.jsx)(iC.Z.Sider,{className:"h-full",collapsed:i,width:170,children:(0,n.jsxs)("div",{className:"flex flex-col justify-between h-full",children:[(0,n.jsxs)(L.Z,{style:{width:"100%"},selectedKeys:[e],selectable:!0,onClickMenuItem:o,children:[(0,n.jsx)(iR,{to:"/",children:(0,n.jsxs)(iB,{className:"menu-script",children:[(0,n.jsx)(e9.Z,{})," ",s("installed_scripts")]},"/")}),(0,n.jsx)(iR,{to:"/subscribe",children:(0,n.jsxs)(iB,{children:[(0,n.jsx)(iS.Z,{})," ",s("subscribe")]},"/subscribe")}),(0,n.jsx)(iR,{to:"/logger",children:(0,n.jsxs)(iB,{children:[(0,n.jsx)(i$.Z,{})," ",s("logs")]},"/logger")}),(0,n.jsx)(iR,{to:"/tools",className:"menu-tools",children:(0,n.jsxs)(iB,{children:[(0,n.jsx)(iE.Z,{})," ",s("tools")]},"/tools")}),(0,n.jsx)(iR,{to:"/setting",className:"menu-setting",children:(0,n.jsxs)(iB,{children:[(0,n.jsx)(iN.Z,{})," ",s("settings")]},"/setting")})]}),(0,n.jsxs)(L.Z,{style:{width:"100%",borderTop:"1px solid var(--color-bg-5)"},selectedKeys:[],selectable:!0,onClickMenuItem:o,mode:"pop",children:[(0,n.jsxs)(L.Z.SubMenu,{title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(iO.Z,{})," ",s("helpcenter")]}),triggerProps:{trigger:"hover"},children:[(0,n.jsxs)(L.Z.SubMenu,{title:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eR.DNM,{})," ",(0,n.jsx)("span",{className:"grow",children:s("external_links")})]}),children:[(0,n.jsx)(L.Z.Item,{children:(0,n.jsxs)("a",{href:`${eq.RE}${eb.rN}/docs/dev/`,target:"_blank",rel:"noreferrer",children:[(0,n.jsx)(eR.Mdh,{})," ",s("api_docs")]})},"scriptcat/docs/dev/"),(0,n.jsx)(L.Z.Item,{children:(0,n.jsxs)("a",{href:"https://learn.scriptcat.org/docs/%E7%AE%80%E4%BB%8B/",target:"_blank",rel:"noreferrer",children:[(0,n.jsx)(eR.Mdh,{})," ",s("development_guide")]})},"scriptcat/docs/learn/"),(0,n.jsx)(L.Z.Item,{children:(0,n.jsxs)("a",{href:"https://scriptcat.org/search",target:"_blank",rel:"noreferrer",children:[(0,n.jsx)(eP.Z,{})," ",s("script_gallery")]})},"scriptcat/userscript"),(0,n.jsx)(L.Z.Item,{children:(0,n.jsxs)("a",{href:"https://bbs.tampermonkey.net.cn/",target:"_blank",rel:"noreferrer",children:[(0,n.jsx)(eP.Z,{})," ",s("community_forum")]})},"tampermonkey/bbs"),(0,n.jsx)(L.Z.Item,{children:(0,n.jsxs)("a",{href:"https://github.com/scriptscat/scriptcat",target:"_blank",rel:"noreferrer",children:[(0,n.jsx)(e8.Z,{})," ","GitHub"]})},"GitHub")]},"/external_links"),(0,n.jsxs)(L.Z.Item,{onClick:()=>{var e;null==(e=a.current)||e.open()},children:[(0,n.jsx)(eR.ONP,{})," ",s("guide")]},"/guide"),(0,n.jsx)(L.Z.Item,{children:(0,n.jsxs)("a",{href:`${eq.RE}${eb.rN}/docs/use/`,target:"_blank",rel:"noreferrer",children:[(0,n.jsx)(eR.Mdh,{})," ",s("user_guide")]})},"scriptcat/docs/use/")]},"/help"),(0,n.jsxs)(iB,{onClick:()=>{localStorage.collapsed=!i,r(!i)},children:[i?(0,n.jsx)(iT.Z,{}):(0,n.jsx)(iD.Z,{})," ",s("hide_sidebar")]},"/collapsible")]})]})}),(0,n.jsx)(iC.Z.Content,{style:{borderLeft:"1px solid var(--color-bg-5)",overflow:"hidden",padding:10,height:"100%",boxSizing:"border-box",position:"relative"},children:(0,n.jsxs)(N.Z5,{children:[(0,n.jsx)(N.AW,{index:!0,element:(0,n.jsx)(tg,{})}),(0,n.jsxs)(N.AW,{path:"/script/editor",children:[(0,n.jsx)(N.AW,{path:":uuid",element:(0,n.jsx)(eS,{})}),(0,n.jsx)(N.AW,{path:"",element:(0,n.jsx)(eS,{})})]}),(0,n.jsx)(N.AW,{path:"/subscribe",element:(0,n.jsx)(iv,{})}),(0,n.jsx)(N.AW,{path:"/logger",element:(0,n.jsx)(D,{})}),(0,n.jsx)(N.AW,{path:"/tools",element:(0,n.jsx)(iZ,{})}),(0,n.jsx)(N.AW,{path:"/setting",element:(0,n.jsx)(ix,{})})]})})]})},{})})});o.createRoot(document.getElementById("root")).render(iA)},75025:function(e,t,i){i.d(t,{FU:()=>C,Jg:()=>b,NX:()=>v,PI:()=>c,Ph:()=>Z,T3:()=>_,Wr:()=>$,_Q:()=>S,_v:()=>u,bd:()=>h,fe:()=>g,g4:()=>j,hQ:()=>x,hi:()=>k,kK:()=>m,tC:()=>d,vb:()=>y,wh:()=>p,yb:()=>f});var r=i(28399),s=i(17969),a=i(77811),n=i(91127),l=i(67824),o=i(59991);let c=new l.aP(o.yw),d=new l.Ji(o.yw),u=new l.TD(o.yw);new l.bt(o.yw);let h=new l.Y2(o.yw),p=new l.DN(o.yw);new l.zm(o.yw);let m=new l.Uf(o.yw),f=(0,r.hg)("script/fetchScriptList",async()=>await c.getAllScripts()),g=(0,r.hg)("script/enableScript",async e=>await c.enable(e.uuid,e.enable)),x=(0,r.hg)("script/runScript",async e=>await u.runScript(e)),y=(0,r.hg)("script/stopScript",async e=>await u.stopScript(e)),v=(0,r.hg)("script/deleteScript",async e=>await c.delete(e)),b=(0,r.hg)("script/requestFilterResult",async e=>await c.getFilterResult(e)),w=(e,t,i)=>{let r=e.find(e=>e.uuid===t);r&&i(r)},j=(0,s.Em)({name:"script",initialState:{scripts:[]},reducers:{upsertScript:(e,t)=>{let i=e.scripts.find(e=>e.uuid===t.payload.uuid);i?Object.assign(i,t.payload):e.scripts.splice(0,0,t.payload)},batchDeleteScript:(e,t)=>{e.scripts=e.scripts.filter(e=>!t.payload.includes(e.uuid))},sortScript:(e,t)=>{let i=0,r=0;e.scripts.forEach((e,s)=>{e.uuid===t.payload.active?i=s:e.uuid===t.payload.over&&(r=s)});let s=(0,n.Rp)(e.scripts,i,r);e.scripts=s;for(let t=0;t<e.scripts.length;t+=1)e.scripts[t].sort!==t&&(e.scripts[t].sort=t);c.sortScript(t.payload.active,t.payload.over)},updateRunStatus:(e,t)=>{let i=e.scripts.find(e=>e.uuid===t.payload.uuid);i&&(i.runStatus=t.payload.runStatus)},updateEnableStatus:(e,t)=>{e.scripts=e.scripts.map(e=>(t.payload.uuids.includes(e.uuid)&&(e.status=t.payload.enable?a.Kv:a.J7),e))},enableLoading(e,t){e.scripts=e.scripts.map(e=>(t.payload.uuids.includes(e.uuid)&&(e.enableLoading=t.payload.loading),e))},setScriptFavicon:(e,t)=>{let i=new Map;for(let t of e.scripts)i.set(t.uuid,t);for(let e of t.payload){let t=i.get(e.uuid);t&&(t.favorite=e.fav)}}},extraReducers:e=>{e.addCase(f.fulfilled,(e,t)=>{e.scripts=t.payload}).addCase(g.fulfilled,(e,t)=>{w(e.scripts,t.meta.arg.uuid,e=>{e.enableLoading=!1,e.status=t.meta.arg.enable?a.Kv:a.J7})}).addCase(g.pending,(e,t)=>w(e.scripts,t.meta.arg.uuid,e=>e.enableLoading=!0)).addCase(v.fulfilled,(e,t)=>{e.scripts=e.scripts.filter(e=>e.uuid!==t.meta.arg)}).addCase(v.pending,(e,t)=>w(e.scripts,t.meta.arg,e=>e.actionLoading=!0)).addCase(x.pending,(e,t)=>w(e.scripts,t.meta.arg,e=>e.actionLoading=!0)).addCase(x.fulfilled,(e,t)=>w(e.scripts,t.meta.arg,e=>e.actionLoading=!1)).addCase(y.pending,(e,t)=>w(e.scripts,t.meta.arg,e=>e.actionLoading=!0)).addCase(y.fulfilled,(e,t)=>w(e.scripts,t.meta.arg,e=>e.actionLoading=!1))},selectors:{selectScripts:e=>e.scripts}}),{sortScript:_,upsertScript:k,batchDeleteScript:Z,enableLoading:C,updateEnableStatus:S}=j.actions,{selectScripts:$}=j.selectors},59991:function(e,t,i){i.d(t,{RH:()=>c,WE:()=>d,ak:()=>o,jp:()=>h,yw:()=>u});var r=i(24300),s=i(20202),a=i(9701),n=i(30159),l=i(67824);let o=new r.z,c=new s.Tf(o),d=new Map,u=new a.Nx,h=new l.o1(u);(0,n.cW)(c)},20202:function(e,t,i){i.d(t,{Tf:()=>u,kq:()=>m});var r=i(69298),s=i(92005),a=i(41663),n=i(30159),l=i(91088),o=i(88348);function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let d="systemConfigChange";class u{addListener(e,t){this.mq.subscribe(d,i=>{i.key===e&&t(i.value)})}get(e,t){if(this.cache.has(e)){var i;let r=this.cache.get(e);return Promise.resolve(r=void 0===r?(null==t||null==(i=t.asyncValue)?void 0:i.call(t))||t:r)}return this.storage.get(e).then(i=>{var r;return this.cache.set(e,i),i=void 0===i?(null==t||null==(r=t.asyncValue)?void 0:r.call(t))||t:i})}set(e,t){void 0===t?(this.cache.delete(e),this.storage.remove(e)):(this.cache.set(e,t),this.storage.set(e,t)),this.mq.publish(d,{key:e,value:t})}getChangetime(){return this.get("changetime",0)}setChangetime(e){this.set("changetime",e)}getCheckScriptUpdateCycle(){return this.get("check_script_update_cycle",86400)}setCheckScriptUpdateCycle(e){this.set("check_script_update_cycle",e)}getSilenceUpdateScript(){return this.get("silence_update_script",!1)}setSilenceUpdateScript(e){this.set("silence_update_script",e)}getEnableAutoSync(){return this.get("enable_auto_sync",!0)}setEnableAutoSync(e){this.set("enable_auto_sync",e)}getUpdateDisableScript(){return this.get("update_disable_script",!0)}setUpdateDisableScript(e){this.set("update_disable_script",e)}getVscodeUrl(){return this.get("vscode_url","ws://localhost:8642")}setVscodeUrl(e){this.set("vscode_url",e)}getVscodeReconnect(){return this.get("vscode_reconnect",!1)}setVscodeReconnect(e){this.set("vscode_reconnect",e)}getBackup(){return this.get("backup",{filesystem:"webdav",params:{}})}setBackup(e){this.set("backup",e)}getCloudSync(){return this.get("cloud_sync",{enable:!1,syncDelete:!0,syncStatus:!0,filesystem:"webdav",params:{}})}setCloudSync(e){this.set("cloud_sync",e)}getCatFileStorage(){return this.get("cat_file_storage",{status:"unset",filesystem:"webdav",params:{}})}setCatFileStorage(e){this.set("cat_file_storage",e)}getEnableEslint(){return this.get("enable_eslint",!0)}setEnableEslint(e){this.set("enable_eslint",e)}getEslintConfig(){return this.get("eslint_config",s.u)}setEslintConfig(e){return""===e?void this.set("eslint_config",void 0):(JSON.parse(e),this.set("eslint_config",e))}getEditorConfig(){return this.get("editor_config",a.u)}setEditorConfig(e){return""===e?void this.set("editor_config",void 0):(JSON.parse(e),this.set("editor_config",e))}getEditorTypeDefinition(){return localStorage.getItem("editor_type_definition")||o}setEditorTypeDefinition(e){if(""===e)return void delete localStorage.editor_type_definition;localStorage.setItem("editor_type_definition",e)}getLogCleanCycle(){return this.get("log_clean_cycle",7)}setLogCleanCycle(e){this.set("log_clean_cycle",e)}getScriptListColumnWidth(){return this.get("script_list_column_width",{})}setScriptListColumnWidth(e){this.set("script_list_column_width",e)}getMenuExpandNum(){return this.get("menu_expand_num",5)}setMenuExpandNum(e){this.set("menu_expand_num",e)}async getLanguage(){if(globalThis.localStorage){let e=localStorage.getItem("language");if(e)return e}return this.get("language",{asyncValue:()=>(0,n.kx)().then(e=>e||chrome.i18n.getUILanguage())}).then(e=>(globalThis.localStorage&&localStorage.setItem("language",`${e}`),e))}setLanguage(e){this.set("language",e),(0,n.D0)(e),globalThis.localStorage&&localStorage.setItem("language",e)}setCheckUpdate(e){this.set("check_update",{notice:e.notice,version:e.version,isRead:e.isRead})}getCheckUpdate(){return this.get("check_update",{notice:"",isRead:!1,version:l.mr})}setEnableScript(e){chrome.extension.inIncognitoContext?this.set("enable_script_incognito",e):this.set("enable_script",e)}async getEnableScript(){if(!chrome.extension.inIncognitoContext)return this.get("enable_script",!0);{let[e,t]=await Promise.all([this.get("enable_script",!0),this.get("enable_script_incognito",!0)]);return e&&t}}async getEnableScriptNormal(){return this.get("enable_script",!0)}async getEnableScriptIncognite(){return this.get("enable_script_incognito",!0)}setBlacklist(e){this.set("blacklist",e)}getBlacklist(){return this.get("blacklist","")}setBadgeNumberType(e){this.set("badge_number_type",e)}getBadgeNumberType(){return this.get("badge_number_type","run_count")}setBadgeBackgroundColor(e){this.set("badge_background_color",e)}getBadgeBackgroundColor(){return this.get("badge_background_color","#4e5969")}setBadgeTextColor(e){this.set("badge_text_color",e)}getBadgeTextColor(){return this.get("badge_text_color","#ffffff")}setScriptMenuDisplayType(e){this.set("script_menu_display_type",e)}getScriptMenuDisplayType(){return this.get("script_menu_display_type","all")}constructor(e){c(this,"mq",void 0),c(this,"cache",void 0),c(this,"storage",void 0),this.mq=e,this.cache=new Map,this.storage=new r.Z("system",!0),this.mq.subscribe(d,e=>{let{key:t,value:i}=e;this.cache.set(t,i)})}}let h="",p=0,m=e=>(h||(h=((1213056*Math.random()|0)+466560).toString(36).toUpperCase()),e=e.replace(/@name\s+(New Userscript)[\r\n]/g,(e,t)=>e.replace(t,`${t} ${h}-${++p}`)))},23831:function(e,t,i){function r(e){return a(new Date(1e3*e),"YYYY-MM-DD HH:mm:ss")}i.d(t,{F:()=>r,U:()=>a});let s=/YYYY|MM|DD|HH|mm|ss/g;function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm:ss";return t.replace(s,t=>{switch(t){case"YYYY":return e.getFullYear().toString();case"MM":{let t=e.getMonth()+1;return t<10?"0"+t:t.toString()}case"DD":{let t=e.getDate();return t<10?"0"+t:t.toString()}case"HH":{let t=e.getHours();return t<10?"0"+t:t.toString()}case"mm":{let t=e.getMinutes();return t<10?"0"+t:t.toString()}case"ss":{let t=e.getSeconds();return t<10?"0"+t:t.toString()}}return t})}},92249:function(e,t,i){i.d(t,{TJ:()=>n});var r=i(84663);class s extends r.ZP{constructor(){var e,t;super("filehandle-temp-dexie"),t=void 0,(e="handles")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t,this.version(1).stores({handles:""}),this.handles=this.table("handles")}}let a=new s;async function n(e,t){await a.handles.put({handle:t,timestamp:Date.now()},e)}},30723:function(e,t,i){i.d(t,{zg:()=>l});var r=i(50726),s=i(77811);i(56378);var a=i(24922),n=i(17245);async function l(e,t,i){let l,o,c,d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0;u=u??new s.Ru;let h=function(e){let t=!1,i=/\/\/\s*==UserScript==([\s\S]+?)\/\/\s*==\/UserScript==/m,r=i.exec(e);if(!r){if(!(r=(i=/\/\/\s*==UserSubscribe==([\s\S]+?)\/\/\s*==\/UserSubscribe==/m).exec(e)))return null;t=!0}let s={},a=(i=/\/\/\s*@([\S]+)((.+?)$|$)/gm).exec(r[1]);for(;null!==a;){let[e,t]=[a[1].toLowerCase().trim(),a[2].trim()],n=s[e];null==n&&(n=[]),n.push(t),s[e]=n,a=i.exec(r[1])}return void 0===s.name||Object.keys(s).length<3?null:(s.namespace||(s.namespace=[""]),t&&(s.usersubscribe=[]),s)}(e);if(null==h)throw Error("MetaData信息错误");if(void 0===h.name)throw Error("脚本名不能为空");if(void 0===h.version)throw Error("脚本@version版本不能为空");if(void 0===h.namespace)throw Error("脚本@namespace命名空间不能为空");let p=s.oO;if(void 0!==h.crontab){p=s.CP;try{(0,a.R)(h.crontab[0])}catch{throw Error(`\u{9519}\u{8BEF}\u{7684}\u{5B9A}\u{65F6}\u{8868}\u{8FBE}\u{5F0F},\u{8BF7}\u{68C0}\u{67E5}: ${h.crontab[0]}`)}}else void 0!==h.background&&(p=s.BW);let m="",f="",g=t;h.updateurl&&h.downloadurl?([f]=h.updateurl,[g]=h.downloadurl):f=t.replace("user.js","meta.js"),t.includes("/")&&(l=t.split("/"))[2]&&([,m]=l);let x=i||(0,r.Z)(),y=(0,n.J)(e),v=Date.now(),b={uuid:x,name:h.name[0],author:h.author&&h.author[0],namespace:h.namespace&&h.namespace[0],originDomain:m,origin:t,checkUpdate:!0,checkUpdateUrl:f,downloadUrl:g,config:y,metadata:h,selfMetadata:{},sort:-1,type:p,status:s.J7,runStatus:s.le,createtime:v,updatetime:v,checktime:v};if(i&&(o=await u.get(i)),o||i&&!d||(o=await u.findByNameAndNamespace(b.name,b.namespace)),o){if(o.type===s.oO&&b.type!==s.oO||b.type===s.oO&&o.type!==s.oO)throw Error("脚本类型不匹配,普通脚本与后台脚本不能互相转变");let e=await new s.Gf().get(o.uuid);if(!e)throw Error("旧的脚本代码不存在");c=e;let{uuid:t,createtime:i,lastruntime:r,error:a,sort:n,selfMetadata:l,subscribeUrl:d,checkUpdate:u,status:h}=o;Object.assign(b,{uuid:t,createtime:i,lastruntime:r,error:a,sort:n,selfMetadata:l||{},subscribeUrl:d,checkUpdate:u,status:h})}else b.type===s.oO&&(b.status=s.Kv),b.checktime=v;return{script:b,oldScript:o,oldScriptCode:null==c?void 0:c.code}}},19245:function(e,t,i){e.exports={}},72902:function(e,t,i){e.exports={}},63498:function(e,t,i){e.exports={}},70930:function(e,t,i){e.exports={}},21795:function(e,t,i){e.exports={}},92955:function(){},15589:function(e){e.exports={i8:"1.1.1"}}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=e,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce((t,r)=>(i.f[r](e,t),t),[])),i.k=e=>""+e+".css",i.u=e=>""+e+".js",i.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="scriptcat:";i.l=function(r,s,a,n){if(e[r])return void e[r].push(s);if(void 0!==a)for(var l,o,c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+a){l=u;break}}l||(o=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,i.nc&&l.setAttribute("nonce",i.nc),l.setAttribute("data-webpack",t+a),l.src=r),e[r]=[s];var h=function(t,i){l.onerror=l.onload=null,clearTimeout(p);var s=e[r];if(delete e[r],l.parentNode&&l.parentNode.removeChild(l),s&&s.forEach(function(e){return e(i)}),t)return t(i)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=h.bind(null,l.onerror),l.onload=h.bind(null,l.onload),o&&document.head.appendChild(l)}})(),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e=[];i.O=(t,r,s,a)=>{if(r){a=a||0;for(var n=e.length;n>0&&e[n-1][2]>a;n--)e[n]=e[n-1];e[n]=[r,s,a];return}for(var l=1/0,n=0;n<e.length;n++){for(var[r,s,a]=e[n],o=!0,c=0;c<r.length;c++)(!1&a||l>=a)&&Object.keys(i.O).every(e=>i.O[e](r[c]))?r.splice(c--,1):(o=!1,a<l&&(l=a));if(o){e.splice(n--,1);var d=s();void 0!==d&&(t=d)}}return t}})(),i.rv=()=>"1.4.4",i.j="3616",(()=>{i.g.importScripts&&(e=i.g.location+"");var e,t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var s=r.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=r[s--].src}if(!e)throw Error("Automatic publicPath is not supported in this browser");i.p=e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/")})(),(()=>{var e={1458:0,3616:0},t="scriptcat",r=(t,i)=>{e[i]=0},s="data-webpack-loading";r(i.m,0,"3616"),r(i.m,0,"1458"),i.f.css=(a,n,l)=>{var o=i.o(e,a)?e[a]:void 0;if(0!==o)if(o)n.push(o[2]);else if(/^(1458|3616)$/.test(a)){var c=new Promise(function(t,i){o=e[a]=[t,i]});n.push(o[2]=c);var d=i.p+i.k(a),u=Error(),h=function(t){if(i.o(e,a)&&(0!==(o=e[a])&&(e[a]=void 0),o))if("load"!==t.type){var s=t&&t.type,n=t&&t.target&&t.target.src;u.message="Loading css chunk "+a+" failed.\n("+s+": "+n+")",u.name="ChunkLoadError",u.type=s,u.request=n,o[1](u)}else r(i.m,a),o[0]()};"undefined"!=typeof document?((e,r,a,n,l)=>{var o,c,d="chunk-"+e;if(!n){for(var u=document.getElementsByTagName("link"),h=0;h<u.length;h++){var p=u[h],m=p.getAttribute("href")||p.href;if(m&&!m.startsWith(i.p)&&(m=i.p+(m.startsWith("/")?m.slice(1):m)),"stylesheet"==p.rel&&(m&&m.startsWith(r)||p.getAttribute("data-webpack")==t+":"+d)){o=p;break}}if(!a)return}o||(c=!0,o=document.createElement("link"),i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",t+":"+d),l&&o.setAttribute("fetchpriority",l),o.setAttribute(s,1),o.rel="stylesheet",o.href=r);var f=(e,t)=>{if(o.onerror=o.onload=null,o.removeAttribute(s),clearTimeout(g),t&&"load"!=t.type&&o.parentNode.removeChild(o),a(t),e)return e(t)};if(o.getAttribute(s)){var g=setTimeout(f.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=f.bind(null,o.onerror),o.onload=f.bind(null,o.onload)}else f(void 0,{type:"load",target:o});return n&&n.getAttribute("fetchpriority")&&o.setAttribute("fetchpriority",n.getAttribute("fetchpriority")),n?document.head.insertBefore(o,n):c&&document.head.appendChild(o)})(a,d,h,void 0,l):h({type:"load"})}else e[a]=0}})(),(()=>{var e={3616:0,7079:0};i.f.j=function(t,r){var s=i.o(e,t)?e[t]:void 0;if(0!==s)if(s)r.push(s[2]);else if(7079!=t){var a=new Promise((i,r)=>s=e[t]=[i,r]);r.push(s[2]=a);var n=i.p+i.u(t),l=Error();i.l(n,function(r){if(i.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var a=r&&("load"===r.type?"missing":r.type),n=r&&r.target&&r.target.src;l.message="Loading chunk "+t+" failed.\n("+a+": "+n+")",l.name="ChunkLoadError",l.type=a,l.request=n,s[1](l)}},"chunk-"+t,t)}else e[t]=0},i.O.j=t=>0===e[t];var t=(t,r)=>{var s,a,[n,l,o]=r,c=0;if(n.some(t=>0!==e[t])){for(s in l)i.o(l,s)&&(i.m[s]=l[s]);if(o)var d=o(i)}for(t&&t(r);c<n.length;c++)a=n[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(d)},r=self.webpackChunkscriptcat=self.webpackChunkscriptcat||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),i.ruid="bundler=rspack@1.4.4";var r=i.O(void 0,["9400","1458","1456","3603","8054","2438","9617","9887","6790","9841","3641","2266","2089","9796","5272","605","1122","7968","7079","5749"],function(){return i(97824)});r=i.O(r)})();