(()=>{"use strict";var e={70864:function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(e,t,o,r,i){if("function"!=typeof o)throw TypeError("The listener must be a function");var a=new s(o,r||e,i),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function a(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(n=!1)),a.prototype.eventNames=function(){var e,o,s=[];if(0===this._eventsCount)return s;for(o in e=this._events)t.call(e,o)&&s.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=n?n+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var s=0,r=o.length,i=Array(r);s<r;s++)i[s]=o[s].fn;return i},a.prototype.listenerCount=function(e){var t=n?n+e:e,o=this._events[t];return o?o.fn?1:o.length:0},a.prototype.emit=function(e,t,o,s,r,i){var a=n?n+e:e;if(!this._events[a])return!1;var l,d,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,o),!0;case 4:return c.fn.call(c.context,t,o,s),!0;case 5:return c.fn.call(c.context,t,o,s,r),!0;case 6:return c.fn.call(c.context,t,o,s,r,i),!0}for(d=1,l=Array(u-1);d<u;d++)l[d-1]=arguments[d];c.fn.apply(c.context,l)}else{var h,p=c.length;for(d=0;d<p;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),u){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,o);break;case 4:c[d].fn.call(c[d].context,t,o,s);break;default:if(!l)for(h=1,l=Array(u-1);h<u;h++)l[h-1]=arguments[h];c[d].fn.apply(c[d].context,l)}}return!0},a.prototype.on=function(e,t,n){return r(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return r(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,o,s){var r=n?n+e:e;if(!this._events[r])return this;if(!t)return i(this,r),this;var a=this._events[r];if(a.fn)a.fn!==t||s&&!a.once||o&&a.context!==o||i(this,r);else{for(var l=0,d=[],c=a.length;l<c;l++)(a[l].fn!==t||s&&!a[l].once||o&&a[l].context!==o)&&d.push(a[l]);d.length?this._events[r]=1===d.length?d[0]:d:i(this,r)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&i(this,t)):(this._events=new o,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),n.rv=()=>"1.4.4",n.ruid="bundler=rspack@1.4.4",(()=>{let e,t=/YYYY|MM|DD|HH|mm|ss/g;function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let s={none:0,trace:10,debug:100,info:1e3,warn:1e4,error:1e5};class r{log(e,n){let o;for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];let l=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let o={};return t.forEach(e=>{e.forEach(e=>{Object.keys(e).forEach(t=>{o[t]=e[t]})})}),o}(this.label,i);s[e]>=s[this.core.level]&&this.core.writer.write(e,n,l);try{o=JSON.stringify(l)}catch(e){o=l,console.error("Logger label JSON stringify error:",e)}if("none"!==this.core.consoleLevel&&s[e]>=s[this.core.consoleLevel]){"object"==typeof n&&(n=JSON.stringify(n));let s=`${function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm:ss";return n.replace(t,t=>{switch(t){case"YYYY":return e.getFullYear().toString();case"MM":{let t=e.getMonth()+1;return t<10?"0"+t:t.toString()}case"DD":{let t=e.getDate();return t<10?"0"+t:t.toString()}case"HH":{let t=e.getHours();return t<10?"0"+t:t.toString()}case"mm":{let t=e.getMinutes();return t<10?"0"+t:t.toString()}case"ss":{let t=e.getSeconds();return t<10?"0"+t:t.toString()}}return t})}(new Date,"YYYY-MM-DD HH:mm:ss")} [${e}] ${n}`;switch(e){case"error":console.error(s,o);break;case"warn":console.warn(s,o);break;default:console.info(s,o)}}}with(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new r(this.core,...this.label,...t)}trace(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.log("trace",e,...n)}debug(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.log("debug",e,...n)}info(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.log("info",e,...n)}warn(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.log("warn",e,...n)}error(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.log("error",e,...n)}static E(e){return"string"==typeof e?{error:e}:e instanceof Error?(console.error(e),{error:e.message}):"object"==typeof e?e:{}}constructor(e,...t){o(this,"core",void 0),o(this,"label",void 0),this.core=e,this.label=t}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{static getInstance(){return a.instance}static logger(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.getInstance().logger(...t)}logger(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new r(this,this.labels,...t)}constructor(e){i(this,"writer",void 0),i(this,"level","info"),i(this,"consoleLevel","warn"),i(this,"labels",void 0),this.writer=e.writer,this.level=e.level||this.level,this.labels=e.labels||{},void 0!==e.consoleLevel&&(this.consoleLevel=e.consoleLevel),a.instance||(a.instance=this)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}i(a,"instance",void 0);let d={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},c=new Uint8Array(16),u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let h=function(t,n,o){var s;if(d.randomUUID&&!n&&!t)return d.randomUUID();let r=(t=t||{}).random??(null==(s=t.rng)?void 0:s.call(t))??function(){if(!e){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");e=crypto.getRandomValues.bind(crypto)}return e(c)}();if(r.length<16)throw Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){if((o=o||0)<0||o+16>n.length)throw RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let e=0;e<16;++e)n[o+e]=r[e];return n}return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase()}(r)};var p=n(70864);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class f{sendMessage(e){let t={messageId:this.messageId,type:"connectMessage",data:e};this.target.postMessage(t)}onMessage(e){this.EE.addListener(`connectMessage:${this.messageId}`,e)}disconnect(){let e={messageId:this.messageId,type:"disconnect",data:null};this.target.postMessage(e)}onDisconnect(e){this.EE.addListener(`disconnect:${this.messageId}`,e)}constructor(e,t,n){g(this,"messageId",void 0),g(this,"EE",void 0),g(this,"target",void 0),this.messageId=e,this.EE=t,this.target=n,this.onDisconnect(()=>{this.EE.removeAllListeners("connectMessage:"+this.messageId),this.EE.removeAllListeners("disconnect:"+this.messageId)})}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class v{postMessage(e){this.send.nativeSend(e)}constructor(e){m(this,"send",void 0),this.send=e}}async function M(e,t,n){let o=await e.sendMessage({action:t,data:n}),s=a.getInstance().logger().with({action:t,data:n,response:o});if(s.trace("sendMessage"),null==o?void 0:o.code)throw console.error(o),o.message;try{return o.data}catch(e){s.trace("Invalid response data",r.E(e));return}}class y{sendMessage(e){this.con.postMessage(e)}onMessage(e){this.con.onMessage.addListener(e)}disconnect(){this.con.disconnect()}onDisconnect(e){this.con.onDisconnect.addListener(e)}getPort(){return this.con}constructor(e){!function(e,t,n){"con"in e?Object.defineProperty(e,"con",{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"con",void 0),this.con=e}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class w{getSender(){return this.sender instanceof y?this.sender.getPort().sender:this.sender}getExtMessageSender(){var e,t,n,o,s,r,i,a;if(this.sender instanceof y){let e=this.sender.getPort();return{windowId:(null==(o=e.sender)||null==(n=o.tab)?void 0:n.windowId)||-1,tabId:(null==(r=e.sender)||null==(s=r.tab)?void 0:s.id)||-1,frameId:null==(i=e.sender)?void 0:i.frameId,documentId:null==(a=e.sender)?void 0:a.documentId}}let l=this.sender;return{windowId:(null==(e=l.tab)?void 0:e.windowId)||-1,tabId:(null==(t=l.tab)?void 0:t.id)||-1,frameId:l.frameId,documentId:l.documentId}}getConnect(){return this.sender}constructor(e){b(this,"sender",void 0),this.sender=e}}class _{group(e,t){let n=new _(this.server,`${this.name}${e}`,t);return n.middlewares=[...this.middlewares,...n.middlewares],n}use(e){let t=new _(this.server,`${this.name}`,e);return t.middlewares=[...this.middlewares,...t.middlewares],t}on(e,t){let n=`${this.name}${e}`;0===this.middlewares.length?this.server.on(n,t):this.server.on(n,async(e,n)=>{let o=0,s=async()=>{if(!(o<this.middlewares.length))return await t(e,n);{let t=this.middlewares[o++];return await t(e,n,s)}};return await s()})}constructor(e,t,n){b(this,"server",void 0),b(this,"name",void 0),b(this,"middlewares",void 0),this.server=e,this.name=t,this.middlewares=[],!t.endsWith("/")&&t.length>0&&(this.name+="/"),n&&this.middlewares.push(n)}}let G=new Map;function I(e,t,n,o){let s=G.get(e);s||G.set(e,s=[]),s.push({fnKey:t,api:n,param:o})}let A={};class C{static protected(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return(t,n)=>{A[n]=e}}static API(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t,n,o)=>{let{follow:s}=e,{alias:r}=e;s||(s=n),I(s,n,o.value,e),r&&I(r,r,o.value,e)}}}function E(e){var t;let n=null==(t=e.metadata)?void 0:t.storagename;return n?n[0]:e.uuid}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t,n,o){var s,r=arguments.length,i=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(i=(r<3?s(i):r>3?s(t,n,i):s(t,n))||i);return r>3&&i&&Object.defineProperty(t,n,i),i}let x={};class k{static createGMBase(e){return new k(e,x)}async sendMessage(e,t){return this.loadScriptPromise&&await this.loadScriptPromise,M(this.message,`${this.prefix}/runtime/gmApi`,{uuid:this.scriptRes.uuid,api:e,params:t,runFlag:this.runFlag})}connect(e,t){var n,o,s;return n=this.message,o=`${this.prefix}/runtime/gmApi`,s={uuid:this.scriptRes.uuid,api:e,params:t,runFlag:this.runFlag},n.connect({action:o,data:s})}valueUpdate(e){(e.uuid===this.scriptRes.uuid||e.storageName===E(this.scriptRes))&&(void 0===e.value?void 0!==this.scriptRes.value[e.key]&&delete this.scriptRes.value[e.key]:this.scriptRes.value[e.key]=e.value,this.valueChangeListener.forEach(t=>{t.name===e.key&&t.listener(e.key,e.oldValue,e.value,e.sender.runFlag!==this.runFlag,e.sender.tabId)}))}emitEvent(e,t,n){this.EE.emit(`${e}:${t}`,n)}constructor(e=null,t=null){if(P(this,"runFlag",void 0),P(this,"prefix",void 0),P(this,"message",void 0),P(this,"scriptRes",void 0),P(this,"valueChangeListener",void 0),P(this,"EE",void 0),P(this,"context",void 0),P(this,"grantSet",void 0),P(this,"eventId",void 0),P(this,"loadScriptResolve",void 0),P(this,"loadScriptPromise",void 0),t!==x)throw TypeError("Illegal invocation");Object.assign(this,e)}}T([C.protected()],k.prototype,"runFlag",void 0),T([C.protected()],k.prototype,"prefix",void 0),T([C.protected()],k.prototype,"message",void 0),T([C.protected()],k.prototype,"scriptRes",void 0),T([C.protected()],k.prototype,"valueChangeListener",void 0),T([C.protected()],k.prototype,"EE",void 0),T([C.protected()],k.prototype,"context",void 0),T([C.protected()],k.prototype,"grantSet",void 0),T([C.protected()],k.prototype,"eventId",void 0),T([C.protected()],k.prototype,"loadScriptResolve",void 0),T([C.protected()],k.prototype,"loadScriptPromise",void 0),T([C.protected()],k,"createGMBase",null),T([C.protected()],k.prototype,"sendMessage",null),T([C.protected()],k.prototype,"connect",null),T([C.protected()],k.prototype,"valueUpdate",null),T([C.protected()],k.prototype,"emitEvent",null);class L extends k{static _GM_getValue(e,t,n){let o=e.scriptRes.value[t];return void 0!==o?o:n}GM_getValue(e,t){return S(this,e,t)}"GM.getValue"(e,t){return new Promise(n=>{n(S(this,e,t))})}static _GM_setValue(e,t,n){"object"==typeof n&&(n=JSON.parse(JSON.stringify(n))),void 0===n?(delete e.scriptRes.value[t],e.sendMessage("GM_setValue",[t])):(e.scriptRes.value[t]=n,e.sendMessage("GM_setValue",[t,n]))}GM_setValue(e,t){j(this,e,t)}"GM.setValue"(e,t){return new Promise(n=>{j(this,e,t),n()})}GM_deleteValue(e){j(this,e,void 0)}"GM.deleteValue"(e){return new Promise(t=>{j(this,e,void 0),t()})}GM_listValues(){return Object.keys(this.scriptRes.value)}"GM.listValues"(){return new Promise(e=>{e(Object.keys(this.scriptRes.value))})}GM_setValues(e){if(null==e)throw Error("GM_setValues: values must not be null or undefined");if("object"!=typeof e)throw Error("GM_setValues: values must be an object");for(let t of Object.keys(e)){let n=e[t];j(this,t,n)}}GM_getValues(e){if(null==e)return this.scriptRes.value;let t={};if(Array.isArray(e))for(let n=0;n<e.length;n++){let o=e[n];o in this.scriptRes.value&&(t[o]=this.scriptRes.value[o])}else for(let n of Object.keys(e)){let o=e[n];t[n]=S(this,n,o)}return t}"GM.getValues"(e){return new Promise(t=>{t(this.GM_getValues(e))})}"GM.setValues"(e){return new Promise(t=>{this.GM_setValues(e),t()})}GM_deleteValues(e){if(!Array.isArray(e))return void console.warn("GM_deleteValues: keys must be string[]");for(let t of e)j(this,t,void 0)}"GM.deleteValues"(e){return new Promise(t=>{this.GM_deleteValues(e),t()})}GM_addValueChangeListener(e,t){return this.eventId+=1,this.valueChangeListener.set(this.eventId,{name:e,listener:t}),this.eventId}GM_removeValueChangeListener(e){this.valueChangeListener.delete(e)}GM_log(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";for(var n=arguments.length,o=Array(n>2?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];"string"!=typeof e&&(e=JSON.stringify(e));let r=[e,t];o.length>0&&r.push(o),this.sendMessage("GM_log",r)}CAT_createBlobUrl(e){return this.sendMessage("CAT_createBlobUrl",[e])}CAT_fetchBlob(e){return this.sendMessage("CAT_fetchBlob",[e])}async CAT_fetchDocument(e){let t=await this.sendMessage("CAT_fetchDocument",[e]);return this.message.getAndDelRelatedTarget(t.relatedTarget)}static _GM_cookie(e,t,n,o){n.url||n.domain||(n.url=window.location.href),"set"!==t&&"delete"!==t||n.url||(n.url=window.location.href),e.sendMessage("GM_cookie",[t,n]).then(e=>{o&&o(e,void 0)}).catch(e=>{o&&o(void 0,e)})}"GM.cookie"(e,t){return new Promise((n,o)=>{O(this,e,t,(e,t)=>{t?o(t):n(e)})})}"GM.cookie.set"(e){return new Promise((t,n)=>{O(this,"set",e,(e,o)=>{o?n(o):t(e)})})}"GM.cookie.list"(e){return new Promise((t,n)=>{O(this,"list",e,(e,o)=>{o?n(o):t(e)})})}"GM.cookie.delete"(e){return new Promise((t,n)=>{O(this,"delete",e,(e,o)=>{o?n(o):t(e)})})}"GM_cookie.set"(e,t){O(this,"set",e,t)}"GM_cookie.list"(e,t){O(this,"list",e,t)}"GM_cookie.delete"(e,t){O(this,"delete",e,t)}GM_cookie(e,t,n){O(this,e,t,n)}GM_registerMenuCommand(e,t,n){if(this.menuMap||(this.menuMap=new Map),"object"==typeof n){let o=n;if(o.id&&this.menuMap.has(o.id))return this.EE.removeAllListeners("menuClick:"+o.id),this.EE.addListener("menuClick:"+o.id,t),this.sendMessage("GM_registerMenuCommand",[o.id,e,o]),o.id}else{n={accessKey:n};let t=0;if(this.menuMap.forEach((n,o)=>{n===e&&(t=o)}),t)return t}this.eventId+=1;let o=this.eventId;return n.id=o,this.menuMap.set(o,e),this.EE.addListener("menuClick:"+o,t),this.sendMessage("GM_registerMenuCommand",[o,e,n]),o}CAT_registerMenuInput(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.GM_registerMenuCommand(...t)}GM_addStyle(e){let t=this.message.syncSendMessage({action:`${this.prefix}/runtime/gmApi`,data:{uuid:this.scriptRes.uuid,api:"GM_addElement",params:[null,"style",{textContent:e}]}});if(t.code)throw Error(t.message);return this.message.getAndDelRelatedTarget(t.data)}GM_addElement(e,t,n){let o=e;o="string"!=typeof o?this.message.sendRelatedTarget(o):null;let s=this.message.syncSendMessage({action:`${this.prefix}/runtime/gmApi`,data:{uuid:this.scriptRes.uuid,api:"GM_addElement",params:[o,"string"==typeof e?e:t,"string"==typeof e?t:n]}});if(s.code)throw Error(s.message);return this.message.getAndDelRelatedTarget(s.data)}GM_unregisterMenuCommand(e){this.menuMap||(this.menuMap=new Map),this.menuMap.delete(e),this.EE.removeAllListeners("menuClick:"+e),this.sendMessage("GM_unregisterMenuCommand",[e])}CAT_unregisterMenuInput(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.GM_unregisterMenuCommand(...t)}CAT_userConfig(){return this.sendMessage("CAT_userConfig",[])}async CAT_fileStorage(e,t){if("config"===e)return void this.sendMessage("CAT_fileStorage",["config"]);let n={baseDir:t.baseDir||"",path:t.path||"",filename:t.filename,file:t.file};"upload"===e&&(n.data=await this.CAT_createBlobUrl(t.data)),this.sendMessage("CAT_fileStorage",[e,n]).then(async n=>{switch(n.action){case"onload":if("download"===e){let e=await this.CAT_fetchBlob(n.data);t.onload&&t.onload(e)}else t.onload&&t.onload(n.data);break;case"error":if(void 0===n.data.code){t.onerror&&t.onerror({code:-1,message:n.data.message});return}t.onerror&&t.onerror(n.data)}})}static _GM_xmlhttpRequest(e,t){let n,o=new URL(t.url,window.location.href),s=t.headers;if(s)for(let e of Object.keys(s))"cookie"===e.toLowerCase()&&(t.cookie=s[e],delete s[e]);let r={method:t.method,timeout:t.timeout,url:o.href,headers:t.headers,cookie:t.cookie,context:t.context,responseType:t.responseType,overrideMimeType:t.overrideMimeType,anonymous:t.anonymous,user:t.user,password:t.password,redirect:t.redirect};return r.headers||(r.headers={}),t.nocache&&(r.headers["Cache-Control"]="no-cache"),(async()=>{var o;let s,i;if(t.data instanceof FormData){r.dataType="FormData";let n={};t.data.forEach((e,t)=>{n[t]=!0}),r.data=await Promise.all(Object.keys(n).flatMap(n=>t.data.getAll(n).map(t=>t instanceof File?e.CAT_createBlobUrl(t).then(e=>({key:n,type:"file",val:e,filename:t.name})):{key:n,type:"text",val:t})))}else t.data instanceof Blob?(r.dataType="Blob",r.data=await e.CAT_createBlobUrl(t.data)):r.data=t.data;let l=null==(o=t.responseType)?void 0:o.toLocaleLowerCase(),d=t=>("stream"===l&&(s=new ReadableStream({start(e){i=e}})),async n=>{if(n.response)if("document"===l)n.response=await e.CAT_fetchDocument(n.response),n.responseXML=n.response,n.responseType="document";else{let t=await e.CAT_fetchBlob(n.response);"arraybuffer"===l?n.response=await t.arrayBuffer():n.response=t}"stream"===l&&(n.response=s),t(n)});("arraybuffer"===l||"blob"===l||"document"===l||"stream"===l)&&(t.onload&&(t.onload=d(t.onload)),t.onreadystatechange&&(t.onreadystatechange=d(t.onreadystatechange)),t.onloadend&&(t.onloadend=d(t.onloadend)),"document"===l&&(r.responseType="blob"),"stream"===l&&t.onloadstart&&(t.onloadstart=d(t.onloadstart))),e.connect("GM_xmlhttpRequest",[r]).then(e=>{n=e,e.onMessage(e=>{var n,o,s,r,l,d,c;if(-1===e.code){a.logger().error("GM_xmlhttpRequest error",{code:e.code,message:e.message}),t.onerror&&t.onerror({readyState:4,error:e.message||"unknown"});return}switch(e.action){case"onload":null==(n=t.onload)||n.call(t,e.data);break;case"onloadend":null==(o=t.onloadend)||o.call(t,e.data);break;case"onloadstart":null==(s=t.onloadstart)||s.call(t,e.data);break;case"onprogress":null==(r=t.onprogress)||r.call(t,e.data);break;case"onreadystatechange":t.onreadystatechange&&t.onreadystatechange(e.data);break;case"ontimeout":null==(l=t.ontimeout)||l.call(t);break;case"onerror":null==(d=t.onerror)||d.call(t,e.data);break;case"onabort":null==(c=t.onabort)||c.call(t);break;case"onstream":null==i||i.enqueue(new Uint8Array(e.data));break;default:a.logger().warn("GM_xmlhttpRequest resp is error",{data:e})}})})})(),{abort:()=>{n&&n.disconnect()}}}GM_xmlhttpRequest(e){return V(this,e)}"GM.xmlHttpRequest"(e){let t,n=new Promise((n,o)=>{let s=e.onload;e.onloadend=e=>{s&&s(e),n(e)};let r=e.onerror;e.onerror=e=>{r&&r(e),o(e)},t=V(this,e)});return n.abort=()=>{t&&t.abort&&t.abort()},n}GM_download(e,t){let n,o;return n="string"==typeof e?{name:t||"",url:e}:e,this.connect("GM_download",[{method:n.method,downloadMode:n.downloadMode||"native",url:n.url,name:n.name,headers:n.headers,saveAs:n.saveAs,timeout:n.timeout,cookie:n.cookie,anonymous:n.anonymous}]).then(e=>{(o=e).onMessage(e=>{switch(e.action){case"onload":n.onload&&n.onload(e.data);break;case"onprogress":n.onprogress&&n.onprogress(e.data);break;case"ontimeout":n.ontimeout&&n.ontimeout();break;case"onerror":n.onerror&&n.onerror({error:"unknown"});break;default:a.logger().warn("GM_download resp is error",{data:e})}})}),{abort:()=>{null==o||o.disconnect()}}}async GM_notification(e,t,n,o){let s,r,i,l,d,c=this.notificationTagMap||(this.notificationTagMap=new Map);if(this.eventId+=1,"string"==typeof e)switch((s={}).text=e,arguments.length){case 4:s.onclick=o;case 3:s.image=n;case 2:s.title=t}else(s=Object.assign({},e)).ondone=s.ondone||t;s.onclick&&(r=s.onclick,delete s.onclick),s.ondone&&(i=s.ondone,delete s.ondone),s.oncreate&&(l=s.oncreate,delete s.oncreate),"string"==typeof s.tag&&(d=c.get(s.tag)),this.sendMessage("GM_notification",[s,d]).then(e=>{l&&l.apply({id:e},[e]),"string"==typeof s.tag&&c.set(s.tag,e);let t=!1;this.EE.addListener("GM_notification:"+e,n=>{switch(n.event){case"click":case"buttonClick":{let o={event:n.event,id:e,isButtonClick:"buttonClick"===n.event,buttonClickIndex:n.params.index,byUser:n.params.byUser,preventDefault:function(){t=!0},highlight:s.highlight,image:s.image,silent:s.silent,tag:s.tag,text:s.tag,timeout:s.timeout,title:s.title,url:s.url};r&&r.apply({id:e},[o]),i&&i.apply({id:e},[]),t||"string"!=typeof s.url||(window.open(s.url,"_blank"),a.logger().info("GM_notification open urlï¼š"+s.url,{data:s}));break}case"close":i&&i.apply({id:e},[n.params.byUser]),"string"==typeof s.tag&&c.delete(s.tag),this.EE.removeAllListeners("GM_notification:"+this.eventId);break;default:a.logger().warn("GM_notification resp is error",{resp:n})}})})}GM_closeNotification(e){this.sendMessage("GM_closeNotification",[e])}GM_updateNotification(e,t){this.sendMessage("GM_updateNotification",[e,t])}GM_openInTab(e,t){let n,o={};1==arguments.length?o.active=!0:"boolean"==typeof t?o.active=!t:o=t,void 0===o.active&&(o.active=!0);let s={close:()=>{n&&this.GM_closeInTab(n)},closed:!1,onclose(){}};return this.sendMessage("GM_openInTab",[e,o]).then(e=>{e?(n=e,this.EE.addListener("GM_openInTab:"+e,t=>{switch(t.event){case"oncreate":n=t.tabId;break;case"onclose":s.onclose&&s.onclose(),s.closed=!0,this.EE.removeAllListeners("GM_openInTab:"+e);break;default:a.logger().warn("GM_openInTab resp is error",{resp:t})}})):(s.onclose&&s.onclose(),s.closed=!0)}),s}GM_closeInTab(e){return this.sendMessage("GM_closeInTab",[e])}GM_getTab(e){this.sendMessage("GM_getTab",[]).then(t=>{e(t??{})})}"GM.getTab"(){return new Promise(e=>{this.GM_getTab(t=>{e(t)})})}GM_saveTab(e){"object"==typeof e&&(e=JSON.parse(JSON.stringify(e))),this.sendMessage("GM_saveTab",[e])}GM_getTabs(e){this.sendMessage("GM_getTabs",[]).then(t=>{e(t)})}"GM.getTabs"(){return new Promise(e=>{this.GM_getTabs(t=>{e(t)})})}GM_setClipboard(e,t,n){this.sendMessage("GM_setClipboard",[e,t]).then(()=>{"function"==typeof n&&n()}).catch(()=>{"function"==typeof n&&n()})}"GM.setClipboard"(e,t){return this.sendMessage("GM_setClipboard",[e,t])}GM_getResourceText(e){if(!this.scriptRes.resource)return;let t=this.scriptRes.resource[e];if(t)return t.content}"GM.getResourceText"(e){return new Promise(t=>{t(this.GM_getResourceText(e))})}GM_getResourceURL(e,t){if(!this.scriptRes.resource)return;let n=this.scriptRes.resource[e];if(n){let e=n.base64;return(e||(e=`data:${n.contentType};base64,${btoa(encodeURIComponent(n.content).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(parseInt(`0x${t}`,16))))}`),t)?URL.createObjectURL(function(e){let t=e.split(",")[0].split(":")[1].split(";")[0],n=atob(e.split(",")[1]),o=new Uint8Array(new ArrayBuffer(n.length));for(let e=0;e<n.length;e+=1)o[e]=n.charCodeAt(e);return new Blob([o],{type:t})}(e)):e}}"GM.getResourceUrl"(e,t){return new Promise(n=>{n(this.GM_getResourceURL(e,t))})}"window.close"(){return this.sendMessage("window.close",[])}"window.focus"(){return this.sendMessage("window.focus",[])}CAT_scriptLoaded(){return this.loadScriptPromise}constructor(e,t,n){super({prefix:e,message:t,scriptRes:n,valueChangeListener:new Map,EE:new p,notificationTagMap:new Map,eventId:0},x),P(this,"prefix",void 0),P(this,"message",void 0),P(this,"scriptRes",void 0),P(this,"notificationTagMap",void 0),P(this,"menuMap",void 0),P(this,"apiLoadPromise",void 0),this.prefix=e,this.message=t,this.scriptRes=n}}T([C.API()],L.prototype,"GM_getValue",null),T([C.API()],L.prototype,"GM.getValue",null),T([C.API()],L.prototype,"GM_setValue",null),T([C.API()],L.prototype,"GM.setValue",null),T([C.API()],L.prototype,"GM_deleteValue",null),T([C.API()],L.prototype,"GM.deleteValue",null),T([C.API()],L.prototype,"GM_listValues",null),T([C.API()],L.prototype,"GM.listValues",null),T([C.API()],L.prototype,"GM_setValues",null),T([C.API()],L.prototype,"GM_getValues",null),T([C.API({depend:["GM_getValues"]})],L.prototype,"GM.getValues",null),T([C.API({depend:["GM_setValues"]})],L.prototype,"GM.setValues",null),T([C.API()],L.prototype,"GM_deleteValues",null),T([C.API({depend:["GM_deleteValues"]})],L.prototype,"GM.deleteValues",null),T([C.API({alias:"GM.addValueChangeListener"})],L.prototype,"GM_addValueChangeListener",null),T([C.API({alias:"GM.removeValueChangeListener"})],L.prototype,"GM_removeValueChangeListener",null),T([C.API({alias:"GM.log"})],L.prototype,"GM_log",null),T([C.API()],L.prototype,"CAT_createBlobUrl",null),T([C.API()],L.prototype,"CAT_fetchBlob",null),T([C.API()],L.prototype,"CAT_fetchDocument",null),T([C.API({follow:"GM.cookie"})],L.prototype,"GM.cookie",null),T([C.API({follow:"GM.cookie"})],L.prototype,"GM.cookie.set",null),T([C.API({follow:"GM.cookie"})],L.prototype,"GM.cookie.list",null),T([C.API({follow:"GM.cookie"})],L.prototype,"GM.cookie.delete",null),T([C.API({follow:"GM_cookie"})],L.prototype,"GM_cookie.set",null),T([C.API({follow:"GM_cookie"})],L.prototype,"GM_cookie.list",null),T([C.API({follow:"GM_cookie"})],L.prototype,"GM_cookie.delete",null),T([C.API()],L.prototype,"GM_cookie",null),T([C.API({alias:"GM.registerMenuCommand"})],L.prototype,"GM_registerMenuCommand",null),T([C.API({depend:["GM_registerMenuCommand"]})],L.prototype,"CAT_registerMenuInput",null),T([C.API({alias:"GM.addStyle"})],L.prototype,"GM_addStyle",null),T([C.API({alias:"GM.addElement"})],L.prototype,"GM_addElement",null),T([C.API({alias:"GM.unregisterMenuCommand"})],L.prototype,"GM_unregisterMenuCommand",null),T([C.API({depend:["GM_unregisterMenuCommand"]})],L.prototype,"CAT_unregisterMenuInput",null),T([C.API()],L.prototype,"CAT_userConfig",null),T([C.API({depend:["CAT_fetchBlob","CAT_createBlobUrl"]})],L.prototype,"CAT_fileStorage",null),T([C.API({depend:["CAT_fetchBlob","CAT_createBlobUrl","CAT_fetchDocument"]})],L.prototype,"GM_xmlhttpRequest",null),T([C.API({depend:["CAT_fetchBlob","CAT_createBlobUrl","CAT_fetchDocument"]})],L.prototype,"GM.xmlHttpRequest",null),T([C.API({alias:"GM.download"})],L.prototype,"GM_download",null),T([C.API({depend:["GM_closeNotification","GM_updateNotification"],alias:"GM.notification"})],L.prototype,"GM_notification",null),T([C.API({alias:"GM.closeNotification"})],L.prototype,"GM_closeNotification",null),T([C.API({alias:"GM.updateNotification"})],L.prototype,"GM_updateNotification",null),T([C.API({depend:["GM_closeInTab"],alias:"GM.openInTab"})],L.prototype,"GM_openInTab",null),T([C.API({alias:"GM.closeInTab"})],L.prototype,"GM_closeInTab",null),T([C.API()],L.prototype,"GM_getTab",null),T([C.API({depend:["GM_getTab"]})],L.prototype,"GM.getTab",null),T([C.API({alias:"GM.saveTab"})],L.prototype,"GM_saveTab",null),T([C.API()],L.prototype,"GM_getTabs",null),T([C.API({depend:["GM_getTabs"]})],L.prototype,"GM.getTabs",null),T([C.API({})],L.prototype,"GM_setClipboard",null),T([C.API({depend:["GM_setClipboard"]})],L.prototype,"GM.setClipboard",null),T([C.API()],L.prototype,"GM_getResourceText",null),T([C.API({depend:["GM_getResourceText"]})],L.prototype,"GM.getResourceText",null),T([C.API()],L.prototype,"GM_getResourceURL",null),T([C.API({depend:["GM_getResourceURL"]})],L.prototype,"GM.getResourceUrl",null),T([C.API()],L.prototype,"window.close",null),T([C.API()],L.prototype,"window.focus",null),T([C.protected()],L.prototype,"apiLoadPromise",void 0),T([C.API()],L.prototype,"CAT_scriptLoaded",null);let{createGMBase:R}=k,{_GM_getValue:S,_GM_cookie:O,_GM_setValue:j,_GM_xmlhttpRequest:V}=L,U={this:!0,arguments:!0,[Symbol.unscopables]:!0},D=new Set(["eval","window","self","globalThis","top","parent"]),$=Object.getOwnPropertyDescriptors(n.g),B={},F={};((e,t)=>{for(;e&&e!==Object;)Object.entries(Object.getOwnPropertyDescriptors(e)).forEach(t),e=Object.getPrototypeOf(e)})(n.g,e=>{let[t,o]=e;if(!(!o||D.has(t))&&"string"==typeof t){if(D.add(t),o.writable){let e=o.value;if((e=>{if("function"!=typeof e||"prototype"in e)return!1;let{name:t}=e;if(!t)return!1;let n=t.charCodeAt(0);return n>=97&&n<=122})(e)){let s=e.bind(n.g);B[t]={...o,value:s}}}else if(o.configurable&&o.get&&o.set&&o.enumerable&&t.startsWith("on"))F[t]=o;else if(o.get||o.set){var s,r;B[t]={...o,get:null==o||null==(s=o.get)?void 0:s.bind(n.g),set:null==o||null==(r=o.set)?void 0:r.bind(n.g)}}}}),D.clear();let N=Object.create(null,{...$,...B}),H=["greasyfork.org","scriptcat.org","tampermonkey.net.cn","openuserjs.org"];function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class q{emitEvent(e,t,n){var o;this.logger.debug("emit event",{event:e,eventId:t,data:n}),null==(o=this.sandboxContext)||o.emitEvent(e,t,n)}valueUpdate(e){var t;null==(t=this.sandboxContext)||t.valueUpdate(e)}exec(){this.logger.debug("script start");let e=this.sandboxContext;return this.execContext=e?(e=>{let t,o=Object.getOwnPropertyDescriptors(N),s=e=>function(){let o=e.call(n.g);return o===n.g?t:o},r=e=>{let o=e.slice(2),s={fn:null,handleEvent(r){let i=t[e];i&&i===this.fn?i.call(t,r):(n.g.removeEventListener(o,s),this.fn=null)}};return{get:()=>s.fn,set(e){let{fn:t}=s;if(e!==t){let r;(r=e)!==Object(r)&&(e=null),typeof t!=typeof e&&("function"==typeof t?n.g.removeEventListener(o,s):"function"==typeof e&&n.g.addEventListener(o,s)),s.fn=e}}}};for(let e of Object.keys(F)){let t=r(e);o[e]={...o[e],...t}}for(let e of["window","self","globalThis","top","parent"]){let r=o[e];(null==r?void 0:r.value)===n.g?(r.get=function(){return t},r.set=void 0,delete r.writable,delete r.value):(null==r?void 0:r.get)&&(r.get=s(r.get),r.set=void 0)}for(let e of(o.$={enumerable:!1,configurable:!0,get(){return delete this.$,t}},(t=Object.create(Object.getPrototypeOf(N),o))[Symbol.unscopables]={...t[Symbol.unscopables]||{},...U},["define","module","exports"]))t[e]=void 0;for(let n of Object.keys(e))n in A||"window"===n||(t[n]=e[n]);let i=e.window;return(null==i?void 0:i.close)&&(t.close=i.close),(null==i?void 0:i.focus)&&(t.focus=i.focus),(null==i?void 0:i.onurlchange)===null&&(t.onurlchange=null),t})(e):n.g,this.scriptFunc.call(this.execContext,this.named,this.scriptRes.name)}dealEarlyScript(e){var t,n,o;let s;this.sandboxContext?(null==(t=(n=this.sandboxContext).loadScriptResolve)||t.call(n),s=this.execContext.GM_info):s=null==(o=this.named)?void 0:o.GM_info,s.isIncognito=e.isIncognito,s.sandboxMode=e.sandboxMode,s.userAgentData=e.userAgentData}stop(){return this.logger.debug("script stop"),!0}constructor(e,t,n,o,s,r){Y(this,"scriptRes",void 0),Y(this,"scriptFunc",void 0),Y(this,"logger",void 0),Y(this,"sandboxContext",void 0),Y(this,"named",void 0),Y(this,"execContext",void 0),this.scriptRes=e,this.logger=a.getInstance().logger({component:"exec",uuid:e.uuid,name:e.name});let i=function(e,t){var n,o,s,r,i;let a={description:(null==(n=t.metadata.description)?void 0:n[0])||null,matches:t.metadata.match||[],includes:t.metadata.include||[],"run-at":(null==(o=t.metadata["run-at"])?void 0:o[0])||"document-idle","run-in":t.metadata["run-in"]||[],icon:(null==(s=t.metadata.icon)?void 0:s[0])||null,icon64:(null==(r=t.metadata.icon64)?void 0:r[0])||null,header:t.metadataStr,grant:t.metadata.grant||[],connects:t.metadata.connect||[]};return{downloadMode:"native",isIncognito:e.isIncognito,sandboxMode:e.sandboxMode,scriptWillUpdate:!0,scriptHandler:"ScriptCat",userAgentData:e.userAgentData,scriptUpdateURL:t.downloadUrl||null,scriptMetaStr:t.metadataStr,userConfig:t.userConfig,userConfigStr:t.userConfigStr,version:"1.1.1",script:{name:t.name,namespace:t.namespace,version:null==(i=t.metadata.version)?void 0:i[0],author:t.author,lastModified:t.updatetime,downloadURL:t.downloadUrl||null,updateURL:t.checkUpdateUrl||null,...a}}}(s,e);"string"==typeof o?this.scriptFunc=Function(o):this.scriptFunc=o;let l=new Set(e.metadata.grant||[]);l.has("none")?this.named={GM:{info:i},GM_info:i}:(this.sandboxContext=((e,t,n,o,s)=>{let r,i,a=new Map,l=new p;(function(e){return e.metadata["run-at"]&&"document-start"===e.metadata["run-at"][0]&&e.metadata["early-start"]})(e)&&(r=new Promise(e=>{i=e}));let d=R({prefix:n,message:o,scriptRes:e,valueChangeListener:a,EE:l,runFlag:h(),eventId:1e4,GM:{info:t},GM_info:t,window:{},grantSet:new Set,loadScriptPromise:r,loadScriptResolve:i}),c={},u=e=>{let t=d.grantSet,n=G.get(e);if(!n)return!1;if(t.has(e))return!0;for(let{fnKey:o,api:s,param:r}of(t.add(e),n)){c[o]=s.bind(d);let e=null==r?void 0:r.depend;if(e)for(let t of e)u(t)}return!0};for(let e of s)u(e);for(let e of Object.keys(c)){let t=e.split("."),n=t.length,o=d,s="";for(let e=0;e<n;e++){let n=t[e];s+=`${e?".":""}${n}`,o=o[n]||(o[n]=c[s]||{})}}return d.unsafeWindow=window,d})(e,i,t,n,l),r&&Object.assign(this.sandboxContext,r))}}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let W=new class{messageHandle(e,t){"sendMessage"===e.type?this.EE.emit("message",e.data,n=>{if(!e.messageId)return;let o={messageId:e.messageId,type:"respMessage",data:n};t.postMessage(o)}):"respMessage"===e.type?this.EE.emit(`response:${e.messageId}`,e):"connect"===e.type?this.EE.emit("connect",e.data,new f(e.messageId,this.EE,t)):"disconnect"===e.type?this.EE.emit(`disconnect:${e.messageId}`):"connectMessage"===e.type&&this.EE.emit(`connectMessage:${e.messageId}`,e.data)}onConnect(e){this.EE.addListener("connect",e)}onMessage(e){this.EE.addListener("message",e)}connect(e){return new Promise(t=>{let n={messageId:h(),type:"connect",data:e};this.nativeSend(n),t(new f(n.messageId,this.EE,new v(this)))})}nativeSend(e){if("undefined"!=typeof cloneInto)try{a.logger().info("nativeSend"),e=cloneInto(e,document.defaultView)}catch(e){console.log(e),a.logger().info("error data")}let t=new CustomEvent((this.isContent?"fd":"ct")+this.flag,{detail:e});window.dispatchEvent(t)}sendMessage(e){return new Promise(t=>{let n={messageId:h(),type:"sendMessage",data:e},o=`response:${n.messageId}`,s=e=>{null!==s&&(this.EE.removeListener(o,s),t(e.data),s=null,t=null)};this.EE.addListener(o,s),this.nativeSend(n)})}syncSendMessage(e){let t,n={messageId:h(),type:"sendMessage",data:e},o=`response:${n.messageId}`,s=e=>{null!==s&&(this.EE.removeListener(o,s),t=e.data,s=null)};return this.EE.addListener(o,s),this.nativeSend(n),t}sendRelatedTarget(e){let t=++this.relateId,n=new MouseEvent((this.isContent?"fd":"ct")+this.flag,{movementX:t,relatedTarget:e});return window.dispatchEvent(n),t}getAndDelRelatedTarget(e){let t=this.relatedTarget.get(e);return this.relatedTarget.delete(e),t}constructor(e,t){m(this,"flag",void 0),m(this,"isContent",void 0),m(this,"EE",void 0),m(this,"relatedTarget",void 0),m(this,"relateId",void 0),this.flag=e,this.isContent=t,this.EE=new p,this.relatedTarget=new Map,this.relateId=0,window.addEventListener((t?"ct":"fd")+e,e=>{if(e instanceof MouseEvent)return void this.relatedTarget.set(e.movementX,e.relatedTarget);e instanceof CustomEvent&&this.messageHandle(e.detail,new v(this))})}}(MessageFlag,!1),X=new a({writer:new class{write(e,t,n){this.send.sendMessage({action:this.action,data:{id:0,level:e,message:t,label:n,createtime:Date.now()}})}constructor(e,t="logger"){l(this,"action",void 0),l(this,"send",void 0),this.action=t,this.send=e}}(W),labels:{env:"inject",href:window.location.href}}),K=new class{group(e,t){return new _(this,e,t)}on(e,t){this.apiFunctionMap.set(e,t)}connectHandle(e,t,n){let o=this.apiFunctionMap.get(e);if(o){let e=o(t,new w(n));return e&&(e instanceof Promise?e.then(e=>{e&&n.sendMessage({code:0,data:e})}).catch(e=>{n.sendMessage({code:-1,message:e.message||e.toString()}),this.logger.error("connectHandle error",r.E(e))}):n.sendMessage({code:0,data:e})),!0}}messageHandle(e,t,n,o){let s=this.apiFunctionMap.get(e);if(s)try{let e=s(t,new w(o));if(e instanceof Promise)return e.then(e=>{try{n({code:0,data:e})}catch(e){this.logger.error("sendResponse error",r.E(e))}}).catch(e=>{n({code:-1,message:e.message||e.toString()}),this.logger.error("messageHandle error",r.E(e))}),!0;n({code:0,data:e})}catch(e){n({code:-1,message:e.message||e.toString()}),this.logger.error("messageHandle error",r.E(e))}else n({code:-1,message:"no such api "+e}),this.logger.error("no such api",{action:e})}constructor(e,t,n=!0){b(this,"enableConnect",void 0),b(this,"apiFunctionMap",void 0),b(this,"logger",void 0),this.enableConnect=n,this.apiFunctionMap=new Map,this.logger=a.getInstance().logger({service:"messageServer"}),this.enableConnect&&t.onConnect((t,n)=>{var o;if("string"==typeof t.action)return this.logger.trace("server onConnect",{msg:t}),null!=(o=t.action)&&!!o.startsWith(e)&&this.connectHandle(t.action.slice(e.length+1),t.data,n)}),t.onMessage((t,n,o)=>{var s;if("string"==typeof t.action)return this.logger.trace("server onMessage",{msg:t}),null!=(s=t.action)&&!!s.startsWith(e)&&this.messageHandle(t.action.slice(e.length+1),t.data,n,o)})}}("inject",W),z=new class{init(e){this.envInfo=e,this.server.on("runtime/emitEvent",e=>{let t=this.execList.find(t=>t.scriptRes.uuid===e.uuid);t&&t.emitEvent(e.event,e.eventId,e.data)}),this.server.on("runtime/valueUpdate",e=>{this.execList.filter(t=>t.scriptRes.uuid===e.uuid||E(t.scriptRes)===e.storageName).forEach(t=>{t.valueUpdate(e)})}),this.externalMessage()}start(e){e.forEach(e=>{if(EarlyScriptFlag.includes(e.flag)){for(let t of this.execList)if(t.scriptRes.flag===e.flag){t.dealEarlyScript(this.envInfo);break}return}let t=window[e.flag];t?this.execScript(e,t):Object.defineProperty(window,e.flag,{configurable:!0,set:t=>{this.execScript(e,t)}})})}checkEarlyStartScript(){EarlyScriptFlag.forEach(e=>{let t=window[e];if(t){let e=new q(t.scriptInfo,"content",this.msg,t.func,{});this.execList.push(e),e.exec()}else Object.defineProperty(window,e,{configurable:!0,set:e=>{let t=new q(e.scriptInfo,"content",this.msg,e.func,{});this.execList.push(t),t.exec()}})})}externalMessage(){let e=window.location.hostname;if(H.some(t=>e.endsWith(t)&&(e.length===t.length||e.endsWith(`.${t}`)))){let e=this.msg,t=window.external||(window.external={}),n={isInstalled(t,n,o){M(e,"content/script/isInstalled",{name:t,namespace:n}).then(o)}};try{t.Scriptcat=n}catch{}let o=t.Tampermonkey,s=null==o?void 0:o.isInstalled,r=n.isInstalled;if(s&&(null==o?void 0:o.getVersion)&&o.openOptions)try{o.isInstalled=(e,t,n)=>{s(e,t,o=>{(null==o?void 0:o.installed)?n(o):r(e,t,e=>{n(e)})})}}catch{}else try{t.Tampermonkey=n}catch{}}}execScript(e,t){delete window[e.flag];let n=new q(e,"content",this.msg,t,this.envInfo);if(this.execList.push(n),e.metadata["require-css"])for(let t of e.metadata["require-css"]){let n=e.resource[t];n&&function(e){let t=document.createElement("style");(t.textContent=e,document.head)?document.head.appendChild(t):document.documentElement.appendChild(t)}(n.content)}e.metadata["run-at"]&&"document-body"===e.metadata["run-at"][0]?this.waitBody(()=>{n.exec()}):n.exec()}waitBody(e){if(document.body)return void e();let t=()=>{document.removeEventListener("load",t,!1),document.removeEventListener("DOMNodeInserted",t,!1),document.removeEventListener("DOMContentLoaded",t,!1),this.waitBody(e)};document.addEventListener("load",t,!1),document.addEventListener("DOMNodeInserted",t,!1),document.addEventListener("DOMContentLoaded",t,!1)}constructor(e,t){J(this,"server",void 0),J(this,"msg",void 0),J(this,"execList",void 0),J(this,"envInfo",void 0),this.server=e,this.msg=t,this.execList=[]}}(K,W);z.checkEarlyStartScript(),K.on("pageLoad",e=>{X.logger().debug("inject start"),z.init(e.envInfo),z.start(e.scripts)})})()})();